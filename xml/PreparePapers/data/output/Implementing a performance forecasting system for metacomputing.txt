
 Some text in this electronic article is rendered in Type 3 or bitmapped fonts, and may display poorly 
on screen in Adobe Acrobat v. 4.0 and later. However, printouts of this file are unaffected by this problem. 
We recommend that you print the file for best legibility. Implementing aPerformance ForecastingSystem 
for Metacomputing:TheNetwork Weather Service . RichWolski NeilSpring ChrisPetersony August15,1997 Abstract 
Inthispaperwedescribethedesignandimplementationofasystemcalledthe NetworkWeatherService(NWS)thattakesperiodicmeasurementsofdeliverable 
resourceperformancefromdistributednetworkedresources,andusesnumericalmod­elstodynamicallygenerateforecastsoffutureperformancelevels.Theseperformance 
forecasts,alongwithmeasuresofperformancefuctuation(e.g.themeansquarepre­dictionerror)andforecastlifetimethattheNWSgenerates,aremadeavailableto 
schedulersandotherresourcemanagementmechanismsatruntimesothattheymay determinethequality-of-servicethatwillbeavailablefromeachresource. 
WedescribethearchitectureoftheNWSandimplementationsthatwehavedevel­opedandarecurrentlydeployingfortheLegion[13]andGlobus/Nexus[7]metacom­putinginfrastructures.WealsodetailNWSforecastsofresourceperformanceusing 
boththeLegionandGlobus/Nexusimplementations.Ourresultsshowthatsimple forecastingtechniquessubstantiallyoutperformmeasurementsofcurrentconditions 
(commonlyusedtogaugeresourceavailabilityandload)intermsofpredictionaccu­racy.Inaddition,thetechniqueswehaveemployedarealmostasaccurateassubstan­tiallymorecomplexmodelingmethods.Wecompareourtechniquestoasophisticated 
time-seriesanalysissystemintermsofforecastingaccuracyandcomputationalcom­plexity. 1Introduction Fastnetworkshavemadeitpossibletoconnectdistributed,heterogeneouscomputingre­sourcestoformahighperformancecomputationalplatform,ormetacomputer.While 
*SupportedbyNSFgrantASC-9308900andAdvancedResearchProjectsAgency/ITO,DistributedOb­jectComputationTestbed,ARPAorderNo.D570,IssuedbyESC/ENSundercontract#F19628-96-C-0020. 
ChrisPetersonsupportedinpartbyARPA/NCCOSC(NavalCommandControl&#38;OceanSurveillanceCen­ter)N66001-96-C-8523. 
yemail:rich@cs.ucsd.edu,nspring@cs.ucsd.edu,cpeterso@microsoft.com Permission to make digital/hard copy 
of all or part of this work for personal or classroom use is granted without fee provided that copies 
are not made or distributed for profit or commercial advantage, the copyright notice, the title of the 
publication and its date appear, and notice is given that copying is by permission of ACM, Inc. To copy 
otherwise, to republish, to post on servers or to redistribute to lists, requires prior specific permission 
and/or a fee. (c) 1997 ACM 0-89791-985-8/97/0011 $3.50 metacomputingoferstremendouspotentialperformance,realizingthatpotentialdepends, 
inpart,ontheabilitytomanagetheefectsofresourcecontentiononapplicationperfor­mance.Inparticular,resourceallocationandschedulingdecisionsmustbebasedonpre­dictionsoftheperformanceeachresourcewillbeabletodelivertoanapplicationduring 
aspecifedtimeframe.Fixedestimatesbasedonmanufacturer'sperformancespecifcations aretypicallyinadequateastheyfailtorefecttheperformancelossduetofairsharingand 
contention.Moreover,thesecontentionefectsvarydynamicallyascompetingapplications varytheirresourcedemands. 
Wehavedesignedandimplementedasystemthattakesperiodicmeasurementsofthe currentlydeliverableperformance(inthepresenceofcontention)fromeachresourceand 
usesnumericalmodelstogenerateforecastsoffutureperformancelevelsdynamically.Fore­castdataiscontinuallyupdatedanddistributedsothatresourceallocationandscheduling 
decisionsmaybemadeatruntimebasedonexpectedlevelsofdeliverableperformance.To theextentthatnetworkperformanceconditionscanbethoughtofasthe\networkweather", 
thisfunctionalityisroughlyanalogoustoweatherforecastingandhencewetermthesystem theNetworkWeatherService(NWS). 
SincetheNWSmeasuresandforecastsperformancedeliverabletotheapplicationlevel, itmustbeimplementedusingthesamecommunicationandcomputationmechanismsthat 
applicationsusesothatforecastsaccuratelyrefectthetrueperformanceanapplicationcan expecttoobtain.Initially,wehavedevelopedseparateimplementationsoftheNWSusing 
sockets(basedonthenetperf[15]utility)andfortheGlobus/Nexus[8]andLegion[13] metacomputingenvironments,eachofwhichprovidesasoftwareinfrastructurethatsupports 
high-performancedistributedandparallelcomputing.AspartoftheAppLeS(Application­LevelSchedulers)project[2,1]wearedevelopingschedulingagentsthatmakedecisionsbased 
onapplication-levelperformanceestimates.ThefunctionalityoftheNWSismotivatedby therequirementsoftheseagents.Inaddition,quality-of-serviceguaranteesinsharednetwork 
environments(e.g.TheInternet)aredifculttoachieve.NWSforecastsprovidestatistical estimatesofavailableservicequalityfromeachresource,aswellasthedegreetowhichthose 
estimatesarelikelytobeaccurate[17]. Inthispaper,wefocusonthearchitectureandimplementationoftheLegionand 
Globus/NexusNetworkWeatherServiceversions.Section2describesthehigh-levelar­chitectureofthesystemanddiscussessomeofthedetailsspecifctotheLegionandNexus 
implementations(thesocketversionisdescribedmorecompletelyin[16]).Insection3,we presentcomparativeforecastingresultsandweconcludewithanevaluationofthecurrent 
systemandadescriptionoffutureresearchinsection4. 2Architecture Inthissection,wepresentsomehigh-leveldesignissuesthatshapedthearchitectureofthe 
NetworkWeatherService(NWS).TheNWSwasdesignedasamodularsystemtoprovide performanceinformationfordistributedapplicationscheduling.Someofitsforecastingmod­els(describedmorecompletelyin[17])requirelong-termhistoryinformation.Assuch,we 
network link sensor forecasting methods Figure1:TheLogicalStructureoftheNetworkWeatherService. havedesignedthesystemtobepersistentwiththeintentionthatitbeacontinuallyavailable 
servicewithinthemetacomputingenvironment.Sinceworkstationusersmustretainauton­omyovertheirownmachines,andthechancesofresourcefailurescalewiththesizeofthe 
computingenvironment,thesystemmustberobustwithrespecttoresourcefailure.Fur­thermore,metacomputersaredynamicallychanginginstructureandcomposition.Resources 
maybeadded,deleted,ormodifed(upgraded,reconfgured,etc.)underthecontroloftheir respectiveownersandmanagers.TheNWS,therefore,mustbedynamicallyreconfgurable 
toaccommodatechangesintheunderlyingmetacomputingsystem. WehaveseparatedtheNetworkWeatherServicefunctionalityintothreemodules: 
.asensorysubsystemthatmonitorssystem-wideresourceperformancelevels, .aforecastingsubsystemthatpredictsfutureconditionsandpassesthisinformation 
to .areportingsubsystemthatdisseminatestheforecastinformationinvariousformats. Figure1depictsthislogicalorganization.Measurementdataiscollectedindependently 
fromtheresourcesensorsandstoredinaphysicallydistributeddatabasebythesensory subsystem.Forecastingmodelsareappliedtomeasurementhistories(whichmaybetreated 
astimeseries)togeneratepredictions.Theforecastingsubsystemalsotrackspredictionerror andmaintainsaccuracyinformationforeachpredictionsothatthequalityofeachprediction 
maybegauged.Externalprograms,suchasuserapplications,systemschedulers,orquality­ of-servicemechanismscanaccessforecastinformationgeneratedbytheNWSthroughthe 
publicinterfaceexportedbythereportingsubsystem. 2.1SensorySubsystem Theinformationgiventoaschedulershouldrepresentdeliverableperformancethatresources 
canprovidetoanapplication.Forthisreason,measurementsofresourceperformanceare takenattheapplicationlevel,usingthefacilitiesprovidedbytheunderlyingresourceman­agementsystem.Byusingthesamefacilitiesthatareavailabletoanapplication,NWS 
measurementsaresubjecttotheoverheadsimposedbytheresourcemanagementsystem. Lowerlevelmonitoringtoolsmaynotcapturetheefectofsuchoverheadsattheapplication­level,particularlywithrespecttocontention. 
TheNetworkWeatherServicedistinguishesbetweenpassivesensorsandactivesensors. Apassivesensor,suchastheCPUavailabilitysensor,exercisesanexternalsystemutility 
andscanstheutility'soutputtoobtaininformationdescribinganumberofresources.For example,memoryusageandCPUavailabilitycanbetrackedbyexecutingtheUnixutilities 
vmstatoneachmachineandprocessingtheoutput.Itisimportantthattheexternal utilitiesbenon-privilegedwithrespecttoanapplication.Iftheinformationprovidedbythe 
NWScanonlybeobtainedbyaprivilegedprocess,itwouldnotonlyviolatelocalsecurity constraints,butitwouldnottrulyrepresentwhatisvisibletoatypicalapplication. 
Anactivesensor,ontheotherhand,mustexplicitlymeasuretheavailabilityofthe resourceitismonitoring.Totestaresource,anactivesensorwillconductaperformance 
experimentthatisintendedtoberepresentativeofatypicalresourceaccess.Again,such accessesmustbemadewithstandarduserprivilegessothattheyrefecttrueapplication-level 
performance. 2.1.1SensingtheNetwork TheNWScurrentlymonitorsbothprocess-to-processlatencyandthroughputthroughout 
thesystemusinganactivesensor.Figure2detailstheperformanceexperimentconductedby NWSnetworksensors.Networklatencyistheminimumtransitdelaywhentransmittinga 
message.TheNWSapproximatestheone-waymessagelatencyasone-halfoftheround-trip timeforanarbitrarilysmallmessage. 
Networkthroughputisdefnedtobetheefectiverateatwhichbitscanbesentfromone processtoanother.Toperformathroughputexperiment,amessageofsignifcantsizeissent 
betweenprocessesandthetimerequiredtocompletethetransferandreceiveanacknowl­edgementisrecordedonthesendingside.Thelengthofthismessageisparameterizable, 
dependingonthespeedoftheconnection,thephysicalproximityofthemachines,andthe degreeofintrusivenessaparticularconnectioncansupport.Inthecurrentimplementations, 
thissizeissetbytheNWSadministrator,althoughweareconsideringwaysinwhichitcan Figure2:ThroughputandLatencyExperiments. 
bedeterminedautomaticallybytheNWSitself.Throughputiscalculatedas datasize efectivethroughput= datatransfertime-predictedround-triptime 
wherethepredictedround-triptimecomesfromtheforecastforlatencybetweenthetwo processes. Thesensorysubsystemmustcontrolallnetworkexperimentssothattheydonotconsume 
anappreciableportionoftheresourcetheymonitor.Settingthetransfersizetobelarge yieldslowerpredictionerrors(e.g.highqualitypointestimatesofavailablethroughput). 
However,thethroughputthatisconsumedbytheexperimentisunavailableforapplication usewhiletheexperimentisunderway.Thatis,theexperiment,itself,maycontendwith 
theapplication.Alternatively,asmalltransfersizewillyieldlessaccuratepredictions,but intrudelessontheavailablenetworkperformance.Derivingthebesttransfersizevalue 
foreachnetworksettingisthesubjectofourcurrentwork.Theimplementationswehave deployedcurrentlyusetransfersizesthatwehaveobservedtoworkwellinpractice. 
Thesensorysubsystemmustalsotakecarenottoinadvertentlymeasuretheefectsofits ownprobesasambientcontention.Forexample,simultaneousthroughputexperimentscon­ductedbyseparatehostsattachedtoasingleethernetsegmentwillinterfere.Figure3depicts 
theefectsofthisinterference.Eachdatapointrepresentsthethroughput(inmegabitsper second)thatwasobtainedbyapairofprocessesperforming64kilobytetransfersoveraneth­ernetsegmentusingtheMentat[12]communicationprimitivesavailablewithLegion[13]1. 
Thetimeatwhicheachexperimentwasconductedisrepresentedalongthehorizontalaxis sothatthegraphshowsatimeseriesofmeasurements.Onemeasurementwasmadeevery 
tensecondsoveratwenty-fourhourperiod.Atthetimecorrespondingtotheverticalline 1TheMentatProgrammingLanguageisanobjectorienteddialectofC++whichallowsprogram-level 
accesstotheLegionmetacomputingsoftwareinfrastructure. 8.0 Throughput (mbits/s) 4.0 0.0 12:00 PM 4:00 
PM 8:00 PM 12:00 AM 4:00 AM 8:00 AM 12:00 AM Time Figure3:ThroughputExperimentInterference inthefgure,(approximatelytwelvehoursafterthebeginningofthetimeseries)westarted 
asecondsetofperiodicmeasurements(alsousing64kilobytetransfers)betweenadiferent pairofhostsconnectedtothesameethernetsegment.Tomeasuretheworst-caseefect,we 
endeavoredtomakethenetworkprobescollideasmuchaspossible.Thediferencebetween thelefthandsideofthefgureandtherightresultsfromthecollisionof,andsubsequent 
contentionbetween,simultaneousnetworkexperiments. NotethatthecontentionefectsdepictedinFigure3afecttheforecastthattheNWS 
shouldreporttoanapplicationscheduler.Ifoneprobeisperiodicallyactive,thetimeseries onthelefthandsideofthefgureshouldbeusedtogenerateaforecast.Iftwoprobes 
areperiodicallyactive,therighthandsidedatashouldbeused.Visually,itisclearthat anyreasonableforecastingtechniquewillyielddiferentpredictionsforthetwodiferent 
timeseries.Therighthandtimeseriesisparticularlyproblematic.Itislargelybimodal, butaperiodogram[11,14]failstorevealpredictablecycleswithinthedata.Thatis,the 
measurementsdonotswitchperiodicallybetweenonemodeandtheother.Consequently, tomakeareasonableforecastfromthisdata,anapplicationoftimeseriesanalysisrequires 
fourdistributions:oneforeachmode,andoneeachdescribingthetransitionsbetween modes.Derivingthesedistributionsandthenusingthemefectivelytogenerateforecastsis 
considerablymorecomplexthanintheunimodalcase.Further,ifthetwoprobesareallowed tocontendrandomly,theresultingserieswillbesomecombinationofthetwoshowninthe 
fgure.Asmorehostsareadded,theefectbecomesmorepronouncedandlesspredictable. Thereareseveralwaystoaddresstheproblemofcontrollingthepossibleinterference 
betweennetworkprobes.Themethodwehavechosentoimplementfrstisatokenpassing schemethatensuresmutualexclusionbetweenexperiments.Whenanetworksensorreceives 
atoken,itisentitledtoconductasinglenetworkperformanceexperimentandthentopass thetokenontoasuccessor.Sinceonlyoneperformanceexperimentcanbeactiveatatime, 
collisionsbetweenexperimentsareavoided.Inaddition,weincorporateasimpletoken­recoveryschemeincaseofaresourcefailure.Ifthetokencannotbepassedtoahost,that 
hostisautomaticallyconfguredoutofthesystemuntilitscontinuedfunctionalitycanbe verifed.Ifasystemcrasheswhileholdingthetoken,apre-elected\master"detectstoken­ 
deathviaatimeout.Thetokenmastercanbeswitcheddynamicallybetweenhostsshould themaster,itself,fail. Itisobviousthatthistoken-passingmethodforensuringnon-interferencebetweenex­perimentsdoesnotscale.Whileweareinvestigatingwaystofltertheefectsofpossibly 
contendingnetworkexperiments,weareplanningtoimplementalarge-scaleNWSasahier­archyofpotentiallysynchronizingpoolsofhosts.Forexampletokenpassinginstances(called 
cliquesinourterminology)canbeorganizedasatreewhereeachlevelinthetreeformsa clique.Theleavesofthetreerepresentindividualmachines.Ineachclique(correspondingto 
alevelinthetree),anindividualrepresentativenodeisdesignatedtoalsoparticipateinthe cliqueaboveit(atthenextlowerlevel).Datauptothenearestcommonancestralcliquebe­tweentwohostsneedonlybeconsideredwhenestimatingthenetworkperformancebetween 
them.Wewillalsoconsidermethodsotherthantoken-passingforcontrollinginterference betweennetworkexperimentswithinaclique,infutureimplementations. 
2.1.2SensingtheMachines Tomeasuretheavailabilityofamachine,theNetworkWeatherServiceusesapassivesensor 
module.Currently,theCPUsensorstartstheUnixvmstatsystemutilityasabackground processandperiodicallyscanstheoutput.Thevmstatoutputisparsedtopickoutthenum­berofrunningprocesses,andthepercentageofthetotaltimethesystemisspendinginuser 
andsupervisorstaterespectively.TheNetworkWeatherServicecomputesthepercentageof thetimethataprocessorwillbeavailabletoeachrunningprocessas 
availableCPU=Tidle+(Tuser.rp) +(Tuser.Tsystem.rp) where Tidle =percentageoftimecpuisidle Tuser =percentageoftimecpuisexe­cutingusercode 
Tsystem =percentageoftimecpuisexe­cutingexecutingsystemcode rp=runnableprocesses Usingthisvalue,aschedulercancomputetheCPUslowdownaprocesswillexperience 
duetocontention.Therationaleforthisformulaisthatanewjob(runningwithstandard priority)shouldbeentitledtoalloftheidletime,andafairshareoftheavailableuserstate 
time.Ourexperiencehasbeenthatsystemcycles(representedTsystemintheequation)are sharedfairlyinproportiontotheamountoftimethesystem,asawhole,spendsexecutingin 
userstate.Whilethisempiricallyderivedformulahasworkedwellforsomeapplications[3], theNWScaneasilyaccommodatemoresophisticatedtechniquessuchasthosedescribed 
in[5]. Figure4:AvailableCPUcalculation.rp=2runnableprocesses.Tuser=0.36,ofwhich half(0.18)wouldbeusabletoasecondprocess.Tidle=0.46,allofwhichisavailablefor 
computation.Tsystem=0.18,ofwhich0.03canbeshared.ThetotalavailableCPU= 0.67. 2.2ReportingSubsystem NetworkWeatherpredictionsareaccessibleviaanexportedreportinginterface.Theintru­sivenessoftheinterface(i.e.thenetworkandcomputationalresourcesrequiredtodissem­inateforecastinformation)isakeyconcerninitsdesign.Storeddataisdistributedacross 
thesystemtobalancethestorageloadandtoavoidabottleneckattheinterface.Eachhost maintainsacopyofthecurrentstateofthenetwork,andtheone-step-aheadpredictionsof 
futureconditions.Toamortizetheoverheadassociatedwithexchangingstate,eachNWS serversendsacopyofitslocalstateaspartofeverythroughputcommunicationexperiment 
itconducts.ThedatastoredateachhostisshowninFigure5.Storingaglobalimageof thecurrentandpredictedstateofthenetworkoneachhostallowsclientstoaccessthisdata 
fromanumberofdiferentsources,eachofwhichhasacopy.Timeserieshistoryinforma­tionisstoredbyindividualhosts,andistransferredonlybytherequestofaninterested 
client.Thisformofon-demandtransferminimizestheamountofdatastoredoneachhost, whilestillprovidingdetailedforecastinformationtoclientsefciently.Accesstobothremote 
andlocaldataisprovidedthroughthecommunicationprimitivesoftheunderlyingresource managementsystem. UserscanviewNWSweatherreportsusingtheWorldWideWeb.TheNetworkWeather 
ServiceoneachmachinecontinuouslygeneratesapubliclyaccessibleHTMLflecontaining a\snapshot"ofthemostrecentforecasts.Withtheirwebbrowers,userscanwatchcurrent 
andpredictednetworkconditionsfuctuateastheNetworkWeatherServicemonitorsthe network.  3Results Toforecastresourceperformance,theNWStreatsperiodicmeasurementstakenfroma 
particularsensorasatimeseries,andthenusesdiferentstatisticalmodelstopredictthe nextvalueintheseries.Inthissection,wereporttheperformanceoftheforecastingsystem 
(intermsofpredictionaccuracy)forseveraldiferentresources.Wecomparemeasurements andforecastsmadeusingtheLegionandGlobus/Nexussystemstoconsidertheefectof 
theunderlyingresourcemanagementsystemonperformanceforecasting.Wealsoprovidea Figure5:Datastoredoneachhost. 
 briefinvestigationoftherelationshipbetweenthecomputationalcomplexityassociatedwith generatingaforecastanditsaccuracy. 
3.1ForecastingSubsystem TheNetworkWeatherServiceusesanumberofpredictivealgorithmstoanticipateperfor­mancefuctuations.Sensorydataisorderedbytimestampsothattheforecastingmodels 
maytreateachpredictionhistoryasatimeseries.In[16,17]wedetailthespecifcalgorithms thatarepartofthecurrentNWSimplementations.Fromtheperspectiveoftheforecasting 
subsystem'simplementation,eachforecastingmodelisanindependentmodulethatimports andexportsacommoninterface.Whenaforecastisrequired,theNWSevaluatesaset 
ofdiferentforecastingmodelsandthenautomaticallychoosesbetweenthembasedonthe accuracyhistoryofeachmodel.Currently,themodelsthatareincludedarecomputationally 
cheaptocomputesothatthesystemcanadaptthemdynamicallytochangingconditions. WediscussthisissuefurtherinSection3.3. 
3.2Process-to-ProcessThroughput WemonitoredtheefectivethroughputusingtheLegionversionoftheNWSbetweentwo 
adjacentsunworkstationsonanethernetsegmentintheParallelComputationLab(PCL) atUCSD.Onceeverysixtysecondsovera24hourperiod(startingatmidnightonTuesday, 
February4,1997),theNWSmoveda64kilobytearrayviaaMentatmethodinvocation betweenthetwohostsandtimedthetransfer.Figure6(a)showsthetimeseriesofmea­surementsandFigure6(b)showsthecorrespondingpredictionsmadebytheNWS.The 
8.0 4.0 0.0 (a) 8.0 4.0 0.0 (b) Figure6:LegionThroughputMeasurements(a)andPredictions(b)inthePCL Throughput 
(mbits/s) Throughput (mbits/s)  10 Predictor MAE LAST 0.28 RUNAVG 0.23 SWAVG 0.23 MEDIAN 0.18  Table1:ForecastingErrorforPCLThroughputusingLegion.Lowervaluesindicatebetter 
predictorperformance. unitsofmeasurementaremegabitspersecondandthemeanabsoluteerror(MAE)forthe predictionis0:18.Thatis,duringthemeasurementperiod,ateachtimesteptheprediction 
ofameasurementdiferedfromtheactualmeasurementitwaspredictingbyanaverageof 0:18megabitspersecond.Table1summarizesthepredictiveperformanceofseveraldifer­entforecastingmethods.TheNWScurrentlysupportsavarietyofforecastingtechniques, 
thedetailsofwhicharemorecompletelydescribedin[16,17].Intheinterestofbrevity, wedemonstrateitsfunctionalityusingonlyforecastersthatarebasedonthecommonsum­marystatisticsshowninthetable.Thecompletebatteryoftechniquesincludesthesesimple 
onesshowninthetableaswellasother,moresophisticatedmethods.Forthepurposesof illustration,however,werestrictourselvesheretoasimpleset. 
TheLASTpredictorusesthelastmeasurementasapredictionofthenextmeasurement. RUNAVGkeepsarunningtabulationoftheaveragemeasurementandusesthatasa 
predictionateachtimestep.SWAVGusestheaverageofthecurrentmeasurementand theprevious20measurements(aslidingwindowof21measurements)asapredictorofthe 
nextvalueandMEDIANusesthemedianoverthesameslidingwindowasapredictor. Bytrackingthepredictionerrormadebyeachpredictor,theNWSwasabletoidentify 
MEDIANasthemostaccurate(yieldingthelowestaverageerror). NotethatLAST,bycomparison,isnotagoodpredictoryieldinganabsoluteprediction 
errorthatisanaverageof0.1megabitspersecond(55%)greaterthanthatgeneratedby MEDIAN.Ingeneral,ourexperiencehasbeenthatthelastmeasurementisapoor 
predictoroffuturenetworkperformance.Performancemonitoringsystemsoftenusecurrent measurementdataasanestimateoftheavailablethroughput.Clearly,evenforapredictable 
networkliketheoneshowninFigure6,simpleprobesmeasuringcurrentconditionsarepoor indicatorsoftheperformancethatwillbeavailableinthenexttimestep. 
InFigure7weshowthroughputmeasurementsandpredictionsgeneratedusingNexus remoteservicerequestsbetweenprocessesrunningonworkstationsintheUCSDPCLand 
attheSanDiegoSupercomputerCenter(SDSC).Asinthepreviousexperiment,theNWS moved64kilobytesofdataevery60secondsandtimedthetransfer.Theresultingthroughput 
betweenthePCLandSDSCwasrecordedinunitsofmegabitspersecond.Figure7(b)shows thepredictionsmadebytheNWSandTable2summarizestheaccuracyofeachpredictorin 
termsofmeanabsoluteerror.Inthiscase,theaverageabsoluteerrorinmegabitspersecond generatedbyMEDIANis0:08megabitspersecondlowerthanLASTand0:11megabits 
persecondlowerthanRUNAVG.TheforecastsshowninFigure7(b)areacombinationof 4.0 0.0 (a) 4.0 0.0 (b) Figure7:NexusThroughputMeasurements(a)andPredictions(b)fromthePCLtoSDSC 
Throughput (mbits/s) Throughput (mbits/s)  12  UsingNexus UsingLegion Predictor MAE Predictor MAE LAST 
0.46 LAST 1.40 RUNAVG 0.49 RUNAVG 1.40 SWAVG 0.39 SWAVG 1.30 MEDIAN 0.38 MEDIAN 1.30 Table2:ForecastingErrorforPCLtoSDSCThroughput 
SWAVGandMEDIANastheNWSswitchedbackandforthbetweenthemdepending onwhichyieldedthelowestMAEatanygivenpointintime.Thiscombinationalforecast 
alsoyieldedameanabsolutepredictionerrorof0:38megabitspersecond. InFigure8weshowthroughputmeasurementsandpredictionsforthesamePCL-to­SDSCcommunicationlinkusingLegion.ComparedtotheequivalentsetofNexusmea­surementsshowninFigure7a,theLegionmeasurementsvarythroughawiderrange.A 
scatterplotoftheLegionmeasurementdata(showninFigure8c)revealsamultimodaldis­tributionofmeasurements.WeattributethismultimodalitytotheuseofUDPasLegion's 
underlyingmessagingprotocol.Thetimeoutvalueforalostpacket(duetogatewayconges­tion)isonesecondinthecurrentLegionprototypeimplementation2causingasubstantial 
lossofthroughputwhenapacketislost.Atpresent,theNWSisunabletopredictinwhich modeasuccessivemeasurementwillfallatanygivenmoment.Neitheraperiodogram[11] 
norastate-transitionanalysis[4]yieldexploitablepredictiveinformation.Consequently, theforecasterrorsforLegionthroughputmeasurements,showninTable2,arehigherthan 
forNexus.NotethattheNWSdistributesitsquantifcationofforecastingerrorsothat schedulersandquality-of-servicemechanisms,suchasthoseproposedin[6],canconsider 
theperformancepredictabilityofaresource.If,forexample,boththeNexusandLegion messagingsystemswereavailabletoanapplicationcommunicatingbetweenthePCLand 
SDSC,aschedulermightchoosetouseNexusforthecommunicationduetoitsgreaterpre­dictability.Conversely,inalocalareasettingwherepacketlossisrare,Legion'smessaging 
systemmightbemoreappropriate. 3.3ForecastingComplexityversusAccuracy Thechoiceofcomputationallysimpleforecastingtechniquesisnotonlymotivatedbyour 
desiretobuildinitialprototypeswithwhichtoexperiment,butalsobyourexperienceswith theuseofmoreelaboratestatisticalmethodsinadynamicsetting.Specifcally,itisoftenthe 
casethattheadditionalaccuracyprovidedbyasophisticated,butcomputationallycomplex, forecastingtechniquecannotbeamortizedefectively. 
Forexample,considerthetimeseriesshowninFigure9(a)whichdepictsaseriesof processtoprocessthroughputmeasurementsbetweentwoworkstationsconnectedviaether­ 
2Legioniscurrentlybeingreimplemented.Inthenextreleaseofthesystem,itisourunderstandingthat morerobustcommunicationprotocolswillbeavailable. 
4.0 Throughput (mbits/s) Throughput (mbits/s) Throughput (mbits/s) 0.0 12:00 AM 4:00 AM 8:00 AM 12:00 
PM 4:00 PM 8:00 PM 12:00 AM Time (a) 12:00 AM 4:00 AM 8:00 AM 12:00 PM 4:00 PM 8:00 PM 12:00 AM Time 
 (b) 12:00 AM 4:00 AM 8:00 AM 12:00 PM 4:00 PM 8:00 PM 12:00 AM Time  4.0 0.0 4.0 0.0 (c) Figure8:LegionThroughputMeasurements(a),andPredictions(b),andaScatterPlotofthe 
Measurements(c)fromthePCLtoSDSC 14  Predictor Description RUNAVG runningaverage SWAVG slidingwindowavg. 
LAST lastmeasurement ADAPTAVG adaptivewindowaverage MEDIAN medianflter ADAPTMED adaptivewindowmedian 
TRIMMEAN .-trimmedmean GRAD stochasticgradient AR autoregression MINMAE adaptiveminimumabsoluteerror 
 Table3:SummaryofForecastingMethods netwithintheUCSDParallelComputationLaboratory.Eachmeasurementrepresentsthe 
throughputobservedbytiminga64kilobytetransferbetweenthetwoworkstationsusing TCP/IPsockets.Onemeasurementwastakeneverythirtysecondsoveratwenty-fourhour 
periodbeginningat6:00PMonThursday,September19,1996. Toinvestigatetherelationshipbetweenmodelcomplexityandaccuracy,wecomparethe 
predictiveperformanceofamodelfttedusingSemi-NonparametricTimeSeriesAnalysis (SNP)developedbyGallantandTauchen[10,9]tothecurrentsetofNWSforecasting 
methods(showninTable3).AcompletedescriptionofeachNWStechniqueisgivenin[16]. Tomakeaforecastusingthesemethods,theNWSrunsthemalleverytimeaforecast 
isrequired,andthenusesthemethodthatyieldstheminimumabsoluteerror(denoted MINMAEinthetable)asthepublishedforecast.Inthisway,theforecastingsystem 
canidentifywhichmethodhasbeenmostaccurateovertimeandusethatmethodfor subsequentforecasts.Moreover,ifconditionschangeandanothermethodbecomesmore 
accurate,theNWSnoticesthechangeandswitchesmethodsdynamically.Sinceallmethods mustbeevaluatedeverytimeaforecastisrequired,weincludeonlythoseforwhichwehave 
acomputationallyefcientimplementation. Alternatively,forecastingusingSNPisatwo-phaseprocess.First,amodelisfttothe 
timeseriesusinganiterativesearchmethodthatcanbecomputationallycomplex.Once ft,themodelcomputestheone-step-aheadconditionalprobabilitydensityusingasmall 
numberoflags(previousmeasurements).Fromtheconditionaldensity,thesystemcalculates aconditionalexpectedvalueforthenextmeasurementwhichweuseasaforecast. 
Fromaclassicaltime-seriesanalysisperspective,SNPisapowerfultechnique.Themodel fttingphaseconsidersstationaryautoregressioninvariousforms(bothwithGaussianand 
non-Gaussiannoiseterms),autoregressive,conditionallyheteroscedastic(ARCH)models (withandwithoutGaussiannoise),andgeneralnon-linearprocesseswithheterogeneous 
innovations. Table4comparestheperformanceofforecastsgeneratedusingSNP,withthetechniques showninTable3thatareimplementedbytheNWS. 
Method MAE Cost/Pred(ms/pred) SNP 0.437 1090ms/pred NWS 0.450 7.29ms/pred Table4:ComparisonofForecastingPerformance 
WeranbothexperimentsonadedicatedSPARC20workstationandalltimeseries dataftintorealmemory.Thetimingdatainthetablerefectstheaveragetimerequired 
togenerateaforecastinmilliseconds.InthecaseofSNP,however,itdoesnotrefect thetimerequiredtoftamodel.Thatis,thesetimesrefectthediferencebetweenusing 
theadaptivetechniquewehaveincorporatedwithintheNWS(whichrequiresnomodel­fttingphase)versusevaluatingthemodelftwithSNPeachtimeaforecastisrequired. 
Althoughgeneratingaforecastisthreeordersofmagnitudeslowerusingthemorecomplex SNPmodel,itstillreasonablewithrespecttoa30secondmeasurementcycle.Thatis,if 
aforecastisgeneratedeverytimeameasurementistaken,waitingapproximately1second forthatforecast(assuminga30secondcycle)isprobablyreasonable.Figures9(b)and9(c) 
showthepredictionsmadebyeachmethod. TheSNPmodelweusedtogeneratethepredictionsshowninFigure9(c)tookalmost 
21hoursofdedicatedCPUtimeontheSPARC20toft.Weusedatraceoftheprevious twenty-fourhourperiodtoftageneralnon-linearmodelwithheterogeneousinnovations. 
WhilethedelayassociatedwithevaluatingtheSNPmodel(approximately1secondper forecastonaSparc20)mightbeamortizable,a21hourmodelfttingtimeisnot.Perfor­manceenhancementstotheSNPcodeitself(e.gparallelization)andfasterresourcesmight 
reducethiscost,butasTable4shows,theimprovementinaccuracygainedbythemore complextechniqueissmall.TheaverageforecastingerrorgeneratedbytheNWSdynamic 
methodis0.02megabitspersecondgreaterthatthatgeneratedwithSNP.Sincethevalues beingforecastareontheorderof6megabitspersecond,thesmallimprovementinaccuracy 
doesnotseemtowarrantthemuchlargercomplexityassociatedwithgeneratingandthen evaluatingtheSNPmodel.Itmaybe,however,thatforothermeasurementtimeseriesless 
complexSNPmodelswillperformbetter.However,forprocess-to-processTCP/IPperfor­manceoveranethernet(whichisrelativelypredictable|notethesmallMAEassociated 
witheachprediction)thedynamicNWStechniquesworkverynearlyaswellwithmuchless computationalcomplexity. Clearly,muchworkistobedonetofndthebalancepointbetweenthecomplexityasso­ciatedwithdynamicallygeneratingaforecastanditsaccuracy.Wearecertainthatthereare 
manywaystostreamlineandimprovethecostofmodelfttingwithSNP,forexample,some ofwhichareoutlinedbyitsauthors(see[9]).However,sincetheimprovementinforecast 
accuracyisslight,wehavechosentoincorporateamoredynamicandcomputationallycheap methodologyintheNWS,atpresent.Efectivelyincorporatingof-linemodelingtechniques 
likeSNPandothertime-seriessystemsinamannerwhichiscostefective(giventhedynamic natureofmetacomputingsystems)isthesubjectofourpresentresearch. 
8.0 4.0 0.0 (a) 8.0 4.0 0.0 (b) 8.0 4.0 0.0  Throughput (mbits/s) Throughput (mbits/s) Throughput (mbits/s) 
 (c) Figure9:Measurements(a),NWSDynamicPredictions(b),andSNPGeneratedPredictions(c) forThroughputinthePCL 
17  4ConclusionsandFuture Work Inametacomputingenvironment,schedulingandquality-of-servicemechanismsmusthave 
accesstopredictionsofdeliverableresourceperformancetomitigatetheefectsofcontention. WehaveimplementedasystemcalledtheNetworkWeatherServicethatcollectsperiodicper­formancemeasurementsandgeneratesstatisticalforecasts,dynamically,basedontime-series 
analysistechniques.Thesystemisintendedtobeaubiquitousservicewithinametacom­puter,providingforecastinformationtoallinterestedschedulers,quality-of-servicefacilities, 
andusers. Toprovideaccurateperformanceforecasts,themeasurementsrequiredtoparameterize theforecastingmodelsmustbeasnon-intrusiveaspossible.Performanceexperimentsthat 
sensetheavailableperformanceatanygiventimemustnotinterferewitheachother,orinac­curatereadingswillbeincorporatedintothegeneratedforecasts.Furthermore,sinceforecast 
informationmaybeuseddynamically(i.e.tosupportdynamicscheduling),theinterface tothesystemalsomustbelightweightandnon-intrusive.Theserequirementsmotivatethe 
designoftheNWSarchitecture,andtheimplementationswehaveconstructedforTCP/IP andUnixsockets,andtheGlobus/Nexus,andLegionmetacomputingenvironments. 
Tomakeforecasts,theNWSautomaticallyidentifesandcombinesdiferentpredictive strategiesfromasetofpotentiallyusefulmodels.Itchoosesthosemodelsthat,atanygiven 
time,haveaccumulatedthelowestaggregatepredictionerror.Ourexperienceindicatesthat thisdynamicmethodofforecastingmodelselectionworkswell.Moreover,usingsimple 
forecastingtechniqueslikethoseoutlinedinSection3yieldsmoreaccuratepredictionsthan thosegeneratedfrommeasurementsofcurrentconditionsalone.Bothforecastdataand 
accuracymeasuresaremadeavailabletoNWSclientssothatthepredictabilityofaresource maybeconsidered.Further,whiletheforecastingtechniqueswedescribearecomputationally 
simple,ourearlyexperienceswiththemindicatethattheyperformalmostaswellasthose whichareconsiderablymorecomplex.Thelightweightnatureoftheforecastingmethodswe 
haveimplementedmakesthemappropriatefordynamiccomputationalsettings. Ourfutureworkwillfocusondevelopingnewsensorymechanismsandnewforecasting 
techniques.Predictingthetimeajobwillwaitinabatchqueueisespeciallyimportant inlarge-scalecomputationalsettings,forexample.Tomakesuchpredictions,weneedto 
incorporatemoresophisticatedsensorsandforecastingmodels.Wearealsoplanningto developascalableversionofthesystemthatcanbedeployedoverlargenumbersofresources, 
basedonahierarchicalorganizationofNWSresourceclusters. References [1]AppLeS.http://www-cse.ucsd.edu/groups/hpcl/apples/apples.html. 
[2]F.BermanandR.Wolski.Schedulingfromtheperspectiveoftheapplication.InProceedings ofHigh-PerformanceDistributedComputingConference,1996. 
[3]F.Berman,R.Wolski,S.Figueira,J.Schopf,andG.Shao.Applicationlevelschedulingon distributedheterogeneousnetworks.InProceedingsofSupercomputing1996,1996. 
[4]M.DevarakondaandR.Iyer.Predictabilityofprocessresourceusage:Ameasurement-based studyonunix.IEEETransactionsonSoftwareEngineering,(12),December1989. 
[5]S.FigueiraandF.Berman.Modelingtheefectsofcontentionontheperformanceofhetero­geneousapplications.InProc.5thIEEESymp.onHighPerformanceDistributed 
Computing,August1996. [6]I.Foster,J.Geisler,C.Kesselman,andS.Tuecke.Managingmultiplecommunicationmethods 
inhigh-performancenetworkedcomputingsystems.JournalofParallelandDistributed Computing,40:35{48,1997. 
[7]I.FosterandC.Kesselman.Globus:Ametacomputinginfrastructuretoolkit.International JournalofSupercomputerApplications,1997.toappear. 
[8]I.Foster,C.Kesselman,andS.Tuecke.Thenexusapproachtointegratingmultithreading andcommunication.JournalofParallelandDistributedComputing,1997.toappear. 
[9]R.GallantandG.Tauchen.Snp:Aprogramfornonparametrictimeseriesanalysis.In http://www.econ.duke.edu/Papers/Abstracts/abstract.95.26.html. 
[10]R.GallantandG.Tauchen.Seminonparametricestimationofconditionallyconstrainedhet­ erogeneousprocesses:Assetpricingapplications.Econometrica57,pages1091{1120,1989. 
[11]C.GrangerandP.Newbold.ForecastingEconomicTimeSeries.AcademicPress,1986. [12]A.Grimshaw.Easy-to-useobject-orientedparallelprogrammingwithmentat.IEEECom­puter,May1993. 
[13]A.S.Grimshaw,W.A.Wulf,J.C.French,A.C.Weaver,andP.F.Reynolds.Legion:The nextlogicalsteptowrdanationwidevirtualcomputer.TechnicalReportCS-94-21,University 
ofVirginia,1994. [14]W.e.a.Leland.Ontheself-similarnatureofethernettrafc.IEEE/ACMTransactions onNetworking,February1994. 
[15]Netperf.http://www.cup.hp.com/netperf/netperfpage.html. [16]R.Wolski.Dynamicallyforecastingnetworkperformanceusingthenetworkweatherser­vice.TechnicalReportTR-CS96-494,U.C.SanDiego,October1996.availablefrom 
http://www.cs.ucsd.edu/users/rich/publications.html. [17]R.Wolski.Dynamicallyforecastingnetworkperformancetosupportdynamicscheduling 
usingthenetworkweatherservice.InProc.6thIEEESymp.onHighPerformance DistributedComputing,August1997.toappear. 
			