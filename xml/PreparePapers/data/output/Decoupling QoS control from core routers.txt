
 a no o pro h se e r k(V ea w b e h m a haimsapo er esevinurringadditionalommuniationandproessingoverheads. 
Theseoverheadsanbereduedthroughanumberofon­trolstateredutiontehniques[6,16,17].Otherhop-by-hop reservationset-upprotoolshavealsobeenproposed[8,15]. 
Ingeneral,theonventionalhop-by-hopreservationset-up approahtiessuhQoSontrolfuntionsasadmissionon­trol,resourereservationandQoSstatemanagementtoore 
routers,whetherper-foworaggregateQoSstatesaremain­tainedatorerouters.Thereforeitrequiresadmissionon­trolandQoSstatemanagementmodulestobeinstalledat 
everyroutertosupportQoSprovisioning. IntheontextoftheDifServarhiteture,analternative, andperhapsmoreattrative,approah.thebandwidthbro­kerapproah.isproposedin[7]tosupporttheso-alled 
PremiumServie.Inthisapproah,admissionontrol,re­soureprovisioningandotherpoliydeisionsareperformed byaentralizedbandwidthbroker(BB)ineahnetwork 
domain.Althoughseveralimplementationefortsinbuild­ingbandwidthbrokersareunderway(see,e.g.,[14]),so farmanyissuesregardingthedesignofbandwidthbrokers, 
suhasadmissionontrolandQoSprovisioning,havenot beenaddressedadequatelyintheliterature.Forexample, undertheproposedBBarhiteturein[7],itappearsthat 
onlyoarse-grainQoSprovisioninganbesupportedand thatexpliitonfgurationoforeroutersisstillneededto provideQoSguarantees[14].Clearly,thedeliverableQoS 
performanewillhingeonhowfrequentlysuhonfguration isperformed.Inaddition,itisnotlearhowadmissionon­trolshouldbeperformedundersuhaBBarhiteture,in 
partiular,whetheroreroutersarestillrequiredtoperform loaladmissionontrolandQoSstatemanagement. Inthispaperwepresentanovelbandwidthbrokerarhi­tetureforsupportofQoSprovisioningthatdeouplesthe 
QoSontrolplanefromthedataforwardingplane.ThisBB arhitetureisdesignedundertheorestatelessframework, usingthetehniqueofdynamipaketstate[13].Under 
ourproposedBBarhiteture,theQoSreservationstates arestoredatandmanagedsolelybytheBB(s)inanetwork domain,andnoorminimalonfgurationoforerouters 
isrequired.Inotherwords,oreroutersareompletely relievedofQoSontrolfuntionssuhasadmissionon­trolandstatemanagement(whetherper-foworaggregate), 
makingthempotentiallymoreeÆient.Thisdeouplingof dataplaneandQoSontrolplaneisappealinginseveralas­pets.Amongothers,itallowsanetworkservieprovider 
tointroduenewQoSservieswithoutneessarilyrequir­ingsoftware/hardwareupgradesatorerouters.Further­more,aswewilldemonstrate,italsoenablesthedeployment 
ofsophistiatedQoSprovisioningandadmissionontrolal­gorithmstooptimizenetworkutilizationinanetwork-wide 
fashion.Suhnetwork-wideoptimizationisdiÆult,ifnot impossible,undertheonventionalhop-by-hopreservation 
set-upapproah. Theobjetiveofthispaperistodemonstratehowguaranteed servies(bothper-fowandlass-based)anbesupported 
usingtheproposedBBarhiteture,despitethefatthatno QoSstatesaremaintainedatorerouters.Wefousonguar­anteedserviespartlybeausetheseserviesarewell-defned 
andunderstood,andpartlybeauseaunifyingorestate­lessframework.thevirtualtimereferenesystem[20].has beendevelopedthatprovidesaQoSabstrationofthedata 
planeforsupportingguaranteeddelayandrateservies.Us­ingguaranteedserviesasexamples,weillustratehowad­missionontrolanbeperformedusingtheproposedBB 
arhiteturewithouttheassistaneoforerouters.Inpar­tiular,wedevelopapath-orientedapproahtothedesign ofeÆientadmissionontrolalgorithmsundertheproposed 
BBarhiteture.Weestablishthattheproposedbandwidth brokerarhitetureisapableofsupportingguaranteedser­vieswiththesamegranularityandexpressivepower(ifnot 
more)astheIntServ/GuaranteedServiemodel,despitethe fatthatallQoSreservationstatesareremovedfromore routersandmaintainedsolelyatthebandwidthbroker.This 
isahievedwithoutthepotentialomplexityandsalability problemsoftheIntServmodel. However,thebandwidthbrokerapproahtoQoSprovision­ingintroduesasetofnewissues.Inpartiular,thesala­bilityoftheBBarhiteture.itsabilitytomanagealarge 
numberofQoSontrolstatesandproessalargevolume ofuserfowQoSrequests.isanimportantissuethatmust beinvestigated.Topartiallyaddressthisissue,inthispa­perwealsoonsiderthesupportofoarse-grainlass-based 
guaranteedserviesusingtheproposedBBarhiteture.Via fowaggregation,thenumberofQoSstatesmaintainedby theBBanberedued,andtheomplexityofadmission 
ontroloperationsanbelowered,therebyenhaningthe proessingapaityoftheBB.However,intheontextof guaranteedservies,(dynami)fowaggregationanhavean 
1 undesirabletransientefetthatmayresultindelaybound violation,ifproperareisnottaken.Weillustratehowthis 
problemanbesolvedusingrelativelysimplemehanisms undertheproposedBBarhiteture. Ourworkisonlyafrststeptowardsaddressingmanyprob­lemsthatstillremaininthedesignandimplementationof 
theproposedBBarhiteture.Forexample,tofurtherim­provesalability,adistributed(orhierarhial)arhiteture onsistingofmultipleBBsmaybeneessarytosupportQoS 
provisioninginalargenetworkdomain.Suhanarhite­tureintroduesmanynewdesignandimplementationissues. Theproblemofinter-domainQoSreservationandservie­levelagreement[2,7]isanotherimportantissuethatmust 
beaddressed.Inaddition,supportingstatistialorother formsofQoSguaranteesusingtheproposedBBarhite­tureisalsoahallengingproblem.Clearly,alltheseissues 
mustbesatisfatorilyresolvedbeforetheproposedBBar­hitetureanbedeployedinpratie. Theremainderofthispaperisstruturedasfollows.Se­tion2outlinestheproposedbandwidthbrokerarhiteture, 
wherewealsobriefyreviewthevirtualtimereferenesys­temdevelopedin[20],andpresentahigh-leveloverviewof theadmissionontroloperationsundertheproposedBBar­hiteture.InSetion3,wedesigneÆientpath-oriented 
admissionontrolalgorithmsforper-fowguaranteedser­vies.Theseadmissionontrolalgorithmsareextendedin Setion4tosupportlass-basedguaranteedservieswith 
dynamifowaggregation.Simulationinvestigationison­dutedinSetion5,andthepaperisonludedinSetion6. 1 Thisphenomenonisnotuniquetotheorestatelessframe­work,andmayourinanyguaranteedservieswithdy­namifowaggregation. 
 Figure1:Illustrationofabandwidthbroker(BB) anditsoperationinaVTRSnetworkdomain. 2. OVERVIEW OF THE PROPOSED 
BAND-WIDTH BROKER ARCHITECTURE Inthissetionweoutlinetheproposedbandwidthbroker arhitetureforsupportofguaranteedservieswithinasin­glenetworkdomain.Thisbandwidthbrokerarhiteture 
isbuiltuponthevirtualtimereferenesystem(VTRS)de­velopedin[20],aorestatelessframeworkthatprovides aQoSabstrationofthedataplane.Undertheproposed 
BBarhiteture,oreroutersperformonlydataplanefun­tionssuhaspaketshedulingandforwarding,usingthe dynamipaketstatearriedinpaketheaders.NoQoS 
states,whetherper-foworaggregate,aremaintainedatany orerouters.Instead,allQoSstatesaresolelymaintainedat 
andmanagedbytheBB(s),noorminimalonfgurationof oreroutersisneeded.Furthermore,allQoSontrolplane funtionssuhasadmissionontrolandresourereserva­tionareperformedbytheBB(s),withoutinvolvementof 
orerouters.Figure1illustratesthebasiomponentsand operationsoftheproposedBBarhitetureaswellasits relationshiptothedataplane. 
AsshowninFigure1,abandwidthbroker2(BB)onsistsof severalserviemodules(i.e.,servers)suhasadmissionon­trol,routingandpoliyontrol.Theroutingmodulepeers 
withrouterstoobtainthetopologyinformationofthenet­workdomain[1]andisresponsibleforpathseletionand set-up(using,e.g.,MPLS[10]).Thepoliyontrolmod­ulemaintainsapoliyinformationbaseandisresponsible 
fornetworkpoliyadministration.Theadmissionontrol modulemaintainstheQoSstatesofthenetworkdomain, whiharestoredinseveralmanagementinformationbases 
(seeSetion2.2),andisresponsibleforadmissionontrol andresourereservation. Inthispaperwewillfousprimarilyontheoperationsof 
theadmissionontrolmoduleforsupportofguaranteedser­ Inthispaperweassumethatthereisasingleentralized BBforanetworkdomain.Inpratie,adistributedorhier­arhialarhitetureonsistingofmultipleBBsanbeem­ployedtoimprovereliabilityandsalability.Wewillexplore 
theseissuesinfutureresearh.Notethatanimportantad­vantageoftheBBapproahisthatthereliabilityandsal­abilityissuesoftheQoSontrolplane(i.e.,thebandwidth 
brokerarhiteture)anbeaddressedseparatelyfrom,and withoutinurringadditionalomplexityto,thedataplane. vies.Inpartiular,wewilldemonstratehoweÆientad­missionontrolanbeperformedundertheproposedBB 
arhiteture.Beforeweembarkontheproblemofadmis­sionontrolusingtheproposedBBarhiteture,weneed tounderstandthebasioperationsofthevirtualtimerefer­enesystemanditsimpliationonQoSprovisioning.Inthe 
following,wefrstbriefyreviewthevirtualtimereferene system,andthenpresentahigh-leveldesriptionofthead­missionontrolmoduleandtheQoSstateinformationbases 
itmaintains. 2.1 The Virtual Time Reference System Thevirtualtimereferenesystemisdesignedasaunify­ingshedulingframeworkbasedonwhihboththeper-hop 
behaviorsoforerouters(intermsoftheirabilitiestopro­videdelayandbandwidthguarantees)andtheend-to-end propertiesoftheironatenationanbeharaterized.This 
unifyingshedulingframeworkenablesorerouterstofous onpaketshedulingandforwardingfuntionsbasedonthe paketstatearriedinpaketheaderswithoutdiretinvolve­mentinQoSontrol.Thekeyonstrutinthevirtualtime 
referenesystemisthenotionofpaketvirtualtimestamps, whih,aspartofthepaketstate,arereferenedandup­datedaspaketstraverseeahorerouter.Paketvirtual 
timestampsareomputedusingonlythepaketstatear­riedbypakets(plusaoupleoffxedparametersassoiated withorerouters),andthusthevirtualtimereferenesys­temisorestateless. 
Coneptually,thevirtualtimereferenesystemonsistsof threelogialomponents:paketstatearriedbypakets, edgetraÆonditioningatthenetworkedge,andper-hop 
virtualtimereferene/updatemehanismatorerouters(see Figures2and3).Thesethreeomponentsarebriefyde­sribedbelow.Amoredetaileddesriptionanbefound 
in[20]. EdgeTraÆConditioning.EdgetraÆonditioning playsakeyroleintheVTRS,asitensuresthatthepakets ofafow3willneverbeinjetedintothenetworkoreata 
rateexeedingitsreservedrate.Formally,forafowjwith areservedraterj,theinter-arrivaltimeoftwoonseutive 
paketsofthefowatthefrsthoporerouterissuhthat j k+1j kj.k+"j k a-a:,where adenotesthearrivaltime 11 j1ofthekthpaketpj 
koffowjatthenetworkore,Lj kthe sizeofpaketpj k,andrjthereservedrateoffowj. PaketState.Aftergoingthroughtheedgeonditionerat 
thenetworkedge,paketsenteringthenetworkorearry intheirpaketheadersertainpaketstateinformationthat isinitializedandinsertedatthenetworkedge.Thepaket 
statearriedbypaketpj kofafowjontainsthreetypesof information:1)arate-delayparameterpair(rjj)ofthe fow,determinedbythebandwidthbrokerbasedonfow 
j k j'sQoSrequirement;2)thevirtualtimestampw ofthe paketthatisassoiatedwiththerouteriurrentlybeing j 
k traversed(itisinitializedto a1,theatualtimeitleaves theedgeonditionerandentersthefrstorerouteralong 
thefow'spath);and3)thevirtualtimeadjustmentterm 3 Hereafowanbeeitheranindividualuserfow,oran aggregatetraÆfowofmultipleuserfows,defnedinany 
appropriatefashion.  Figure2:Aoneptualnetworkmodelinthevirtual timereferenesystem. Æj k ofthepaket,aparameterthatisomputedattheedge 
andusedtoensurethatthevirtualspaingproperty(see below)ofvirtualtimestampsissatisfed[20]. VirtualTimeReferene/UpdateMehanismandPer­HopRouterBehaviorCharaterization.Intheon­eptualframeworkofthevirtualtimereferenesystem,eah 
orerouterisequippedwithaper-hopvirtualtimerefer­ene/updatemehanismtomaintaintheontinualprogres­sionofthevirtualtimeembodiedbythepaketvirtualtime 
stamps.Thisvirtualtimestampwj krepresentsthearrival timeofpaketpj koffowjattheithorerouterinthe virtualtime,andthusitisalsoreferredtoasthevirtual 
arrivaltimeofthepaketattheorerouter.Thevirtual timestampswj k'sassoiatedwithpaketsoffowjsatisfy thefollowingtwoimportantproperties:1)virtualspaing 
j.k+" j k+1j k property:w-w:j,and2)therealityhek j kj kj k property:a:w,whereadenotestheatualarrival 
timeofpaketpj katrouteri. Inordertoensurethatthesetwopropertiesaresatisfed, thevirtualtimestampsmustbeappropriatelyreferenedor 
updatedaspaketsenterorleaveaorerouter.Therefer­ening/updatingruledependsontheshedulingalgorithm (orsheduler)employedbyaorerouter.Wedistinguishtwo 
typesofshedulers:rate-basedanddelay-based,depending onhowthevirtualdeadlineandvirtualfnishtimeareom­putedforpaketstraversingit.Forexample,ifthesheduler 
Sattheithrouterisrate-based,paketpj kisassoiated wj k=Lj k/rj+Æj k withthevirtualdeadlineanditsvirtual 
vj kj kwj k fnishtimeisdefnedasw=w+.Whereas,ifSis wj kjj kj kwj k delay-based,=andvw=w+. Theper-hopbehaviorofaorerouter(orrather,itsshed­uler)isharaterizedbyanerrorterm,whihisdefned 
withrespettothevirtualfnishtimeandatualfnishtime a jj k ofpaketsattherouter.Letdenotetheatualtime paketpj 
kdepartstheshedulerS.WesaythatSan guaranteefowjitsreservedraterj(ifSisrate-based)or itsdelayparameterj(ifSisdelay-based)withanerror 
a jj kvj k term\,ifforanyk,:w+\.Inotherwords, eahpaketoffowjisguaranteedtodepartSbythetime vj kj kwj 
k w+\=w++\. Figure3:Virtualtimereferenesystem:per-hop behaviorandoperations. Giventheerrorterm\oftheshedulerS,thevirtualtime 
stampofpaketpj kafterithastraversedSisupdatedusing thefollowingonatenationrule: j kj kj kwj k w +1=vw+\+7=w++\+7(1) 
where7denotesthepropagationdelayfromtheithrouter tothenext-hoprouteralongthefow'spath.In[20]itis shownthatusingtheonatenationrule(1)thevirtualspa­ingandrealityhekpropertiesofvirtualtimestampsare 
satisfedateveryrouter. End-to-EndDelayBoundandQoSAbstrationof DataPlane.Usingthevirtualtimereferenesystemout­linedabove,thedelayexperienedbypaketsofafowaross 
thenetworkoreanbeupperboundedintermsoftherate­delayparameterpairofafowandtheerrortermsofthe routersalongthefow'spath.Supposetherearetotalh 
hopsalongthepathoffowj,ofwhihqroutersemployrate­basedshedulers,andh-qdelay-basedshedulers.Then foreahpaketpj 
koffowj,wehave Lj max j kj k a- a<dj=qrj +)h-q)dj+)\+7),)2) 1 Lj max whereisthemaximumpaketsizeoffowj. 
SupposethetraÆprofleoffowjisspeifedusingthestan­ jj max) darddual-tokenbuketregulator(ajpjpLwhere ajLj 
maxpj :isthemaximumburstsizeoffowj,isthe sustainedrateoffowj,isthepeakrateoffowj.Then pjthemaximumdelaypaketsoffowjexperienedattheedge 
shaperisboundedby pjjLj max -r j=Tj+(3) n jj rr TjajLj max)/(pjpj where n=(--).Henetheend-to-end delayboundforfowjisgivenby 
jj d=d+dj 2  pj-rjLj max =Tjh-q)dj+ n+)q+1)+))\+7))4)( rj rj Observethattheend-to-enddelayformulaisquitesimi-lartothatspeifedintheIETFGuaranteedServieusing 
theWFQasthereferenesystem.Inthissense,thevirtual timereferenesystemprovidesaoneptualorestateless frameworkbasedonwhihper-hopbehavior(i.e.,itsabil­itytosupportdelayguarantees)ofaorerouteranbe 
haraterizedusingthenotionoferrorterm.Thissimple abstrationenablesustoderiveend-to-enddelayboundsfor fowstraversinganarbitraryonatenationoforerouters 
withinanetworkdomain.Furthermore,thevirtualtime referenesystemdoesnotmandateanyspeifsheduling mehanismstobeimplementedinanetworkdomainaslong 
astheirabilitiestoprovidedelayguaranteesanbehara­terizedusingthenotionoferrorterm.Infat,in[20]itis shownthatalmostallknownshedulingalgorithmsanthus 
beharaterized,betheyorestatelessorstateful.Inaddi­tion,thevirtualtimereferenesystemleadstothedesign ofasetofneworestatelessshedulingalgorithms(both 
rate-basedanddelay-based).Tworepresentativeexamples ofsuhorestatelessshedulingalgorithmsare:therate­basedorestatelessvirtuallok(C 
$VC)anddelay-based virtualtimeearliestdeadlinefrst(VT-EDF)shedulingal­gorithms. Theorestatelessvirtuallok(C$ 
VC)isawork-onserving ounterpartoftheCJVCshedulingalgorithmdeveloped in[12].Itserviespaketsintheorderoftheirvirtualfnish 
times.Itisshownin[20]thataslongasthetotalreserved rateoffowstraversingaC $VCshedulerdoesnotexeed itsapaity(i.e., 
rj:C),thentheC$ VCsheduler janguaranteeeahfowitsreservedraterjwiththemini- L *max/C,L *max mumerrorterm\=whereisthelargest 
paketsizeamongallfowstraversingtheC $VCsheduler. Unliketheonventionalrate-ontrolledEDF,VT-EDFsup­portsdelayguaranteeswithoutper-fowrateontrol,and 
thusisorestateless.LikeC $VC,VT-EDFalsoservies paketsintheorderoftheirvirtualfnishtimes.TheVT­EDFsheduleranguaranteeeahfowitsdelayparameter 
j L *max/C, withtheminimumerrorterm\=ifthefol­lowingshedulabilityonditionissatisfed[20]: N j jj max 
[r(t-)+L]1{t.j}:Ctforanyt:0(5) j=1 whereweassumethatthereareNfowstraversingtheVT­ 12N EDFshedulerwith0::: 
:.Theindiator j funtion1{t.j} =1ift:,0otherwise. 2.2 The Admission Control Module: QoS State Information 
Bases and Basic Operations Inordertosupportguaranteedserviesundertheproposed bandwidthbrokerarhiteture,theadmissionontrolmod­ulemaintainsseveralQoSstateinformationbases.They 
inlude:1)afowinformationbase,whereinformationre­gardingindividualfows,suhasfowid.,traÆprofle(e.g., jj 
jj max (appL)),servieprofle(e.g.,end-to-enddelay requirement),andQoSreservation(e.g.,therate-delay Dj 
parameterpair(rjj)),ismaintained;2)anodeQoSstate informationbase,whereinformationregardingeahrouter inthenetworkdomain,suhasthebandwidth,bufera­paity,typeofshedulerused(i.e.,rate-ordelay-based)and 
itserrorterm,andurrentQoSreservationoneahoutgoing linkoftherouter,ismaintained;and3)apathQoSstate informationbase,whereinformationregardingthehara­teristisofpathsbetweeningressandegressroutersismain­tained.Examplesofpathharateristisarethehopnumber 
ofapath,thesumoftheroutererrortermsandpropagation delayalongthepath,andtheminimalresidualbandwidth alongthepath.Asweshallseeinthenextsetion,main­tainingseparatepath-levelQoSstateinformationallowsus 
toperformeÆientadmissibilitytestonanentirepathbasis. WenowbriefydisribethebasioperationsoftheBB, fousing,inpartiular,onthoseoftheadmissionontrol 
module(seeFigure1).WhenanewfowwithatraÆpro­ jj jj max fle(appL)andanend-to-enddelayrequirement Djq arrivesataningressrouter,theingressroutersendsa 
newfowservierequestmessagetotheBB.Uponreeiving theservierequest,theBBfrstheksforpoliyinforma­tionbasetodeterminewhetherthenewfowisadmissible. 
Ifnot,therequestisimmediatelyrejeted.Otherwise,the BBseletsapath(fromtheingressroutertoanappropri­ateegressrouterinthenetworkdomain)forthenewfow, 
anddeidewhetherthefowanbeadmitted.Generally speaking,theadmissionontrolproedureonsistsoftwo phases:1)admissibilitytestphaseduringwhihitisdeter­minedwhetherthenewfowservierequestanbeaom­modatedandhowmuhnetworkresouresmustbereserved 
ifitanbeaommodated;and2)bookkeepingphaseduring whihtherelevantmanagementinformationbaseswillbe updated,ifthefowisadmitted.Ifthefowisadmitted,the 
BBwillalsopass(using,e.g.,COPS[3])theQoSreservation informationsuhas(rjj)totheingressrouter,sothatit 
ansetupaneworre-onfgureanexistingedgeonditioner (whihisassumedtobeo-loatedattheingressrouter)for thenewfow.Asthepaketsofthefowarriveattheingress 
router,theedgeonditionerwillappropriatelyinitializeand insertthesepaketstates,beforeinjetingthemintotheore 
ofthenetworkdomain. IntheremainderofthispaperwedemonstratehoweÆient admissionontrolanbeperformedundertheproposedBB 
arhiteture.InSetion3wepresentapath-orientedap­proahtoperformeÆientadmissionontroloperationsfor supportofper-fowguaranteedservies.Unliketheonven­tionalhop-by-hopapproahwhihperformsadmissionon­trolindividuallybasedontheloalQoSstateateahrouter 
alongapath,thispath-orientedapproahexaminesthere­soureonstraintsalongtheentirepathsimultaneously,and 
makesadmissionontroldeisionaordingly.Clearly,suh apath-orientedapproahisonlypossiblebeausetheavail­abilityofQoSstateinformationoftheentirepathattheBB. 
Notethatalthoughanybandwidthbrokerarhiteturean adoptasimilarpath-orientedapproahtoresourealloa­tion,underourBBarhiteturenoloaladmissionontrol 
testorexpliitresoure(re-)onfgurationisneededatany orerouter,thankstotheuseofdynamipaketstateinthe datapath.Asaresult,weansignifantlyreduethetime 
ofondutingadmissionontrolandresourereservation. Furthermore,weanalsoperformpath-wideoptimization whendeterminingresourealloationforanewfow.In 
Setion4,westudytheproblemofadmissionontrolfor lass-basedguaranteeddelayservies,whereafxednumber ofguaranteeddelayservielassesareoferedinanetwork 
domain.AsintheDifServ,therearetwoimportantbene­ftsinprovidinglass-basedserviesunderourframework. First,aggregatingfowsinasmallnumberofservielasses 
greatlysimplifestheimplementationofthedataplane(in partiular,theedgeonditioners).Seond,italsoenhanes 
thesalabilityoftheQoSontrolplane(i.e.,theBBar­hiteture).Forexample,thenumberofQoSstatesthat needtobemaintainedbyaBBanbesignifantlyre­dued.Thisleadstofasteradmissionontroloperations, 
therebyinreasingthenumberoffowservierequestsaBB anhandle.However,aspointedoutintheintrodution,in lass-basedguaranteedserviesertaintransientbehaviorof 
dynamifowaggregationmustbetakenareoftoavoidpo­tentialdelayboundviolation.InSetion4,weinvestigate theproblemofdynamifowaggregationanddeviesimple 
mehanismstoefetivelyirumventthisproblem.  3. ADMISSION CONTROL FOR PER-FLOW GUARANTEED SERVICES Inthissetion,westudytheproblemofadmissionontrolfor 
supportofper-fowguaranteedserviesundertheproposed bandwidthbrokerarhiteture.Inpartiular,wepresenta path-orientedapproahtoperformeÆientadmissionon­troloperations.Weillustratehowthisapproahworksby 
frstonsideringasimplease,whereonlyrate-basedshed­ulersareemployedalongthepathofanewfow.Wethen lookatthegeneralasewherethepathofanewfowonsists 
ofbothrate-basedanddelay-basedshedulers.Wepresent aneÆientadmissionontrolalgorithmthat1)determines whetheranewfowisadmissiblebyexaminingtheresoure 
onstraintsalongtheentirepathsimultaneously,and2)min­imizesthebandwidthalloationalongthepathforthenew 
fow,ifitisadmissible. 3.1 Path with Only Rate-based Schedulers Wefrstonsiderthesimpleasewhereweassumethat 
thepathPforanewfowvonsistsofonlyrate-based shedulers.Heneinthisase,weonlyneedtodetermine V whetherareservedrateranbefoundforthenewfow 
V forittobeadmitted.Thedelayparameterwillnot beused.Forsimpliityofexposition,weassumethata shedulersuhasore-statelessvirtuallok(C$VC)orore­jittervirtuallok(CJVC)isemployedattheroutersS 
alongP.LetFbethesetoffowsurrentlytraversing S,andCbethetotalbandwidthatS.Thenaslongas rj:C,Sanguaranteeeahfowjitsreserved 
jE.; j rater.WeuseC.; todenotetheresidualbandwidthat C.;j S,i.e.,=C-r. jE.; VV V Let(appLV max)bethetraÆprofleofanewfowv, 
andDV q beitsend-to-enddelayrequirement.Lethbethe numberofhopsinP,thepathforthenewfow.From(4), DV q inordertomeetitsend-to-enddelayrequirement, 
V thereservedraterforthenewfowvmustsatisfy: VVV p:r:p and VVLV max p-r VqV r D :Tn+(h+1)+Dt t(6) rV rV 
VLV maxVV whereTV=(a-)/(p-p)andDr=(\+ n t tEr 7). V Furthermore,rmustnotexeedtheminimalresidualband­widthCr 
alongpathP,whereCr =minErC.; ismain­tained,asapathQoSparameterassoiatedwithP,inthe pathQoSstateMIB. VV 
V Letrm nbethesmallestrthatsatisfes(6),i.e.,rm n = VLV max]/[DVq [TVp+(h+1)-Dr+TV].Defne n t tn l WVVupVr 
r a =max{prm nJandr=min{pC J a l W up R* Then=[rr]isthefeasibleraterange,from a a aV whihafeasiblereservedrateranbeseleted.Clearly,if 
R* isempty,theservierequestofthenewfowvmust a V l W berejeted.Otherwise,itisadmissible,andr=ris a theminimalfeasiblereservedrateforthenewfowv.Given 
thatthepathQoSparametersDrandCrassoiatedwith t t ParemaintainedinthepathQoSstateMIB,theabove admissibilitytestanbedonein0(1). 
 3.2 Path with Mixed Rate-and Delay-based Schedulers WenowonsiderthegeneralasewherethepathPfor anewfowvonsistsofbothrate-basedanddelay-based 
shedulers.Inthisase,weneedtodeterminewhethera VV) rate-delayparameterpair(ranbefoundforthenew fowvforittobeadmitted.Beauseoftheinter-dependene 
V V ofthereservedraterandthedelayparameterinthe end-to-enddelaybound(4)aswellasthemoreomplex shedulabilityondition(5)forthedelay-basedshedulers, 
theadmissibilitytestforthisaseislessstraightforward.In thissetion,wepresentaneÆientadmissionontrolalgo­rithmusingthepath-orientedapproahthatminimizesthe 
bandwidthalloationalongthepathofthenewfow:ifthe newfowvisadmissible,thisadmissionontrolalgorithm VV 
fndsafeasiblerate-delayparameterpair(r)suhthat V ristheminimalfeasiblerate.Inotherwords,noother V'V'V'V 
 rate-delayparameterpair(r)suhthatr<ris feasible. Letqbethenumberofrate-basedshedulersandh-qthe numberofdelay-basedshedulersalongpathP.Forsimpli­ityofexposition,weassumethattherate-basedshedulers 
SalongpathPemployC$VC(oranysimilar)shedul­ingalgorithmwhoseshedulabilityonditionisrj: jE.; C,whereasthedelay-basedshedulersSemploytheVT­EDFshedulingalgorithm,whoseshedulabilityondition 
isgivenin(5). VV VV max Asbefore,let(appL)bethetraÆprofleofthe DV q newfowv,anditsend-to-enddelayrequirement.In 
orderforthenewfowvtobeadmittedalongthepath VV Pwitharate-delayparameterpair(r),itsend-to-end DV q delayrequirementmustbesatisfed,namely, 
VVV p:r:p and VVLV max p-r VqV Vr D :Tn+(q+1)+(h-q)+Dt t (7) rV rV Furthermore,theshedulabilityonditionateahsheduler 
Smustnotbeviolated.LetCr betheminimalresidual bandwidthalongP,i.e.,Cr =minErC.; .Thenfrom theshedulabilityonditionsfortherate-anddelay-based 
VCr shedulers,wemusthaver: .Inaddition,forevery kk delay-basedshedulerSalongP,let(r)betherate­delayparameterpairoffowk,wherekF.Thenforeah 
"[DV.r q O.tV= -D +TV1 h-qtoton *<di* -"V 1.Letm*suhthatdit * 2....m=m*,m-1,,2,1 Rii. i.r 3. [ ,1 4.i. 
,i.r1 Ri [ i 5...(RiR==0) i.ri. 6. ..(Ri==011Ri) ==011 7. .....withdV=di ii 8...../*RR =0*/ i. i. 9. 
..( ) i. 1O. V ,dV tV-gV rV 11. .....withdV 12...(dVtV)nofeasiblevaluefound 13...........dV Figure4:Path-orientedadmissibilitytestfor 
mixedrate/delay-basedshedulers. kV kF,SPsuhthat:,wemusthave jLj maxl [rj)dk -d)+ j k ;; {jE.;: } LV maxl 
+[r V)dk -dV)+< dk()8) VV Hene,inorderfor(r)tobeafeasiblerate-delaypa- V rameterpairforthenewfowv,wemusthavethatr 
VVrVV [pmin{pCJ]andthatrandmustsatisfy(7)and (8). Inthefollowing,wepresentaneÆientalgorithmtoiden- VV 
tifythefeasiblerate-delayparameterpair(r)foranew V fowv.First,weintroduesomenotation.Defnet= 1(DVq1 VLV 
max]. -Dr+TV),SV = -q[TVp+(q+1)From(7)weseethatthefollowingonditionholds, SV -qt tn n VV :t-(9) rV Foranyfowktraversingadelay-basedshedulerSsuh 
kV that:,defne kk jkjj max 8=C-[r(-)+L] k ;; {jE.;:j } l LetFbetheunionofthesetsofthefowsatallthedelay­ 
l basedshedulersalongthepathPoffowv,i.e.,F= U{jF:Sisdelay-basedJ.Supposethereareatotalof Mdistintivedelayparametersassoiatedwiththefowsin 
l F.LetthesedistintiveMdelayparametersbedenoted 12 M12M by,where0:<<<.For m=12M,defne km 8m =min{8k :kFand=Sisdelay-basedJ 
8k k Notethatdenotestheminimumresidualservieover anytimeintervaloflengthatshedulerS.Therefore 8mrepresentstheminimalresidualservieamongallthe 
m 8m m delay-basedshedulersattime.Henewerefertoas theminimalresidualservieofpathPattime. OM+1 Defne=0and=0.Thenifthenewfowv 
isadmissible,theremustexistarate-delayparameterpair VVm-1 (r V),where[m)forsomem=12M+ 1.From(9),itislearthat0::t.Letm 
* besuhthat ** VV* m-1Vm m *-1m <t:.Clearly,[)istherightmost V delayintervalthatmayontainafeasible. interval 
shrinking interval moving towards left at each iteration at each iteration Rm Rm del fea m,l m,r m,l 
m,r rate [ ][] r rrr del del fea fea  delay d. t . (constant) Figure5:TherelationshipbetweenfeasiblerangeRm 
a anddelayonstraintrangeRm l. * m lm m *Rm Form=m-121,defne=[rr], aaa where 3V m l r=max{ ,V}, a tVdm-1 
- 3V m Vr r=min{ ,p,}()10) a tVdm - m lm Similarly,defneRm l =[rr],where ll {} 3V+LV maxSk-3V-LV max 
m r=minmin{},min , *tV* dk lm k m-dkkm-tV Sk3VLV max m l r=max *{--} )11) l m k mdk-tV RmRm andhavethefollowingimportantmonotoniity 
properties,asillustratedinFigure5.Whenwemovefrom al m-1m theurrentdelayinterval[)tothenextdelayin­ m-2m-1 
 tervaltotheleft[),theorrespondingfeasible raterangeRmdeterminedby(10)shiftstotheleft.In aontrast,theorrespondingfeasibleraterangeRmdeter­ 
l minedbythedelayonstraints(11)shrinks:theleftedge m lm rinreaseswhiletherightedgerdereases.(Foran 
l l explanationwhythesepropertieshold,see[21].)Basedon thisobservation,weobtainthefollowingtheorem,whih 
VV stateswhetherafeasiblerate-delaypair(r)existssuh Vm-1m that[]. Rmm THEOREM1.IfRisempty,thennofeasible 
al VV)Vm-1m]. rate-delaypairs(rexistsuhthat[ m Rm Rm m l  Furthermore,ifaisempty,orlisempty,orr a < 
r,thennointervalstotheleftontainafeasiblesolution lVV either.Morepreisely,nofeasiblerate-delaypairs(r) 
Vm). existsuhthat[0 Rmm IfRisnotempty,thenafeasiblerate-delaypair al VVVm-1m  (r)existssuhthat[].Furthermore,if 
m lm lVm l r<r,thenr=risthesmallestratesuhthat al l VVV thereexistssome :0forwhih(r)isafeasiblerate- 
VV delaypair.Inotherwords,anyrate-delaypair(r)where Vm l r<rlisnotfeasible. BasedonTheorem1,theadmissionontrolalgorithmispre­sented(inpseudo-ode)inFigure4.Notethatthetimeom­plexityofthealgorithmis0(M),andingeneral,wehave 
l M: IFI:IFI.Henetheomplexity s;isdelay-based ofthealgorithmhingesonlyonthenumberofdistintivede­layparameterssupportedbytheshedulersalongthepath 
ofthenewfow.Thisredutioninomplexityanbesignif­iantifmanyfowshavethesamedelayrequirements.This ispartiularlytheasewhenweonsiderlass-basedadmis­sionontrolwithfowaggregationwhereanumberoffxed 
delaylassesarepre-defned.Clearlythisredutioninom­plexityisahievedbeauseouradmissionontrolalgorithm onsidersalltheadmissibilityonstraintsalongapathsi­multaneously.Thisisnotpossibleusingtheonventional 
hop-by-hopreservationset-upapproah(e.g.,asemployed intheIETFIntServmodelwithRSVP).  4. CLASS-BASED 
GUARANTEED SERVICES AND ADMISSION CONTROL WITH DY-NAMIC FLOW AGGREGATION Inthissetionweaddresstheproblemofadmissionon­trolforlass-basedguaranteedserviesundertheproposed 
BBarhiteture.Thelass-basedguaranteeddelayservie modelisshematiallyshowninFigure6.Anewuserfow willbeplaedinoneofthedelayservielassesifitan 
beadmittedintothenetwork.Allfowsinthesamedelay servielassthattraversethesamepathwillbeaggregated intoasinglemarofow.Thismarofowisshapedusingan 
aggregatereservedrateattheedgeonditioner,andisguar­anteedwithanend-to-enddelaybounddeterminedbythe servielass.Werefertotheindividualuserfowsonsti­tutingamarofowasthemirofows. 
Akeyissueinthedesignofadmissionontrolforthislass­basedserviemodelistheproblemofdynamifowaggre­gation.Thedynamisomesfromthefatthatmirofows 
mayjoinorleaveamarofowatanytime.Henetheag­gregatetraÆprofleforthemarofowmayhangedynam­ially,andasaresult,thereservedrateforthemarofow 
mayneedtobeadjustedaordingly.Dynamifowaggre­gationanauseertainundesirableefetontheend-to-end delayexperienedbythemarofow,whihwewilldesribe 
shortlyinSetion4.1.Herewenotethattheexistingwork ontraÆaggregation(inpartiular,intheontextofguar­anteedservies,see,e.g.[6,9])hasimpliitlyassumedstati 
fowaggregation:amarofowisanaggregationofnfxed mirofows,withnonewmirofowsjoiningorexistingon­stituentmirofowsleavinginthedurationofthemarofow. 
Asfarasweareaware,thisproblemofdynamifowaggre­gationhasnotbeenidentifednoraddressedbeforeinthe literature. 
 4.1 Impact of Dynamic Flow Aggregation on End-to-End Delay Inthissetionweillustratethepotentialnegativeimpat 
ofdynamifowaggregationonend-to-enddelayguaran­teeprovisioning:ifproperareisnottaken,mirofowar­rivalsordeparturesinanaggregatemarofowanause 
potentialdelayboundviolation.Weuseanexampletoil­lustratethisproblemofdynamifowaggregation.Firstlet usintroduesomenotationandassumptions.Considera 
marofowawhihurrentlyonsistsofnmirofows.Let jj jj max (appL)bethetraÆprofleofthemirofowj, 1:j:n.Forsimpliity,wewilluseadual-tokenbuket 
UUUU max regulator,(appL),astheaggregatetraÆpro- Unj fleforthemarofowa.Henewehavea=a, j=1UnjUnjLU maxnLj 
max p=p,p=p,and=. j=1j=1j=1LU maxnLj max Notethat= j=1,asapaketofthemaxi­mumsizemayarrivefromeahofthenmirofowatthe 
sametime.Inontrast,sineonlyonepaketfromthe marofowamayleavetheedgeonditioneratanygiven time,the"maximumburst"themarofowmayarryinto 
nLj max thenetworkoreismaxj=1.LetPdenotethepathof max Lr themarofowa,anddenotethemaximumpaket max LrnLj 
max sizepermissibleinamarofowalongP.Then: maxj=1.Withoutlossofgenerality,weassumethat max Lr isfxed. 
Supposethatwetreatthemarofowaasstati,i.e.,withno UU mirofowsjoiningorleavingatanytime.Let(r)be therate-delayparameterpairreservedforthemarofow. 
Forsimpliity,assumethatpathPonsistsofonlyrate­basedshedulers(hofthemintotal).Thenfromtheend­to-enddelayformula(4),theend-to-enddelayexperiened 
bypaketsfromthemarofowaisboundedby dUdU+dU = 2 UULU maxLrmax =TUp-r++h+ r)12) n t t UUU rrr Dr wheret 
t = Er(\+7). Assumethatanewmirofowvjoinstheexistingmarofow * VVVV max) aattimet.Let(appLbethetraÆpro­fleofthenewmirofow.Denotethe"new"marofow 
afterthemirofowvhasbeenaggregatedby,andlet at U 'U 'U 'U ' max (a ppL)beitstraÆprofle.Supposethat U thereservedrateforthe"new"marofowinreasesfromr 
U ' tor attimet * . Wefrstshowthatthepaketsfromthe"new"marofow mayexperieneaworst-asedelayattheedgeonditioner 
''' U ' TU 'piii.i . - thatislargerthan= ni'+ i'.This anhappen,forexample,inthesenarioshowninFigure7. 
Inthissenario,TUn:TV n,andthusTV n:TUn':TU. Weassumethatalltheonstituentmirofowsoftheex­istingmarofowastartatthesametime(i.e.,time0) 
andaregreedy:theydumpthemaximumallowedburst intothenetworkatanytimet,i.e.,AU(0t)=[U(t)= U LU maxU min{pt+pt+aUJ.Thenewmirofowvjoins 
* TUTV theexistingmarofowaattimet= n -n,anditis *AV *[V* alsogreedy:atanytimet:t,(tt)=(t-t)= V * LV maxV*V 
min{p(t-t)+p(t-t)+aJ.Thenitisnot diÆulttoseethatattimet=TUn,thetotalamountof traÆthatisqueuedattheedgeonditionerisgivenby 
U UUVUU ' VU ' max Q(t) =(p-r)Tn+(p+r-r)Tn+L Henethedelayexperienedbyapaketarrivingtheedge onditionerattimet=TUnwillbeatleastQ(t)/rU 
' ,whih U ' anbeshowntobelargerthaningeneral.Thislarger delayisausedbythefatthatatthetimeanewmirofow 
isaggregatedintoanexistingmarofowfow,thebuferat theedgeonditionermaynotbeempty.The"old"pak­etsqueuedthereanausethe"new"paketstoexperiene 
U ' additionaldelaythatisnolongerboundedby. Wenowonsiderthedelayexperienedbypaketsfromthe "new"marofowinsidethenetworkore.Despitethe 
at microflows macroflows . . class 1 . . .  scheduler . . . scheduler . . . class K .  Core Router 
Core Router Edge Conditioners Figure6:Class-basedguaranteedservies:dynami fowaggregationalongapath. fatthatpaketsfromthe"new"marofowa 
t areservied U ' U withahigherreservedrater(:r),someofthesepakets mayexperieneaworst-asedelayinthenetworkorethat 
U ' Umax/rU Dr isboundedby =hLr+t t,notby = max +Dr hLr/rU ' t t.Intuitively,thisanhappenbeausethe paketsfromthe"new"marofowmayathupwiththe 
lastpaketsfromthe"old"marofow.Consideringboththe delayattheedgeonditionerandthatinthenetworkore, weseethatpaketsofthe"new"marofowmayexperiene 
anend-to-enddelaythatisnolongerboundedbytheend­to-enddelayformula(12).Asimilarsituationmayour whenaonstituentmirofowleavesanexistingmarofow, 
U ifweimmediatelydereasethereservedratertoanew U ' lowerreservedrater(see[21]fordetails). Beforeweleavethissetion,wewouldliketoommentthat 
theproblemofdynamifowaggregationisnotuniqueto thevirtualtimereferenesystemusedinthispaper.The sameproblemexistsinamoregeneralontext.Forexam­ple,dynamifowaggregationwillhavethesameefeton 
anetworkofWFQshedulers,thereferenesystemusedin theIntServmodel.Thisisbeausethesituationhappening attheedgeonditionerdesribedabovewillalsoapplytoa 
WFQsheduler.Itappearsthatthisproblemmightbemore diÆulttoaddressusingtheonventionalhop-by-hopreser­vationset-upapproah.Inthefollowingweshowhowthis 
problemanbesolvedusingrelativelysimplemehanisms undertheproposedBBarhiteture.  4.2 End-to-End Delay 
Bounds under Dynamic Flow Aggregation Inthissetionwepresentnewmehanismstoefetivelyir­umventtheproblemsausedbydynamifowaggregation. 
Thebasiobjetiveofourapproahistoenabletheband­widthbrokertomakeadmissionontroldeisionsatany giventime,usingonlythetraÆprofleandreservedrate 
ofthemarofowatthattime.Inotherwords,wedonot wantthebandwidthbrokertomaintainanelaboratehis­toryreordofthemirofowarrivalanddepartureeventsof 
amarofow. 4.2.1 Contingency Bandwidth and Edge Delay Bound Arrival process a+ . L ,max La a . a 0 T 
T TTime onon on . T on Figure7:Anexampleillustratingtheedgedelay boundviolationafterratehangeindynamifow 
aggregation. Weintroduethenotionofontingenybandwidthtoelimi­natethelingeringdelayefetofthebaklogqueuedinthe 
edgeonditioneratthetimeamirofowisaggregatedinto orde-aggregatedfromanexistingmarofow.Itworksas follows:Supposeattimet 
* amirofowvjoinsorleaves U anexistingmarofowa.Besidesthereservedraterbe- U ' ingadjustedtoanewreservedrateratt 
* ,aontingeny V bandwidth!risalsotemporarilyalloatedtotheresult­ing"new"marofowa tforaontingenyperiodofTVtime 
V units.Theontingenybandwidth!randontingenype­riodishoseninsuhamannerthatthemaximumdelay TV intheedgeonditionerexperienedbyanypaketsfromthe 
"new"marofowa taftertimet * isboundedaboveby U ' n W l :max{J(13) l wheredenotesthemaximumedgedelayboundonthe 
U ' U ' "old"marofow(i.e.,beforet * )and=TU n'(p-U ' +LU ' max r)/rU ' /rU ' . ThefollowingtwotheoremsstatethesuÆientonditions 
V on!randTV sothat(13)holds(see[21]fortheirproofs). THEOREM2(MIROFLOWJOIN).Supposeattimet * a VV VV max 
newmirofowvwiththetraÆprofle(appL) U ' VU joinsanexistingmarofowa.Letr=r-randQ(t * ) bethesizeofthebaklogintheedgeonditionerattimet 
* . Then(13)holdsif * VVVVQ(t) !r:p-randT: (14) !rV THEOREM3(MIROFLOWE VE).Supposeattimet * VV VV max 
amirofowvwiththetraÆprofle(appL) U ' VU * leavesanexistingmarofowa.Letr=r-randQ(t) bethesizeofthebaklogintheedgeonditionerattimet 
* . Then(13)holdsif * ) VVQ(t V !r:randT: (15) !rV TVknowthebaklogQ(t * )intheedgeonditionerattimet 
* . Sineattimet * themaximumdelayattheedgeonditioner isboundedby,wehave Toomputetheontingenyperiodpreisely,weneedto 
*l* lUU* Q(t):r(t)=(r+!r(t))(16) wherer(t * )istotalbandwidthalloatedtothemarofow attimet * ,whihinludesthereservedrater 
Uandthetotal ontingenybandwidth!r U(t * )alloatedtothemarofow aattimet * .GiventhisupperboundonQ(t * 
),theBBan determineanupperboundaontheontingenyperiod TV TV asfollows: U Vlr+!r U(t * ) Ta= (17) !rV TV 
V* Hene aftera,theBBande-alloatetheontingeny TV TV bandwidth!rattimet+a.Werefertothismethodof determiningontingenyperiodasthe(theoretial)on­tingenyperiodboundingapproah.Ingeneralthissheme 
anbequiteonservative. Amorepratialapproahistohavetheedgeonditionerto feedbaktheatualontingenyperiodtotheBBbasedon 
theurrentbuferoupanyofthemarofowattheedge onditioner.Werefertothisshemeastheontingenyfeed­bakmethod.Notealsothatwheneverthebuferintheedge 
onditionerbeomesempty,thelingeringdelayefetofthe oldmarofowhasgoneaway.Hene,themaximumdelay experienedbyanypaketsofthemarofowaisbounded 
U by,whihissolelydeterminedbytheurrentaggre­gatetraÆprofleofthemarofowa.Therefore,theedge onditioneransendamessagetotheBBtoresetallofthe 
ontingenybandwidthalloatedtothemarofowa(i.e., U setting!r=0)beforeaontingenyperiodexpires. 4.2.2 Extension 
to VTRS and Core Delay Bound AsdisussedinSetion4.1,paketsofthenewmarofow mayathupwiththepaketsoftheoldmarofowinside 
thenetworkoreandheneexperieneadditionalqueueing delay.Inthissetionweillustratehowthevirtualtimeref­erenesystemanbeextendedtoaommodatefowaggre­gationwithdynamiratehanges.Basedonthisextension, 
wepresentamodifedore-delayboundforfowaggregation. ConsideranexistingmarofowawhihtraversesthepathP wherethereareqrate-basedshedulersandh-qdelay-based 
shedulers.Inordertosimplifythederivationofthedelay experienedbypaketsinsideanetworkore,weimpose U anassumption:thedelayparameterassoiatedwitha 
marofowaisfxed,nomatterwhethertherearemirofow arrivalsordeparturesinthemarofow. SupposethatattimeT * 
,thereservedrateofthemarofow k * aisadjustedattheedgeshaperfromrtor t .Letpbe thelastpaketthatleavestheedgeonditionerbeforethe 
k * ratehangeatT * ,andp +1bethefrstpaketthatleaves theedgeonditioneraftertheratehangeatT * .Thenthe 
k+1k k * paketsareshapedasfollows.Fork<,a-a: 11 Lk+1 k+1kLk+1 /r,andfork:k * ,a1 -a1:/rt .Furthermore, 
weneedtoensurethatthevirtualtimeadjustmentterm thatisarriedinsidepaketheadersisproperlyalulated atthenetworkedge.Duetospaelimitation,weomitthe 
detailshere,andrefertheinterestedreaderto[21].The followingtheoremstatesamodifeddelayboundinsidethe networkoreforpaketsofamarofow. 
THEOREM4.Letpaketsofonemarofowshapedatthe *k+1kLk+1 networkedgeasfollows.Fork<k,a1 -a1:/r, k+1kLk+1 andfork:k 
* ,a1 -a1:/rt .Moreover,letthe virtualtimeadjustmenttermbeproperlydefnedasin[21J. Thenthevirtualspaingandrealityhekpropertieshold 
forthemarofowaftertheratehangeatT * .Furthermore, thedelayexperienedbythesepaketsinthenetworkoreis boundedbythefollowingmodifedoredelayformula: 
kk a j-a1: {} maxmax LrLr U +Dr rrt qmax +(h-q)t t(18)  4.3 Admission Control with Dynamic Flow Ag­gregation 
Wenowillustratehowtoperformadmissionontroland resourereservationwithdynamifowaggregation,based ontheresultsobtainedinSetion4.2.1andSetion4.2.2. 
DUq Consideramarofowa.Letbeitsend-to-enddelay requirement,whihweassumeisfxedthroughouttheentire durationofthemarofow.Wheneveramirofowjoinsor 
leavesthemarofowa,weneedtoensurethatitsend-to-end U delayrequirementisstillsatisfed.Atagiventime,letrbe 
thereservedrateofmarofowaexludingtheontingeny bandwidthalloated.LetPbethepathofmarofowa,and Cr letbetheminimalresidualbandwidthalongpathP. 
Weonsidertheasesofmirofowjoinandleaveseparately below. MirofowJoin.Consideranewmirofowvwantingto jointheexistingmarofowaattimet 
* .Ifthenewmi­rofowanbeadmitted,weneedtodetermine,forthere- U ' sulting"new"marofowa t ,anewreservedrater:r 
U V aswellas!ramountofnewontingenybandwidthfora ontingenyperiodof.FromTheorem2,withoutlossof TV VVU U 
' generality,wehoose!r=p-r+r.Heneinorder tobeabletoadmitthenewmirofowvintotheexisting VCr marofowa,wemusthavep:.Ifthisondition 
issatisfed,thenweneedtofndtheminimalnewreserved q rater U ' sothattheend-to-enddelayrequirementDUan besatisfedfortheresultingmarofowa 
t .Notethatafter ontingenyperiod,theedgequeueingdelayforanypakets ofthelassisdeterminedbythenewlasstraÆprofleand 
thereservedrate,therefore, U ' U ' U ' U Uq 2 =+max{J:D(19) U ' Umax/rU ' max/rUU Siner:r,Lr:Lr.Hene: 
U ' U ' DUq .Theonstraint(19)isreduedto:-U .Henethenewmirofowanbeadmittedifthenew U ' reservedrateranbeaommodatedalongpathP(i.e., 
VU ' UV Cr ifp:r-r:p:). U V Ifthemirofowanbeadmitted,r+pisalloatedto themarofowduringtheontingenyperiod(i.e.,fromt 
* tot * +TV),andaftert * +TV ,onlyr U ' willbealloatedfor marofowa t . S2 I2 S1 I1 E1D1  D2 Figure8:Thenetworktopologyusedinthesimula­tions 
MirofowLeave.FromTheorem3,whenaonstituent fowvleavesthemarofowaattimet * ,wemustontinue toserviethemarofowawiththeurrentreservedrater 
U VV TVOnlyaftertheontingenyperiodendsatt * +TV ,anwe foraperiodofwithaontingenybandwidth!r=r. U ' VU 
reduetheurrentreservedratebyr=r-ramount. U ' VU Todeterminer=r-r,wemustensurethat(19)holds. U ' U ' UU 
Siner:r,wehave:.Therefore,(19)is U ' U ' DUq reduedto+:,fromwhihweanfnda U ' newreservedraterforthenewmarofow. 
  5. SIMULATION INVESTIGATION Inthissetion,weondutsimulationstoexploretheeÆ­ayofouradmissionontrolalgorithmsforbothper-fow 
andlass-basedguaranteedservies.Inpartiular,weom­paretheperformaneofourper-fowadmissionontrolal­gorithmwiththatusedinIntServGuaranteedServie(GS) 
model.Wealsoinvestigatetheimpatofdynamifowag­gregationonlass-basedguaranteedservies. Figure8depitsthenetworktopologyusedinthesimula­tions,wherefowsgeneratedfromsoure1(S1)aredestined 
todestination1(D1)viathepathonnetingtheingress node(I1)totheegressnode(E1),andfowsgeneratedfrom soure2(S2)aredestinedtodestination2(D2),viathepath 
onnetingtheingressnode(I2)totheegressnode(E2). Eahingressnodeonsistsoftwoomponents:edgeondi­tioners;andaorestatelesssheduler,whihisthefrst-hop 
sheduleralongthepath.Letx-ydenotetheoutgoing linkfromnodextonodey.Theapaityofoutgoinglinks ofalloreroutersissetto15M/s.Thelinkapaityof 
8i-1iandthatofEi-Di,i=12,areassumedto beinfnity.Allthelinksareassumedtohavezeropropaga-tiondelay.Weonsidertwosimulationsettings.Inthefrst 
setting(rate-basedshedulersonly),alloreroutersemploy C$VCshedulers.Intheseondsetting(mixedrate/delay 
basedshedulers),shedulersemployedfortheoutgoinglinks 11-R2,12-R2,R2-R3,R5-E1areC$VCs,while thoseforR3-R4,R4-R5,andR5-E2areVT-EDFs. 
ThefowtraÆproflesandpossibledelayrequirementsused inthesimulationsarelistedinTable1. WefrstondutasetofsimulationstoomparetheeÆay 
oftheadmissionontrolshemes(bothper-fowandlass­based)intheBB/VTRSmodelwiththestandardadmission ontrolsheme[5,11]usedfortheGSintheIntServmodel. 
IntheGSmodel,theounterpartofaC$VCsheduleris VC,whileforVT-EDF,itisRC-EDF.TheRC-EDF[5, 18]sheduleremploysaper-fowshapertoenforethatthe 
traÆofeahfowenteringtheEDFsheduleronformsto itstraÆprofle.Inthissetofsimulations,traÆissent onlyfromsoure81todestinationD1(i.e.,thereisnoross 
traÆ).Allfowsareoftype0,andhavethesameend-to­enddelayrequirement(either244or219).Moreover,eah fowhasaninfnitelifetime.Notethatundertheper-fow 
guaranteedservies,whenthedelayrequirementofatype 0fowis244s,areservedrateequaltoitsmeansending ratewillmeetthedelayrequirement.Whereas,whenthe 
delayrequirementis219s,ahigherreservedrateisneeded tomeetthedelayrequirement.IntheBB/VTRSaggregate sheme,asingledelayservielassisused,wheretheend­to-enddelayrequirementofthelassissettoeithereither 
244or219.Foreahfowinthelass,afxeddelayparam­eter()isusedatallofthedelay-basedshedulers(this parameterwillonlybeusedinthemixedrate/delay-based 
shedulersetting).Simulationsareondutedusingthree diferentvaluesof(010,024and050).Theobjetiveof oursimulationinvestigationistoomparewhatisthemaxi­mumnumberoffowsthatanbeadmittedunderthethree 
diferentadmissionontrolshemes:IntServ/GS,Per-fow BB/VTRSandAggrBB/VTRS. ThesimulationresultsareshowninTable2.Fromthetable 
weseethattheIntServ/GSandPer-fowBB/VTRSshemes aeptexatlythesamenumberoffowsunderallthesim-ulationsettings.WhereastheAggrBB/VTRSshemehas 
eitherslightlyworseorbetterperformane,dependingon theend-to-enddelayrequirementsofthefows.Whenthe delayrequirementis244s,theAggrBB/VTRSshemea­eptsonefewerfowthanthatanbeaeptedbyeither 
theIntServ/GSorPer-fowBB/VTRSsheme.Thisper­formanelossisduetoontingenybandwidthalloationin theAggrBB/VTRSsheme:whenanewfowisaepted 
intothedelayservielass,anamountofbandwidthequal toitspeakrateisreservedduringtheontingenyperiod toavoidpotentialdelayboundviolation.Inontrast,in 
boththeIntServ/GSandPer-fowBB/VTRSshemes,the bandwidthreservedforthenewfowisequaltoitsmean rate.However,whenthedelayrequirementis219s,the 
AggrBB/VTRSshemeanaeptoneortwomorefows thanthatanbeaeptedbyeithertheIntServ/GSorPer­fowBB/VTRSsheme.Thisperformanegainisdueto 
anumberoffators:1)eahfowhaspreiselythesame delayrequirementasisprovidedbythedelayservielass; 2)theaggregatefowhasasmallerore-delayboundthan 
thatofeahindividualfowintheper-fowguaranteedser­vies;and3)allfowshaveinfnitelifetime,whih,inthis ase,masksthetransientefetofontingenybandwidth 
alloationusedintheAggrBB/VTRSsheme. TobetterunderstandwhytheAggrBB/VTRSshemeyields betterperformaneintheasewhentheend-to-enddelay 
requirementofthefowsis219,weexaminemorelosely thebandwidthalloationalloatedunderthethreeshemes. Figure9plotstheaveragebandwidthalloatedtoeahfow 
usingthethreeshemes(underthemixedrate/delay-based shedulersetting)asafuntionofthenumberoffowsa­eptedintothenetwork.Fromthefgureweseethatunder 
theAggrBBsheme,theaveragereservedbandwidthper fowdereases,asmorefowsareaggregatedintothedelay Table1:TraÆproflesusedinthesimulations 
Type Burstsize)b) Meanrate)b/s) Pea k ra te )b / s) Maxpktsize)B) DelayBounds)s) 0 60000 0.05M 0.1M 1500 
2.44 2.19 1 48000 0.04M 0.1M 1500 2.74 2.46 2 36000 0.03M 0.1M 1500 3.24 2.91 3 24000 0.02M 0.1M 1500 
4.24 3.81 Table2:ComparisonofIntServ/GS,per-fowBB/VTRSandaggregateBB/VTRSshemes. NumberofCallsadmitted 
Rate-BasedUnly MixedRate/Delay-Based Delaybounds 2.44 2.19 2.44 2.19 IntServ/GS 30 27 30 27 Per-fowBB/VTRS 
30 27 30 27 d=0.10 29 29 AggrBB/VTRS d=0.24 29 29 29 29 d=0.50 29 28 servielass.(Noteinpartiularthatwiththefxeddelay 
parameter=010,aper-fowbandwidthalloationthat isequaltothemeanrateofthefowsissuÆienttosupport theend-to-enddelaybound219ofthedelayservielass.) 
Theaveragereservedbandwidtheventuallydropsonsider­ablybelowthoseofthePer-fowBB/VTRSandIntServ/GS shemes.Asaresult,undertheAggrBB/VTRSsheme 
thereissuÆientresidualbandwidthlefttoadmitoneortwo morefowsintothenetwork.UnderthePer-fowBB/VTRS sheme,aVT-EDFshedulerstartswithalloatingthemin­imumpossibledelayparametertoafow,therebyproduing 
theminimumbandwidthalloation(i.e.,themeanrateof thefow).However,asmorefowsareadmitted,thefea­sibledelayparameterthatanbealloatedtoanewfow 
beomeslarger,resultinginhigherreservedrate.Asare­sult,theaveragereservedbandwidthperfowinreases.It isinterestingtonotethatalthoughthePer-fowBB/VTRS 
andIntServ/GSadmitthesamenumberoffows(i.e.,27), thePer-fowBB/VTRSshemehasaslightlysmallerav­eragereservedrateper-fow.Henethereismoreresidual 
bandwidthleftunderthePer-fowBB/VTRSshemethan thatundertheIntServ/GSsheme,albeitthisresidualband­widthisnotenoughtoadmitanotherfow.Thisslightgain 
intheresidualbandwidthisduetotheabilityofthePer­fowBB/VTRSshemetoperformpath-wideoptimization whendeterminingtheminimumfeasiblerate-delayparam­eterpairforafow.Inontrast,intheIntServ/GSsheme, 
thereservedrateofafowisdeterminedusingtheWFQ referenemodel,whihthenlimitstherangethatthede­layparameteranbeassignedtothefowinanRC-EDF 
sheduler. Intheabovesimulations,wehaveassumedthatallfows haveinfnitelifetime.Wenowondutanothersetofsim­ulationsinwhihfowshavefniteholdingtimes,andinves­tigatetheimpatofdynamifowaggregationonthefow 
blokingperformaneoflass-basedguaranteedservies.In thissetofsimulations,fowholdingtimeisgeneratedus­inganexponentialdistributionwithameanof200seonds. 
Flowsmayoriginatefromeitherofthetwosoures81or 82.Wevarythefowinter-arrivaltimestoproduevari­ousoferedloads.Weimplementtwoversionsoftheaggre­gateBB/VTRSsheme:oneusingtheontingenyperiod 
boundingmethod,andanotherusingtheontingenype­riodfeedbakmethod,asdesribedinSetion4.2.1.Fig­ ure10showsthefowblokingratesofthesetwoshemes 
aswellasthatoftheper-fowBB/VTRSsheme,aswein­reasethefowarrivalrates(andthustheoferedloadto thenetwork).Eahpointintheplotsofthisfgureisthe 
averageof5simulationruns.Fromthefgureweansee thatwithdynamifowarrivalsanddepartures,theper­fowBB/VTRSshemehasthelowestfowblokingrate,as 
isexpeted.Thetheoretialontingenyperiodbounding methodhastheworstfowblokingrate,beauseituses theworst-aseboundonthebaklogoftheedgeondition­ers.Thisleadstoaportionofthelinkbandwidthusedas 
theontingenybandwidth,whihisnotimmediatelyre­leased.Usingtheontingenyperiodfeedbakmethod,the ontingenyperiodisingeneralverysmall,thustheon- 
TV tingenybandwidthalloatedisde-alloatedinaveryshort periodoftime.Ingeneral,beauseitrequirespeakrate 
alloationatthetimeanewmirofowarrives,theAggr BB/VTRSshemeshaveahigherfowblokingratethan thatoftheper-fowBB/VTRSsheme.Wealsoobserve 
thatastheoferedloadinreases,thefowblokingratesof theseshemesonverge.Heneasthenetworkislosetoits saturationpoint,the(transient)efetofontingenyband­widthalloationundertheAggrBB/VTRSshemeonthe 
fowblokingperformanebeomesmuhlessprominent.  6. CONCLUSIONS Inthispaperwehavepresentedanovelbandwidthbro­kerarhitetureforsalablesupportofguaranteedservies 
thatdeouplestheQoSontrolplanefromthepaketfor­wardingplane.Theproposedbandwidthbrokerarhiteture isdesignedbasedonaorestatelessvirtualtimereferene 
systemdevelopedin[20].Usingtheproposedbandwidth brokerarhiteture,wedesignedeÆientadmissionontrol algorithmsforbothper-fowend-to-endguaranteeddelay 
serviesandlass-basedguaranteeddelayservieswithfow aggregation.Inpartiular,wedemonstratedhowadmission 
ontrolanbedoneonanentirepathbasis,insteadofon a"hop-by-hop"basis.Indesigninglass-basedadmission ontrolalgorithms,weinvestigatedtheproblemofdynami 
fowaggregationinprovidingguaranteeddelayservies,and devisednewmehanismstoefetivelyirumventthisprob­lem. 
Inthispaperwehavedemonstratedthepotentialadvantages oftheproposedbandwidthbrokerarhiteturefromtheper­ 
70000 65000 Mean reserved bandwidth 60000 55000 45000 Flows accepted Figure9:Meanreservedbandwidth. 
spetiveofadmissionontrol.Therearestillmanyhalleng­ingproblems,boththeoretialandpratial,inthedesign andimplementationofsuhaBBarhiteture.Currently 
weareinvestigatinganumberofapproahestothedesign ofadistributed/hierarhialbandwidthbrokerarhiteture. Wearealsoexploringwaystoextendourvirtualtimeref­erenesystemframeworkandtheproposedBBarhiteture 
tosupportstatistialandotherformsofQoSguarantees. Aknowledgement:WeareextremelygratefultoRoh Guerinforhisinsightfulommentsandvaluablesuggestions 
thathavegreatlyimprovedthepresentationofthispaper. Wewouldalsoliketothanktheanonymousreviewersfor theirhelpfulfeedbakonthepaper. 
 7. REFERENCES [1lP.Aukia,M.Kodialam,P.Koppol,T.Lakshman,H.Sarin, andB.Suter.RATES:AserverforMPLStraÆ 
engineering.IEEENetwork,pages34-41,Marh/April 2000. [2lS.Blake,D.Blak,M.Carlson,E.Davies,Z.Wang,and W.Weiss.Anarhiteturefordiferentiatedservies.RFC 
2475,Deember1998. [3lJ.Boyle,R.Cohen,D.Durham,S.Herzog,R.Rajan,and A.Sastry.TheCUPS)ommonopenpoliyservie) 
protool.RFC2748,January2000. [4lR.Braden,L.Zhang,S.Berson,S.Herzog,andS.Jamin. Resourereservationprotool)RSVP)-version1 
funtionalspeifation.RFC2205,September1997. [5lL.Georgiadis,R.Gueerin,V.Peris,andK.N.Sivarajan. EÆientnetworkQoSprovisioningbasedonpernode 
traÆshaping.IEEE/ACMTransationsonNetworking, 4)4):482-501,1996. [6lR.Gueerin,S.Blake,andS.Herzog.Aggregating 
RSVP-basedQoSrequests.InternetDraft,1997.Workin Progress. [7lK.Nihols,V.Jaobson,andL.Zhang.Atwo-bit 
diferentiatedserviesarhiteturefortheinternet.RFC 2638,July1999. [8lP.PanandH.Shulzrinne.YESSIR:asimplereservation 
mehanismfortheInternet.ACMComputer CommuniationReview,29)2):89-101,April1999. [9lS.RampalandR.Gueerin.Flowgroupingforreduing 
reservationrequirementsforguaranteeddelayservie. InternetDraft,July1997.WorkinProgress. [10lE.C.Rosen,A.Viswanathan,andR.Callon.Multiprotool 
labelswithingarhiteture.InternetDraft,August1999. WorkinProgress. 0.25 Blocking probabilities 0.2 0.15 
0.1 0.05 Offered loads Figure10:Flowblokingrates. [11lS.Shenker,C.Partridge,andR.Gueerin.Speifationof 
guaranteedqualityofservie.RFC2212,September1997. [12lI.StoiaandH.Zhang.Providingguaranteedservies withoutperfowmanagement.InPro.ACMSIGCOMM, 
Boston,MA,September1999. [13lI.Stoia,H.Zhang,S.Shenker,R.Yavatkar,D.Stephens, A.Malis,Y.Bernet,Z.Wang,F.Baker,J.Wrolawski, 
C.Song,andR.Wilder.Perhopbehaviorsbasedon dynamipaketstates.InternetDraft,February1999. WorkinProgress. 
[14lA.Terzis,J.Ugawa,S.Tsui,L.Wang,andL.Zhang.A prototypeimplementationofthetwo-tierarhiteturefor diferentiatedservies.InProeedingsofIEEERTAS'99, 
Vanouver,Canada,1999. [15lJ.Y.LeBoude,T.Ferrari,W.Almesberger.SRP:a salableresourereservationprotoolfortheinternet.In 
ProeedingsofIWQoS'9S,pages107-116,Napa,CA,May 1998. [16lL.Wang,A.Terzis,andL.Zhang.Anewproposalof RSVPrefreshes.InProeedingsofIEEEICNP,Toronto, 
Canada,November1999. [17lL.Wang,A.Terzis,andL.Zhang.RSVPrefreshoverhead redutionbystateompression.InternetDraft,June1999. 
WorkinProgress. [18lH.ZhangandD.Ferrari.Rate-ontrolledstati-priority queueing.InIEEEINFOCOM'93,pages227-236,April 
1993. [19lL.Zhang,S.Deering,D.Estrin,S.Shenker,and D.Zappala.RSVP:Anewresourereservationprotool. IEEENetwork,pages8-18,September1993. 
[20lZ.-L.Zhang,Z.Duan,andY.T.Hou.Virtualtime referenesystem:Aunifyingshedulingframeworkfor salablesupportofguaranteedservies.IEEEJournalon 
SeletedAreasinCommuniation,SpeialIssueonInternet QoS,Toappear2000. [21lZ.-L.Zhang,Z.Duan,Y.T.Hou,andL.Gao.Deoupling 
QoSontrolfromorerouters:Anovelbandwidthbroker arhitetureforsalablesupportofguaranteedservies. TehnialReport00-02S,ComputerSieneDepartment, 
UniversityofMinnesota,Marh2000. http://www.s.umn.edu/.zhzhang/papers.html. 
			