
 Algorithms for Provisioning Virtual Private Networks in the Hose Model Amit Kumar* Rajeev Rastogi CornellUniversity 
BellLaboratories Ithaca,NY14853600MountainAvenue amitk@cs.cornell.edu MurrayHill,NJ07974 rastogi@bell-labs.com 
 ABSTRACT VirtualPrivateNetworks(VPNs)providecustomerswith predictableandsecurenetworkconnectionsoverashared 
network.TherecentlyproposedhosemodelforVPNsal­lowsforgreaterfexibilitysinceitpermitstrafctoand fromahoseendpointtobearbitrarilydistributedtoother 
endpoints.Inthispaper,wedevelopnovelalgorithmsfor provisioningVPNsinthehosemodel.WeconnectVPNend­pointsusingatreestructureandouralgorithmsattemptto 
optimizethetotalbandwidthreservedonedgesoftheVPN tree.Weshowthatevenforthesimplescenarioinwhich networklinksareassumedtohaveinfnitecapacity,thegen­eralproblemofcomputingtheoptimalVPNtreeisNP­hard.Fortunately,forthespecialcasewhentheingressand 
egressbandwidthsforeachVPNendpointareequal,wecan deviseanalgorithmforcomputingtheoptimaltreewhose timecomplexityisO(mn),wheremandnarethenumber 
oflinksandnodesinthenetwork,respectively.Wepresenta novelintegerprogrammingformulationforthegeneralVPN 
treecomputationproblem(thatis,wheningressandegress bandwidthsofVPNendpointsarearbitrary)anddevelop analgorithmthatisbasedontheprimal-dualmethod.Our 
experimentalresultswithsyntheticnetworkgraphsindicate thattheVPNtreesconstructedbyourproposedalgorithms 
dramaticallyreducebandwidthrequirements(inmanyin­stances,bymorethanafactorof2)comparedtoscenarios inwhichSteinertreesareemployedtoconnectVPNend­points. 
 1. INTRODUCTION VirtualPrivateNetworks(VPNs)arebecominganin­creasinglyimportantsourceofrevenueforInternetService 
Providers(ISPs).Informally,aVPNestablishesconnectiv­itybetweenasetofgeographicallydispersedendpointsover 
asharednetworkinfrastructure.ThegoalistoprovideVPN endpointswithaservicecomparabletoaprivatededicated 
* WorkdonewhilevisitingBellLaboratories. Permission to make digital or hard copies of all or part of 
this work for personal or classroom use is granted without fee provided that copies are not made or distributed 
for pro.t or commercial advantage and that copies bear this notice and the full citation on the .rst 
page. To copy otherwise, to republish, to post on servers or to redistribute to lists, requires prior 
speci.c permission and/or a fee. SIGCOMM 01, August 27-31, 2001, San Diego, California, USA.. Copyright 
2001 ACM 1-58113-411-8/01/0008 ...$5.00. Avi Silberschatz Bulent Yener BellLaboratories BellLaboratories 
600MountainAvenue 600MountainAvenue MurrayHill,NJ07974MurrayHill,NJ07974 avi@bell-labs.com yener@bell-labs.com 
networkestablishedwithleasedlines.Thus,providersof VPNservicesneedtoaddresstheQoSandsecurityissues associatedwithdeployingaVPNoverasharedIPnetwork. 
Inrecentyears,substantialprogressinthetechnologiesfor IPsecurity[7,3]haveenabledexistingVPNserviceoferings 
toprovidecustomerswithalevelofprivacycomparableto thatoferedbyadedicatedline.However,ISPshavebeen slowtoofercustomerswithguaranteedbandwidthVPN 
servicessinceIPnetworksinthepasthadlittlesupportfor enforcingQoSinthenetwork.TherecentemergenceofIP technologieslikeMPLSandRSVP,however,havemadeit 
possibletorealizeIP-basedVPNsthatcanprovideendcus­tomerswithQoSguarantees.Inthispaper,weaddressthe problemofprovisioningVPNserviceswithQoSguarantees, 
aproblemwhichhasreceivedlittleattentionfromthere­searchcommunity. 1.1 The Hose Model TherearetwopopularmodelsforprovidingQoSinthe 
contextofVPNs-the\pipe"modelandthe\hose"model [3,2].Inthepipemodel,theVPNcustomerspecifesQoS requirementsbetweeneverypairofVPNendpoints.Thus, 
thepipemodelrequiresthecustomertoknowthecomplete trafcmatrix;thatis,theloadbetweeneverypairofend-points.However,thenumberofendpointsperVPNiscon­stantlyincreasingandthecommunicationpatternsbetween 
endpointsarebecomingincreasinglycomplex.Asaresult, itisalmostimpossibletopredicttrafccharacteristicsbe­tweenpairsofendpointsrequiredbythepipemodel. 
Thehosemodelalleviatestheabove-mentionedshortcom­ingsofthepipemodel.Inthehosemodel,theVPNcus­tomerspecifesQoSrequirementsperVPNendpointand 
noteverypairofendpoints.Specifcally,associatedwith eachendpoint,isapairofbandwidths{aningressband­widthandanegressbandwidth.Theingressbandwidthfor 
anendpointspecifestheincomingtrafcfromalltheother VPNendpointsintotheendpoint,whiletheegressband­widthistheamountoftrafctheendpointcansendtothe 
otherVPNendpoints.Thus,inthehosemodel,theVPN serviceprovidersuppliesthecustomerwithcertainguaran­teesforthetrafcthateachendpointsendstoandreceives 
fromotherendpointsofthesameVPN.Thecustomerdoes nothavetospecifyhowthistrafcisdistributedamongthe otherendpoints.Asaresult,incontrasttothepipemodel, 
thehosemodeldoesnotrequireacustomertoknowitstraf­fcmatrix,whichinturn,placeslessburdenonacustomer thatwantstousetheVPNservice. 
Insummary,thehosemodelprovidescustomerswiththe followingadvantagesoverthepipemodel[3]: 1.EaseofSpecifcation.Onlyoneingressandegress 
bandwidthperhoseendpointneedstobespecifed, comparedtobandwidthforeachpipebetweenpairsof hoseendpoints. 
2.Flexibility.Trafctoandfromahoseendpointcan bedistributedarbitrarilyoverotherendpointsaslong astheingressandegressbandwidthsofeachhoseend­pointarenotviolated. 
3.MultiplexingGain.Duetostatisticalmultiplexing gain,hoseingressandegressbandwidthscanbeless thantheaggregatebandwidthrequiredforasetof 
pointtopointpipes. 4.Characterization.Hoserequirementsareeasierof characterizebecausethestatisticalvariabilityinthe 
individualsource-destinationtrafcissmoothedbyag­gregationintohoses. Fromtheabovediscussion,itfollowsthatthehosemodel 
providesVPNcustomerswithasimplemechanismforspec­ifyingbandwidthrequirementsandenablesVPNservice providerstoutilizenetworkbandwidthmoreefciently.How­ever,inordertorealizethesebenefts,efcientalgorithms 
mustbedevisedforprovisioninghoses.Thesehoseprovi­sioningalgorithmsneedtosetuppathsbetweeneverypair ofVPNendpointssuchthattheaggregatebandwidthre­servedonthelinkstraversedbythepathsisminimum.A 
naivealgorithmthatsetsupindependentshortestpathsbe­tweeneverypairofendpoints,however,couldleadtoexces­sivebandwidthbeingreserved.Thereasonforthisisthat 
thehosemodelprovidesthefexibilityfortrafcfromahose endpointtobearbitrarilydistributedtootherendpoints. 
Consequently,thedistributionoftrafcbetweenVPNend­pointsisnon-deterministicandtheprovisioningalgorithms 
needtoreservesufcientbandwidthtoaccommodatethe worst-casetrafcdistributionamongendpointsthatmeets theingressandegressbandwidthconstraintsofhoseend­points.Intuitively,inordertoconservebandwidthandre­alizethemultiplexingbeneftsofthehosemodel,pathsen­teringintoandoriginatingfromeachhoseendpointneedto 
shareasmanylinksaspossible.Thus,sophisticatedhose provisioningalgorithmsneedtobedevelopedtoensurethat 
theamountofbandwidthreservedinordertomeetthehose trafcrequirementsisminimum. Example1.1.:ConsiderthenetworkgraphinFigure1(a). 
The3VPNhoseendpoints1,2and3havebandwidthre­quirementsof1,2and2units,respectively(eachendpoint hasequalingressandegressbandwidths).Figure1(b)de­pictsthebandwidthreservedonrelevantlinksofthenet­workwhenanaiveindependentshortestpathsapproachis 
usedtoconnectVPNendpoints.Forinstance,theshortest pathbetween1and2passesthroughA,whiletheshortest pathbetweenendpoints2and3passesthroughC.Also,1 
unitofbandwidthneedstobereserved(ineachdirection)on thetwolinksincidentonAandontheshortestpathfrom 1to2sinceendpoint1cansend/receiveatmost1unitof 
trafc.Similarly,thebandwidthreservedonthetwolinks incidentonCis2units,theminimumofthebandwidthre­quirementsofendpoints2and3.Thus,thetotalreserved 
bandwidthusingindependentshortestpathsis8units(only consideringonedirectionforeachlink). Thereservedbandwidthcanbereducedfrom8to6byex­ploitinglinksharingamongpathsconnectingtheVPNend­pointsasillustratedinFigure1(c).Here,bothpathsfrom 
endpoint1tothetwootherendpointspassthroughC,thus allowingthetwolinksconnecting1toCtobesharedbe­tweenthem.(Notethatthepathfrom1to2passingthrough 
Cislongerthanthepathfrom1to2throughA).Further, sinceendpoint1cannotreceiveorsendmorethan1unitof trafc,thebandwidthreservedoneachofthetwolinksis1 
unit(ineachdirection)andissharedbetweenthetwopaths. Thus,thetotalbandwidthreserveddecreasesfrom8to6as 
aresultoflinksharingbetweenpaths. NotethatprovisioningpipesbetweeneachpairofVPN endpointsinthepipemodelissomewhatsimplersincethe 
trafcbetweeneverypairofendpointsisfxedandisinput totheprovisioningalgorithm.Thus,theVPNprovisioning problemsimplyreducestothatofcomputingasetoffxed 
bandwidthpathsbetweenVPNendpointpairs,whichisan instanceofthewell-studiedmulticommodityfowproblem [1,6].However,asmentionedearlier,thedrawbackofthe 
pipemodelisthedifcultyofcapturingandspecifyingband­widthrequirementsbetweeneachpairofVPNendpoints. Thus,thehosemodeltradesofprovisioningsimplicityfor 
easeofspecifcationandmultiplexinggains.  1.2 Our Contributions Inthispaper,wedevelopnovelalgorithmsforprovision­ingVPNsinthehosemodel.Inordertotakeadvantage 
ofthemultiplexinggainpossibleduetohoses,weconnect VPNendpointsusingatreestructure(insteadofindepen­dentpoint-to-pointpathsbetweenVPNendpoints).AVPN 
treehasseveralbeneftswhichincludescalability,sharing ofbandwidthreservation,simplicityofroutingandeaseof 
restoration. WedevelopalgorithmsforcomputingoptimalVPNtrees; thatis,treesforwhichtheamountoftotalbandwidthre­servedonedgesofthetreeisminimum.Initially,weassume 
thatnetworklinkshaveinfnitecapacity,andshowthateven forthissimplescenario,thegeneralproblemofcomputing 
theoptimalVPNtreeisNP-hard.However,forthespe­cialcasewhentheingressandegressbandwidthsforeach VPNendpointareequal,weareabletodeviseabreadth 
frstsearchalgorithmforcomputingtheoptimaltreewhose timecomplexityisO(mn),wheremandnarethenumber oflinksandnodesinthenetwork,respectively.Wepresenta 
novelintegerprogrammingformulationforthegeneralVPN treecomputationproblem(thatis,wheningressandegress 
bandwidthsofVPNendpointsarearbitrary)anddevelop analgorithmthatisbasedontheprimal-dualmethod[6]. In[8],wealsoextendourproposedalgorithmsforcomput­ingVPNtreestothecasewhennetworklinkshavecapacity 
constraints.Weshowthatinthepresenceoflinkcapacity constraints,computingtheoptimalVPNtreeisNP-hard evenwheningressandegressbandwidthsofeachendpoint 
areequal.Further,wealsoshowthatcomputinganap­proximatesolutionthatiswithinaconstantfactorofthe optimumisasdifcultascomputingtheoptimalVPNtree 
itself. In[3],theauthorssuggestthataSteinertreecanbeem­ployedtoconnectVPNendpoints.However,ourexperi­mentalresultswithsyntheticnetworkgraphsindicatethat 
theVPNtreesconstructedbyourproposedalgorithmsre­quiredramaticallylessbandwidthtobereserved(inmany 1 
(1)  1 (1) 1 (1) A A B B  1 1 1 1 22 C  3 (2) 3 (2) 3 (2) 2 (2) 2 (2) 2 (2) (c) Link Sharing Among 
Paths (a) Graph (b) Independent Shortest Paths Figure1:LinkSharingAmongPathstoReduceReservedBandwidth 
instances,bymorethanafactorof2)comparedtoSteiner trees.Further,amongthethreealgorithms,theprimal-dual 
algorithmperformsthebest,reservinglessbandwidththan boththebreadthfrstsearchandSteinertreealgorithms 
overawiderangeofparametervalues.  2. SYSTEM MODEL AND PROBLEM FOR-MULATION WemodelthenetworkasagraphG(V,E)whereVis 
asetofnodesandEisasetofbidirectionallinksbetween thenodes.Eachlink(i,j)hasassociatedcapacitiesinthe twodirections{wedenotethecapacityfromnodeitojby 
Lijandthecapacity(intheoppositedirection)fromnode jtoibyLji. Inthehosemodel,eachVPNspecifcationconsistsofthe 
followingtwocomponents:(1)AsetofnodesP.Vcor­respondingtotheVPNendpoints,and(2)Foreachnode Bin i2 P,thehoseingressandegressbandwidthsiand 
Bout i,respectively.Withoutlossofgenerality,weassume thateachnodei2Pisaleaf,thatis,thereisasingle (bidirectional)linkincidentoni1 
.Asmentionedearlier,we considertreestructurestoconnecttheVPNendpointsin Psincetreesarescalable,simplifyroutingandrestoration. 
Further,treesallowthebandwidthreservedonalinkto besharedbythetrafcbetweenthetwosetsofVPNend­pointsconnectedbythelink.Thus,thebandwidthreserved 
onalinkmustbeequaltothemaximumpossibleaggregate trafcbetweenthetwosetsofendpointsconnectedbythe link. 
Beforewecancomputetheexactbandwidthtobere­servedoneachlinkofVPNtreeTwhoseleavesarenodes fromP,weneedtodevelopsomenotation.Foralink(i,j) 
(i j)/T(i j) intreeT,wedenotebyTitheconnectedcompo­ j nent ofTcontainingnodei/jwhenlink(i,j)isdeletedfrom 
(i j)(i j) T.Also,letPandPdenotethesetofVPNend­ ij (i j)(i j) pointsinTandTj,respectively.Table1describes 
i thenotationusedintheremainderofthepaper. ObservethatalltrafcfromoneVPNendpointtoan­othertraversestheuniquepathintheVPNtreeTbetween 
thetwoendpoints.Nowconsiderlink(i,j)thatconnectsthe 1IncasethereisaVPNendpointi2Pthatisnotaleaf, thenwesimplyintroduceanewnodejinGandanewlink 
(i,j)withverylargecapacity,andreplacenodeiinPwith nodej.  Symb ol Description G(V,E)GraphwithnodesVandbidirectional 
edgesE m NumberoflinksingraphG(jEj) n NumberofnodesingraphG(jVj) Capacityoflink(i,j)inthedirectionfrom 
nodeitoj Lij i,j,l,u,v,w GenericsymbolsfornodesinG P SetofVPNendpoints T GenericnotationforVPNtree TvVPNtreerootedatnodev 
  link(i,j)isdeletedfromT CT(i,j)Bandwidthreservedonlink(i,j)ofVPN treeT  Sumofbpandwidthsreservedonalllinks 
ofVPNtreeT CT dT(i,j)Distance(innumberoflinks)between nodesiandjintreeT dG(i,j)Lengthoftheshortestpath(innumberof 
links)betweennodesiandjingraphG Table1:NotationUsedinthePaper (i j)(i j) twosetsofVPNendpointsPiandPj.Thetrafcfrom 
PP BoutBin nodeitojcannotexceedminf(i,j) ,(i,j) g, ll l2Pl2P ij thatis,theminimumofthecumulativeegressbandwidths 
(i j) ofendpointsinPiandthesumofingressbandwidths (i j) ofendpointsinP.Thisisbecausetheonlytrafcthat 
j traverseslink(i,j)fromitojisthetrafcoriginatingfrom (i j) (i j) endpointsinPianddirectedtowardsendpointsinPj. 
P Bout Theboundontheformeris(i,j) ,whilethelat­ l l2P i P Bin terisboundedby.Thus,thebandwidthto (i,j) 
l l2P j bereservedonlink(i,j)ofTinthedirectionfromito PP BoutBin jisgivenbyCT(i,j)minf(i,j) ,(i,j) lg. 
l l2Pl2P ij Similarly,thebandwidththatmustbereservedonlink(j,i) inthedirectionfromjtoicanbeshowntobeCT(j,i) 
PP BinBout minf(i,j) ,(i,j) g.NotethatCT(i,j)may ll l2Pl2P ij notbeequaltoCT(j,i). Thus,thetotalbandwidthreservedfortreeTisgivenby 
P CT CT(i,j)(notethat(i,j)and(j,i)arecon­ (i j)2T sideredastwodistinctlinksinT).Further,sinceweare interestedinminimizingthereservedbandwidthfortreeT, 
theproblemofcomputingtheoptimalVPNtreebecomes thefollowing: ProblemStatement:GivenasetofVPNendpointsP, 
andtheiringressandegressbandwidths,computeaVPN treeTwhoseleavesarenodesinPandforwhichCTis minimum. In[3],ithasbeensuggestedthataSteinertreecanbe 
usedtoconnecttheVPNendpoints.However,eventhough aSteinertreehasthesmallestnumberoflinks,itmaybe suboptimal,asillustratedbythefollowingexample. 
Example2.1.:Considerthenetworkgraphshownin Figure2(a).Nodes1,2,:::,6aretheVPNendpointsand BinBoutBinBout 
BinBout 1000while1 fori2,:::,5.Figure2(b)showstheSteinertreeconnect­ingtheVPNendpointsinPandcontaining16edges.The 
totalbandwidthreservedontheedgesoftheSteinertree(in asingledirection)isgivenby1000*2+1001*2+1002* 2+1001*2+1000*210008(thisexcludesthe2006units 
thatneedtobereservedonthelinksincidentontheVPN endpointsinP).Thereasonforthisisthat1000unitsneed tobereservedonthetwolinksconnectingendpoints1and 
2,1001unitsneedtobereservedonthetwolinksconnecting endpoints2and3,andsoon.However,theoptimalVPN treecontaining17linksisshowninFigure2(c).Thecumu­lativebandwidthreservedonallthelinksoftheoptimaltree 
is1000*2+1000*2+4+2*2+1*2+1*24012(again,in asingledirectionperlinkandexcludingthe2006unitsthat needtobereservedonthelinksincidentontheVPNend­pointsinP).Thisisbecausethebandwidthreservedonthe 
twolinksconnectingendpoints1and0is1000,theband­widthforthetwolinksbetweenendpoints6and0is1000, thebandwidthforthelinkconnecting0toendpoints2,:::,5 
is4units,andforthetwolinksconnectingendpoints3and 4is2units,andsoon. 1166 ii Thus,intheaboveexample,thebandwidthreservedfor 
theSteinertreeismorethantwicetheoptimumbandwidth. Further,notethat,intheexample,theperformanceofthe Steinertreecanbemadearbitrarilyworsecomparedtothe 
optimum(byincreasingthenumberofVPNendpointsbe­tweenendpoints1and6). Intheremainderofthepaper,wewillrefertoCT(i,j)as 
thecostoflink(i,j)intreeTandCTasthecostoftreeT. Inthefollowingtwosections(Sections3and4),wedevelop algorithmstocomputetheoptimalVPNtreeignoringlink 
capacityconstraints.Duetospaceconstraints,wedefer thepresentationofhowthealgorithmscanbeextendedto handlelinkcapacityconstraintsto[8]. 
 3. SYMMETRIC INGRESS AND EGRESS BANDWIDTHS Forsymmetricingressandegressbandwidths,thatis, BinBout wheniiforeachVPNendpointi,onecande­viseefcientalgorithmsforcomputingtheminimumcost 
VPNtreeiflinksdonothavecapacityconstraints.Inthis section,wepresentapolynomialtimealgorithmforcom­putingtheoptimalVPNtreeforthesymmetricbandwidth 
caseundertheassumptionthattheresidualcapacityofeach edgeislarge.Sincetheingressandegressbandwidthsare 
equal,inthefollowing,wesimplydropthesuperscriptsin andout,anddenotethebandwidthforendpointisimply byBi. 
Beforepresentingouralgorithmforcomputingtheopti­maltree(thatis,treewithminimumcost),wefrstdevelop someintuitionforthecostCTofatreeT.Recall(from 
P theprevioussection)thatCT CT(i,j).Fora (i j)2TP setofleavesLP,wedefneB(L)asBl.Thus, l2L(i j)(i j) CT(i,j)minfB(Pi),B(Pj)g.Itisstraightforward 
toobservethatCT(i,j)CT(j,i),thatis,thebandwidth reservedonlink(i,j)inthetwodirectionsisequal.Now supposethatforatreeTandanodevinT,wedefnethe 
P quantityQ(T,v)tobe2*Bl*dT(v,l),wherethesum l2Pisoverallleavesl,anddT(v,l)denotesthelengthofthe uniquevtolpathinT.Then,foranytreeTwhoseleaves 
arenodesinP,wecanshowthatCTsatisfesthefollowing twoproperties: Property1.Thereexistsanodew2Tsuchthat 
CTQ(T,w).  Property2.Forallnodesv2T,CT:Q(T,v).  InordertoshowtheabovetwopropertiesfortreeT,we constructadirectedtreeTdirfromTbygivingadirection 
toeachedgee(i,j)ofTasfollows: (i j)(i j) ifB(Pi)B(Pj),thendirecttheedgetowards i. (i j)(i j) ifB(Pj)B(Pi),thendirecttheedgetowards 
j. (i j)(i j) ifB(Pi)B(Pj),thendirecttheedgetowards ^ thecomponentwhichcontainsaparticularleaf,say, l. 
Clearly,Tdirmustcontainanodewhoseindegreeis0|we denotethisnodeinTdirwithnoincomingedgesbya(T).We showthata(T)isindeeduniqueandCTQ(T,a(T)).For 
this,weprovesomepropertiesaboutTdirinthefollowing lemma. Lemma3.1.:EveryedgeeinTdirisdirectedawayfrom 
a(T). Proof:Lete(i,j)beanedgeintreeTsuchthatiis closertoa(T)thanjinT.Weshowthateisdirectedfromi tojinTdir.ConsiderthepathinTfroma(T)toi.Weknow 
thatthefrstedge(u,v)alongthepathisdirectedaway (u v)(u v) fromua(T).So,B(Pv):B(Pu).Since(u,v)is (u v)(i 
j) thefrstedgeofthepathfroma(T)toi,PuPand i (i j)(u v) (i j)(u v) also,PjPv.Thus,weget,B(Pj):B(Pv): (u 
v)(i j)(i j)(i j) B(Pu):B(Pi).IfB(Pj)B(Pi),thenedge eisdirectedfromitojandwearedone.Theonlyother (i j)(i 
j) possibilityisB(Pj)B(Pi).Butthen,itmustbethe (u v)(i j)(u v)(i j)(u v) casethatPuPi,PvPjandB(Pu) (u 
v) B(Pv).Asaresult,itfollowsthatuiandvj,and sinceedge(u,v)isdirectedfromutov,edge(i,j)mustalso bedirectedfromitoj. 
 Notethatfromtheabovelemma,onecaneasilyshowthat a(T)isuniquesinceeveryothernodeinTdirhasanedge 00  
 1 2 345 6 (1000) (1) (1) (1) (1) (1000) 1 2 345 6 (1000) (1) (1) (1) (1) (1000)    (a) Graph (b) 
Steiner Tree (c) Optimal VPN Tree Figure2:Exampleof directedintoit(andconsequently,anindegreeof1).Inthe 
followinglemma,weprovethatProperty1mentionedabove holdsforwa(T). Lemma3.2.:ThecostoftreeT,CTQ(T,a(T)). 
Proof:Letlbealeafande(i,j)beanedgeonthepath froma(T)tol(nodeibeingclosertoa(T))|notethat BlcontributestobothCT(i,j)andCT(j,i).Thereasonfor 
(i j) thisisthatCT(i,j)isB(Pj)sinceduetoLemma3.1, (i j) theedgeisdirectedfromitojinTdirandsoB(Pj): (i 
j)(i j) B(Pi).Thus,sincel2Pj,Blcontributestoeach edgeonthepathfroma(T)tol,andtonootheredge.This provesthelemma. 
Property2isastraightforwardcorollaryofthefollowing lemma(sinceCTQ(T,a(T))duetoLemma3.2). Lemma3.3.:LetvbeanynodeinT.Then,Q(T,a(T)): 
Q(T,v). Proof:Wefrstshowthefollowingresult:supposee (i,j)isanedgethatisdirectedfromitojinTdir.Then, Q(T 
, i) : Q(T , j ). We know that B(P(i j) j) : B(P(i j) i). Now, X Q(T , i);Q(T , j ) 2* Bl *(dT(i,l);dT(j,l))+ 
l2P(i,j) i X 2* Bl *(dT(i,l);dT(j,l)) l2P(i,j) j X X ;2* Bl+2 * Bl l2P(i,j) i l2P(i,j) j 2*B(P(i j) j);2*B(P(i 
j) i) : 0 Now,wecanprovethelemma.Considerthepathfrom a(T)tovinTdir.ByLemma3.1,alledgesalongthepath aredirectedawayfroma(T).So,repeatedapplicationofthe 
resultprovedabove(foreachedgealongthepath)proves thelemma. FromProperties1and2,itfollowsthatfortheoptimal 
treeTopt,CToptQ(Topt,a(Topt)).Thus,ifwecouldcom­pute,foreachnodev,thetreeTvsuchthatQ(Tv,v)is minimum,thentheoptimaltreeissimplythetreeTvwith 
theminimumQ(Tv,v).Figure3containstheprocedurefor computingtheoptimaltreeTopt.ForeachnodevinG, SuboptimalSteinerTree 
procedureComputeTreeSymmetric(G,P) 1.Topt:=0 2.foreachnodevinGf 3.Tv:=v 4.openQ:=fvg 5.while6 (openQ=0)f 
6.dequeuefrstnodeu7.foreachedge(u,w)8.addedge(u,w)to9.appendnodewto 10.g 11.pruneleavesofTvthat Tv enddo 
endpoints(thatis,do12.ifCTvC Topt 13.Topt:=Tv  14.g 15.returnTopt fromopenQ inGsuchthatwisnotinTvf ofopenQ 
notcorrespondtoVPN notbelongtoP) Figure3:AlgorithmforComputingOptimalTree forSymmetricBandwidths ProcedureComputeTreeSymmetriccomputesabreadth 
frstspanningtreerootedatv|weshowinLemma3.4be­lowthatthistreeTvminimizesthevalueofQ(Tv,v)among possibletreesrootedatv.Theprocedurethenoutputsthe 
treeTvforwhichQ(Tv,v)isminimum|letTv^bethistree. Inthefollowing,weshowthatCTv^CToptwhereToptis theoptimaltree.Firstnotethefollowingimportantfactfor 
thebreadthfrsttreeTvrootedatnodev. Lemma3.4.:LetTbeanytreeandvbeanodeinG. Then,Q(Tv,v):Q(T,v). Inthenextlemma,weshowthefollowingimportantre­lationshipbetweenTv^andToptthatenablesustosubse­quentlyshowthattheircostsareequal.Notethatdueto 
Lemma3.2,CToptQ(Topt,a(Topt)). Lemma3.5.:Q(Tv^,v^):Q(Topt,a(Topt))CTopt: Theorem3.6.:CT^CTopt: v Itisstraightforwardtoobservethatthetimecomplexity 
ofProcedureComputeTreeSymmetricisO(mn),where njVjisthenumberofnodesandmjEjisthenumberof edgesinG.Thisisbecausetheoutermostforloopiterates 
overeverynodeinG,andthebodyoftheforloop,inthe worstcase,considerseveryedgeinG.  (3/4) (3/4) 2 (3/4) 
Figure4:ExampleofTreeCostforAsymmetric Bandwidths  4. ASYMMETRIC INGRESS AND EGRESS BANDWIDTHS Inthissection,weaddressthecasewhenVPNendpoint 
bandwidthrequirementsareasymmetric,thatis,foraVPN BinBout endpointj,jandjmaybeunequal.Asymmetric ingressandegressbandwidthscomplicatetheVPNtree 
computationproblemsinceforaVPNtreeTconnectingthe VPNendpoints,thebandwidthreservedalongedge(i,j) ofTmaynotbeidenticalinthetwodirections{thatis, 
CT(i,j)maynotbeequaltoCT(j,i).Thisisbecauseforan PP BoutBin edge(i,j),CT(i,j)minf(i,j) ,(i,j) g ll l2Pl2P 
ij PP BinBout andCT(j,i)minf(i,j) ,(i,j) g.Thus, ll l2Pl2P ij BinBout intheasymmetriccase,sincelandlmaynotbe 
equal,CT(i,j)andCT(j,i)maynotbeequal.Notethatthis isdiferentfromthesymmetricbandwidthscaseinwhichthe 
bandwidthsreservedinbothdirectionsalonganedge(i,j) ofatreeTwereequal. Example4.1.:ConsidertheVPNtreeshowninFigure4 
connectingtheVPNendpointsinPf0,1,:::,4g.The bandwidthrequirementsfortheendpointsareasfollows:for BinBout 
endpoints0and1,3and6,andforendpoints BinBout 2,3and4,3and4.Thebandwidthsreserved inthetwodirectionsforthevariousedgesofthetreeare 
shownadjacenttotheedgesinthefgure.Thus,forinstance, P Bout foredge(5,6),CT(5,6)9(since (5,6) 12is ll2P 
5 P Bin greaterthan(5,6) 9)andCT(6,5)6(since ll2P 6 P P Bout Bin (5,6) l12isgreaterthan(5,6) l6). l2P 
l2P 6 5 Similarly,onecanshowthatforedge(6,7),CT(6,7)6 P P Bout Bin (since (6,7) 16isgreaterthan(6,7) 
l l l2P l2P 6 7 P Bout 6)andCT(7,6)8(since (6,7) 8islessthan l l2P 7 P Bin (6,7) 9). ll2P 6 Fortheasymmetricbandwidthscase,theproblemofcom­putingtheVPNtreewiththeminimumcostcanbeshown 
tobeatleastasdifcultasthatofcomputingaSteinertree connectingtheVPNendpoints.SincetheSteinertreecom­putationproblemforasetofVPNendpointsisNP-hard 
[6,5],itfollowsthattheproblemofcomputingtheoptimal VPNtreeisalsoNP-hard. Theorem4.2.:Fortheasymmetricbandwidthscase,the 
problemofcomputingtheoptimalVPNtreeconnectingthe setofVPNendpointsinPisNP-hard.  4.1 Integer Programming 
Formulation Inthissection,weshowthattheproblemofcomputing theoptimaltreecanbeformulatedasanintegerprogram­mingproblem.Forthis,wefrstneedtoexaminetheprop­ertiesofVPNtreesconnectingendpointswithasymmetric 
bandwidths. Foranedge(i,j)ofVPNtreeT,wesaythatitisbiased towardsiifthefollowingtwoconditionshold: PPP 
Bin Bout Bin 1.((i,j) l(i,j) l)or((i,j) l l2Pl2Pl2P ij i P Bout(i j) (i,j) landPicontainsaspecialnode,say 
l2P j ^ l),and PPP Bout Bin Bout 2.((i,j) l(i,j) l)or((i,j) l l2Pl2Pl2P ij i P Bin(i j) (i,j) landPicontainsaspecialnode,say 
l2P j ^ l). Anedge(i,j)issaidtobebiasedifitisbiasedtowardseither iorj.Anedgethatisnotbiasedissaidtobebalanced.Also, 
werefertoanodeofTasacorenodeifabalancededgeis incidentonit. GoingbacktoExample4.1,edge(5,6)isabalancededge 
P P Bin Bout (since(5,6) 6islessthan(5,6) 12 l l l2P l2P 5 6 P P Bin Bout and(5,6) 9islessthan(5,6) 12). 
l l l2P l2P 6 5 Thus,nodes5and6arecorenodes.However,edge(6,7) P Bin isbiasedtowards7since(6,7) 6islessthan 
l l2P 7 P P Bout Bout (6,7) 16and(6,7) 8islessthan l l l2P l2P 6 7 P Bin . (6,7) 9 ll2P 6 Inthefollowing,westatecertainpropertiesofbalanced 
PP BinBout edges.LetMminfl,g. l2Pl2Pl Lemma4.3.:Thesumofthebandwidthsreservedona balancededge(i,j)ofaVPNtreeTinbothdirectionsisM 
(thatis,CT(i,j)+CT(j,i)M). RevisitingExample4.1,thetotalbandwidthreservedon P Bin balancededge(5,6)isM15. 
l2P l Lemma4.4.:TherestrictionofTtoonlybalancededges formsaconnectedcomponent. Notethat,fromtheabovelemma,itfollowsthatthecore 
nodesareconnectedbyatreeconsistingentirelyofbalanced edges.Thus,ifwedeletethebalancededgesfromT,then 
ineachoftheresultingconnectedcomponents,thereisa singlecorenode.Werefertothecomponentcontaining corenodevbyCv.Ofcourse,ifTcontainsnobalanced 
edges,thenthereisonlyonecomponent.Sincealledgesin thecomponentarebiased,onecanshowthatthereexists auniquenodevinTsuchthateveryedgeincidentonvis 
biasedawayfromit.Thisnodevisthenconsideredtobe thecorenodeforthecomponent. Lemma4.5.:ConsiderthecomponentCvcorresponding 
tocorenodev.Everyedge(i,j)inCvisbiasedtowardsj (assumingjisfurtherfromnodevthani). P Lemma4.6.:ThecostofcomponentCvisdT(v, 
l2(Cv\P)(Bin+Bout ). ll  l)* Thus,aVPNtreeTconsistsofasetofcorenodescon­nectedbybalancededges,andconnectedcomponentsCv 
foreachcorenodecontainingonlybiasededges.Suppose thatcore(T)denotesthesetofcorenodesinTandbal(T) isthesetofbalancededgesinT.Then,fromtheabove 
lemmas,wecaninferthatthecostofT,CT,isequalto PP )*(Bin+Bout M*jbal(T)j+ dT(v,l). v2core(T)l2(Cv\P)ll 
Fromtheabovediscussion,itfollowsthateachVPNtree, forthemostpart,canbecompletelycharacterizedbyits setofcorenodes.ConsiderasetofnodesS.Wedefne 
thecostofthesetofnodesS,denotedbyCS,asM*b+ P (Bin+Bout minv2SfdG(v,l)g*l).Here,bisthenumer l2PlbofedgesintheSteinertreeconnectingthenodesinS.Next, 
weshowhowtoconstructthetreeT(S)forasetofnodes SsuchthatCT(S):CS.First,connectthenodesinSby aSteinertreeandaddalltheSteinertreeedgestoT(S). 
Next,coalesceallthenodesinSintoonesupernode,and constructabreadthfrsttreerootedatthesupernodeand connectingalltheVPNendpointsinP(astheleaves).Add 
theedgesofthebreadthfrsttreetoT(S). Inthefollowing,weshowthattheproblemofcomputing theoptimalVPNtreeisequivalenttothatofcomputinga 
setofnodesSforwhomCSisminimum.Specifcally,we showthatifToptistheoptimaltree,thenfortheminimum CS,CS:CTopt.Thus,oncewedetermineS,wecanalways 
constructthetreeT(S)whosecostisoptimalduetothe followinglemma. Lemma4.7.:LetSbeasetofnodes.ThenCT(S):CS. 
 Thefollowinglemmaenablesustoprovethatcomput­ingthesetofnodesSforwhichCSisminimumyieldsthe optimalVPNtreefortheasymmetriccase. 
Lemma4.8.:ForaVPNtreeT,Ccore(T):CT. Theorem4.9.:LetSbeasetofnodesforwhomCSis minimum.ThenT(S)istheoptimalVPNtree. 
 Thus,wehaveshownthat,fortheasymmetriccase,to computetheoptimalVPNtree,wesimplyneedtocompute asetofnodesSwhosecostCSisminimum;thatis,asetSof 
P nodesforwhomthequantityb*M+minv2SfdG(v,l)g* l2P (BoutBin l+l)isminimum,wherebisthenumberofedges intheSteinertreeconnectingthenodesinS. 
TheproblemofcomputingthesetofnodesSwiththe minimumcostcanbeformulatedasanintegerprogramif weknowtheidentityofoneofthenodesinS.Letxij,yi 
andzebe0-1variables,whereyiis1ifnodeibelongstoS, xijis1ifVPNendpointjisassignedtonodeiandzeis1 ifedgeebelongstotheSteinertreeconnectingthenodesin 
S.Also,letO(V)denotethesetofedgescrossingsets Vand ^^^Bin+Bout V;VinGandBjjj.Supposeweknowapriori thatnodev2S.Then,thesolutiontothefollowinginteger 
programyieldstheoptimalsetofnodesScontainingv. XX minimizedG(i,j)*Bj*xij+M*ze(1) i2Vj2Pe2E subjecttothefollowingconstraints 
X 8j2P:xij?1 i2V 8i2V,j2P:yi;xij?0 XX ^^ 8VcV,v26V,j2P:ze;xij?0 ^^ e2S(V)i2V xij,yi,ze2f0,1g ThefrsttwoconstraintsstatethateachVPNendpointj 
mustbeassignedtoatleastonenodeinS.Thethirdcon­straintensuresthatnodesinSareconnectedbyaSteiner tree.ItachievesthisbyrequiringthatifaVPNendpoint 
jisassignedtoanodei(causingnodeitobelongtoS), theniisconnectedtovbySteinertreeedges.Theobjective functionthatweminimizeisthecostofthesetofnodesS. 
Thus,sinceweknowthatSmustcontainanodefromV, wecancomputetheoptimaltreebyperformingthefollowing steps: 
1.Foreachnodev2V,solvetheintegerprogramto computeSv,theoptimalsetofnodescontainingv(Sv consistsofthosenodesiforwhichyi1intheinteger 
programmingsolution). 2.ReturnthetreeT(Sv)whosecostisminimum. Notethatwhiletheminimumcostnodescomputation 
problemhassomesimilaritiestothewell-knownfacilitylo­cationproblem(FLP)[11],thereisonesignifcantdiference. 
IfweviewthenodesinVasfacilities,theninourcase,the costofeachindividualfacilityis0.However,thechosen facilitiesasawholehaveanassociatedcostsincetheyneed 
tobeconnectedbyaSteinertree,thecostofeachofwhose edgeisM.Thus,thecostofeachindividualfacilityisre­placedbythecostoftheSteinertreeconnectingallthe 
chosenfacilities.  4.2 Rounding Based Approximation Algorithm Solvingintegerprogram(1)tocomputeSvisknownto 
becomputationallyintractable[6].Inthissubsection,we presentanapproximationalgorithmthatisbasedonsolv­ingthelinearrelaxationoftheintegerprogram,andthen 
roundingthefractionalsolutiontoanintegersolutionthat increasesthecostofthefractionalsolutionbyarelatively 
smallconstantfactor.Theroundingalgorithmconsistsof thefollowingtwophases:frstweapplytheflteringand roundingtechniqueofLin&#38;Vitter[9]toobtainanewfrac­tionalsolution,wherethenewsolutionhasthepropertythat 
wheneveranendpointjisfractionallyassignedtoa(par­tiallychosen)nodei,thedistancedG(i,j)associatedwith 
thatassignmentisnottoobig.Wethenshowhowafrac­tionalsolutionwiththisclosenesspropertycanberounded toanear-optimalintegersolution. 
Therelaxationoftheintegerprogramresultsinthefol­lowingLP. XX minimizedG(i,j)*Bj*xij+M*ze(2) i2Vj2Pe2E 
subjecttothefollowingconstraints X 8j2P:xij?1 i2V 8i2V,j2P:yi;xij?0 XX ^^ 8VcV,v62V,j2P:ze;xij?0 ^^ e2S(V)i2V 
xij,yi,ze?0 Itcanbeshownthatusingtheellipsoidalgorithm[10], wecansolvetheaboveLPinpolynomialtime.Letx,y,z 
beanoptimalfractionalsolutiontothisLP.Weshowhow toroundthistoanintegersolution. Let0c1beaconstant(wefxitsvaluelater).We 
usetheflteringtechniqueofLinandVitterfrom[9](that wasalsoemployedin[11])toderiveanewfractionalsolution 
asfollows.ForeachVPNendpointj,wedefneaquantity ajasfollows:supposenisapermutationofnodessuchthat dG(n(1),j):dG(n(2),j): 
:dG(n(n),j).Defnei * Pi0 minfi0:i.1x,(i)j?cg.Now,defneajdG(n(i * ),j). Wewillusethefollowinglatertoproveourapproximation 
result. XX (1;c)*aj:x,(i)j *dG(n(i),j):dG(i,j)*xij(3) i.i* i2V Wedefneanewfeasiblefractionalsolution(zx,yz,z 
)forthe P LPasfollows:foreachendpointj,defnecj xij. i:dG(i j)<Oj Notethatcj?c.Defnexzijxij/cj,ifdG(i,j):aj, 
and0otherwise.Foreachi,defneyziminf1,yi/cg.Fi­nally,foreachedgee,defnez eminf1,ze/cg.Itiseasy toverifythatthisnewsolutionisfeasibletotheLP.We 
nextshowhowtoroundthenewfractionalsolutiontoa near-optimalintegersolutionsuchthateachendpointjis assignedtosomenodeisuchthatxzij>0.Wedenoteby 
Fjfi:xzij>0gthesetofeligiblenodesforendpointj. ProcedureComputeTreeRoundingshowninFigure5 computesafeasibleintegersolution(^x,y^,z^)thatiswithina 
constantfactorofthefractionalsolution(zx,yz,z ).Thepro­cedurebeginsbyclusteringtheVPNendpointsinSteps6{ 
16.EachclusterhasaVPNendpointjthatistheseedof thecluster.ThesetofseedendpointsarestoredinseedSet andSjistheclusterwithendpointjastheseed.Every 
endpointl2Sjhasthefollowingproperties:(1)aj:al, (2)forsomenodei2Fl,dG(i,j):c 0ajorforsomenode i2Fj,dG(i,l):c 
0al(herec 0>1isaconstantthatwe defnelater).WewillassigneachendpointinSjtosome nodeinFj,andthefollowinglemmastatesthatthiswill 
notincreasetheoverallcostbymuch. Lemma4.10.:Foreachl2Sjandi2Fj,dG(i,l): (c 0+2)*al. Proof:Considerani2Fj.DuetothedefnitionofFj,it 
followsthatdG(i,j):aj.Weconsiderthefollowingtwo cases,oneofwhichmustholdbecausel2Sj. i00i0 1.Forsomenode2Fl,dG(i0 
,j):caj.Since2Fl, itmustbethecasethatdG(i0 ,l):al.Thus,dueto thetriangleinequality,dG(i,l):dG(i,j)+dG(i0 
,j)+ dG(i0 ,l)(c 0+1)aj+al.Sinceaj:al,thelemma follows. i00 2.Forsomenode2Fj,dG(i0 ,l):cal.Sincei02Fj, 
itmustbethecasethatdG(i0 ,j):aj.Thus,dueto thetriangleinequality,dG(i,l):dG(i,j)+dG(i0 ,j)+ dG(i0 ,l)c 
0al+2*aj.Sinceaj:al,thelemma holds. procedureComputeTreeRounding(F,o,G,P,v) 1.Tv:=0 2.activeSet:=P 3.seedSet:=0 
4.foreachVPNendpointlinP 5.letF0bethesetofnodesiforwhichdG(i,l):c0ol l 6.while60f activeSet=7.letjbeaVPNendpointinactiveSetwiththeminimum 
valueofoj 8.seedSet:=seedSet[fjg 9.Sj:=fjg 10.foreachendpointlinactiveSetf 11.ifFj0 60Fjl60 \Fl=or\F0=f 
12.deletelfromactiveSet 13.addltoSj 14.g 15.g 16.g 17.letG0bethegraphobtainedfromGasaresultofcoalescing 
allnodesinFjintoasupernodeforeachjinseedSet 18.constructaSteinertreeTconnectingthesupernodesinG0 /*v,ifnotcoalesced,isconsideredasupernode*/ 
19.addedgesinTtoTv 20.letTdirdenotethetreeTwithedgesinTdirectedtoforman outgoingarborescencefromvinG0 
21.foreachjinseedSetf 22.letu2FjdenotethenodewithanincomingarcinTdir 23.foreachw2FjwithanoutgoingarcinTdir 
24.addedgesintheshortestpathfromutowinG,toTv 25.g 26.deleteedgesfromTvuntilitcontainsnoloops 27.returnTv 
Figure5:AlgorithmforComputingVPNTreefrom FractionalLPSolution Inordertomaintainfeasibilityofthesolutiononceend­pointsinSjareassignedtosomenodeinFj,weneedto 
constructaSteinertreeTthatconnectsvtoatleastone nodefromFjforeachjbelongingtoseedSet.Toaccom­plishthis,inthegraphG,foreachendpointjinseedSet,we 
contractthenodesineachFjtoanewsupernode.Wethen connectthesupernodesbyaSteinertreeT,thusensuring thateachsupernodeisconnectedtov(Step18).However, 
notethatalthoughTconnectsthesupernodes(andv)in G0 ,itmayhappenthatTdoesnotformasingleconnected subgraphinG.ThereasonforthisisthatedgesofTmay 
beincidentondiferentnodesinanFj.Thus,inorderto ensurethatTformsaconnectedsubgrapheveninG,in Steps22{24,weselectanodeuinFjandconnectitto 
everyothernodeofFjonwhichanedgeofTisincident. Inthefollowinglemma,weshowthatthenumberofedges P inTviswithinaconstantfactorof 
e2Ezze. Lemma4.11.:ThenumberofedgesinTvislessthanor P 2(c 0+1) equalto*z e. c0;1 e2E Proof:Wefrstshowthatthenumberofedgesinthe 
SteinertreeTthatconnectsthesupernodesinG0(V0 ,E0) P isatmost2z e.ConsideranysetScV0containinga e propersubsetofthesetofsupernodes.Withoutlossofgen­erality,weassumethatSdoesnotcontainv(ifScontains 
v,thenwereplaceSbyV0;S).LetScontainthesupern­odecorrespondingtoendpointj(resultingduetocollapsing nodesinFj).Since(zx,yz,z 
)isafeasiblesolutionforLP(2), PPP z e?xzij?xzij1.So,ifweconsider e2S(S)i2Si2Fj aninstanceoftheSteinertreeproblemwiththesetofsu­pernodesasthesetofnodestobeconnectedin,then 
G0 z eisafeasiblefractionalsolutiontothisproblem.Thus, itispossibletoconstructaSteinertreeTconnectingthe 
P supernodescontainingatmost2z eedges[6]. e WenextshowthatforeveryjinseedSet,connectingnode u2FjtoeveryothernodewinFjwithanoutgoingarc 
inTdir(inSteps22-24)increasesthenumberofedgesinT c 0+1 byafactorofatmost.First,observethatthelength 0;1 
c oftheshortestpathbetweenuandwisatmost2*aj (sinceendpointjisatadistanceofatmostajfromboth uandw).Also,inT,theremustbeapathfromwto 
anodeibelongingtoFlforsomeotherl6jinseedSet. Furthermore,dG(i,j)>c 0 aj,sinceotherwisejandlwould belongtothesamecluster.Thus,thelengthofthepath 
fromwtoiisatleast(c 0;1)aj.Wechargethecostof 2ajofconnectingutowtothissegmentofT{itiseasy toshowthatdisjointsegmentsofTwillbechargedinthis 
manner.So,thenumberofedgesinTincreasesbyafactor ofatmost(c 0+1)/(c 0;1).Thisprovesthelemma. Wearenowinapositiontoshowthenear-optimalityof 
thefnalroundedintegersolution(^x,y^,z^).Inthissolution, inadditiontosettingy^v1,foreveryjinseedSet,for 
nodeu2FjthathasanincomingarcinTdir,y^uissetto1, otherwisey^uissetto0.Further,foreveryendpointl2Sj, lisassignedtonodeu2Fjwiththeincomingarc,thatis, 
x^ul1.Finally,foreveryedgeeinTv,z^e1andz^e0 forallotheredges.Theintegersolutionisclearlyfeasible sinceTvconnectseveryu2Fj(thathasanincomingarcin 
Tdir)tov. Theorem4.12.:Thecostofintegersolution(x,^y^,z^)is withinafactorof10ofthecostoftheoptimalLPsolution 
(x,y,z). Proof:Thecostoftheintegersolution(x,^y^,z^)isgiven PP bydG(i,j)*Bj*x^ij+M*z^e.Dueto i2Vj2Pe2E 
PP Lemma4.10,dG(i,j)*Bj*x^ij:(c 0+2)Bj* i2Vj2Pj2P P 2(c 0+1) aj.Also,duetoLemma4.11,M*z^e:M* P e2Ec0;1 
z e.CombiningthiswithEquation(3)andsincez e: e2E c 0+2P ze/c,wegetthatthecostof(^x,y^,z^)isatmost 1;ci2Vj2P 
P 2(c 0+1) dG(i,j)*Bj*xij+M*ze.Thus,(^x,y^,z^)is c(c0;1)e2E withinaconstantfactoroftheoptimalfractionalsolution 
c 0+22(c 0+1) (totheLP).Thisconstantturnsouttobemaxf,g. 1;cc(c0;1)Choosingc 3 andc 02,wegetavalueof10forthecon­ 
5 stant. TimeComplexity.ThetimecomplexityofProcedureCom­puteTreeRoundingcanbeshowntobeO(n 2(logn+p)), 
wherepjPjandnjVj.Thefrsttermn 2lognisthe timecomplexityofconstructingaSteinertreeinStep18 [6],whilethesecondtermn 
2 pisduetotheoverheadof computingshortestpathsforatmostp(u,w)nodepairsin Steps21{25.  4.3 Primal-Dual 
Algorithm Whiletheroundingbasedalgorithmgivesaconstantfac­torperformanceguaranteeonthecostofthecomputedVPN 
tree(withrespecttothecostoftheoptimaltree),itrequires solvingtheLPrelaxationoftheintegerprogram.ThisLP 
relaxationhasasmallnumberofvariables,butanexpo­nentialnumberofconstraints.Eventhoughtheellipsoid methodcanbeusedtosolvetheLPinpolynomialtime 
[10],itmaynotbecomputationallyefcientandthusim­practical. Inthissection,weproposeanalgorithmthatemploysthe 
primal-dualmethodinordertofndafeasiblesolutionto theintegerprogram(1).ThedualfortheLPrelaxation(2) isasfollows. 
X maximizeaj (4) j2P X 8i2V,j2P:aj; V^j:Bj*dG(i,j) V^CVi2V^ v62V^ X 8e2E: ^Vj :M ^VCV e2S(^V)v62^V 8j2P:aj?0 
^2^^ 8j2P,VcV,v6V: Vj?0 Thedualisemployedtoguideintheselectionoftheset FjofpotentialnodesforeachVPNendpointj.Theprimal 
complementaryslacknessconditionsimplythefollowing: Ifendpointjisassignedtonodei2V,thenaj; P ^^ ^Bj*dG(i,j). 
i2V6VVjv2 P IfedgeeisaSteinertreeedge,then^6^ V^j e2S(V)v2V M. P Thus,Fjconsistsofallnodesiforwhichaj;^^ 
^ i2V6VVj v2Bj*dG(i,j),whileedgeseforwhich^^ V^j P e2S(V)v6V 2 MconstitutepotentialSteinertreeedges.OnceFjfor 
eachendpointjhasbeencomputed,ProcedureCompute­TreeRounding(seeFigure5)isusedtocomputethefnal setofnodesStowhichVPNendpointsaretobeassigned, 
andtheSteinertreeconnectingthenodes. TheoverallprocedureforcomputingtheoptimalVPN treeisshowninFigure6.ProcedureComputeTreeP­rimalDualusestheprimal-dualmethodtocomputeaset 
ofnodesScontainingaspecifcnodev2VandtheSteiner treeedgesconnectingthenodesinS.Thisisdoneinthe bodyoftheforloopspanningSteps2{38foreachnodev2V 
andthetreewiththesmallestcostisreturned.Theprimal­dualalgorithmisaniterativealgorithm{duringeachiter­ation,ajfortheVPNendpointjwiththesmallestajis 
increasedandinordertopreservedualfeasibility,the V^js areappropriatelyadjusted.WhenajforaVPNendpointj 
becomesequaltodG(i,j)*Bjforanodei2V,nodeibe­comesapotentialnodeforassigningendpointjandisadded toFj.Further,whenforanedgee,thesumof 
V^js(for ^ whiche2O(V))becomesequaltoM,theedgeisaddedto thesetofpotentialSteinertreeedgesconnectingthenodes 
thatarechosenforVPNendpoints.TheajforaVPNend­pointjisnotincreasedonceoneofthepotentialnodesfor it(inFj)becomesconnectedtovviapotentialSteinertree 
edges.Thisisbecause,asexplainedbelow,whenajisin­creased,dualfeasibilitycannotbemaintainedbyincreasing 
V^j,wherev6^. 2V procedureComputeTreePrimalDual(G,P) 1.T:=0 2.foreachv2Vf 3.foreachi2V,Ci:=fig 4.foreache2E,we:=0 
5.foreachj2P,Fj:=fjg,Sj:=fjg,oj:=0 6.activeSet:=P 7.while60f activeSet=8.selectVPNendpointjwithminimumoj/Bjfrom 
activeSet 9.letkbethenodeinV;FjsuchthatdG(k,j)is minimum 10.lete=(u,w)25(Sj)suchthatM;weisminimum 11.let£1:=dG(k,j)*Bj;oj 
12.let£2:=M;we 13.if£1:£2f 14.oj:=oj+£1 15.foreache025(Sj),w0:=w+£1 0 ee 16. Fj := Fj [ f kg 17. Sj := 
Sj [Ck 18.ifv2Sj,deletejfromactiveSet 19.g 20.elsef 21.oj:=oj+£2 22.foreache025(Sj),we:=we0+£2 023.foreachl2Cu,Cl:=Cl[Cw 
24.foreachl2Cw,Cl:=Cl[Cu 25.foreachl2Pf 26.ifw2Sl,Sl:=Sl[Cu 27.ifu2Sl,Sl:=Sl[Cw 28.ifv2Sl,deletelfromactiveSet 
29.g 30.g 31.g 32.Tv:=computeTreeRounding(F,o/B,G,P,v) 33.letG0bethegraphobtainedfromGasaresultof coalescingallnodesinTvintoasupernodev0 
34.constructbreadthfrsttreeT0rootedatv0andwhose leavesaretheVPNendpointsinP 35.addedgesinT0toTv 36.deleteleavesfromTvthatdonotcorrespondtoVPN 
endpoints 37.ifCTv CT,T:=Tv 38.g 39.returnT Figure6:Primal-DualAlgorithmforComputing VPNTree DataStructures.Thealgorithmcollectsthepotential 
nodesforaVPNendpointjinFj.Thesearethenodes iforwhichaj?Bj*dG(i,j).Also,foreachedgee,we storesthesumofalltheV^jsthatcontributetoe{here 
^ V^doesnotcontainvande2O(V).Thus,whenweM, ebecomesapotentialSteinertreeedge.Alsonotethatfor ^ anypotentialSteinertreeedgee,ife2O(V),thenV^jcan­notbeincreasedsincethiswouldresultinaviolationofdual 
feasibility.Intheprocedure,Cuisusedtostorethenodes connectedtouviapotentialSteinertreeedges.Finally,Sj 
isusedtostorethesetofallnodesconnectedtonodesin FjviapotentialSteinertreeedges(thusFjSj).Asmen­tionedearlier,onceSjcontainsv,thenajforendpointj 
cannotbeincreasedanyfurther. Algorithm.Thecompleteprimal-dualalgorithmforcom­putingtheVPNtreewithlowcostisillustratedinFigure6. 
Foreachv2V(intheoutermostforloop),thealgorithm frstemploystheprimal-dualmethodtocomputeasetof potentialnodesFjforeachVPNendpointjandasetofpo-tentialSteinertreeedgesthatconnecteachFjtov(Steps3{ 
30).IttheninvokesProcedureComputeTreeRounding tocomputetheSteinertreecontainingvandconnecting thenodestowhichVPNendpointsareassigned.Thistree 
isthenextendedtoconnecttheVPNendpointsinPin Steps32{35. ThevariableactiveSetstorestheVPNendpointsjfor 
whichajcanstillbeincremented.ThesetSjdenotesthe smallestsetV^ofnodesforwhichV^jneedstobeincreased whenajforaVPNendpointjisincreased.Thereasonfor 
thisisthatforeveryi2Fj,aj?Bj*dG(i,j).Thus,in P ordertoensurethatthedualequation^^: aj;i2Vv62V^VjBj*dG(i,j)staysfeasiblewhenajisincremented,V^jwhere 
i2V^mustalsobeincremented.NotealsothatV^jcanbe incrementedonlyifO(V)containsnopotentialSteinertree ^edges.ThisisbecauseforapotentialSteinertreeedgee, 
P ^2^^M.Asaresult,increasing^ife2 e2S(V)v6VVjVj P ^ O(V)couldcausethedualequation^^:M 2^Vtobeviolated.Thus,if^isthevariablethatisincreased 
e2S(V)v6Vj VjtomaintaindualfeasibilitywhenajforaVPNendpointj ^ isincreased,thenVmustcontainallthenodesinCifor 
^ everyi2Fj,oralternatelySjV. Fromtheabovediscussion,itfollowsthatifSjforaVPN endpointjcontainsv,thenajcannotbeincreasedanyfur­ther.Thisisbecausethereareno^variablesforsets 
V^ Vj thatcontainnodev.Asaresult,itisnotpossibletoincrease P ^toensurethatthedualequationaj;^^^: Vji2Vv62VVjBj*dG(i,j)staysfeasiblewhenajisincremented.Thus, 
activeSetonlycontainsVPNendpointsjforwhomSjdoes notcontainv. IneachiterationofthewhileloopspanningSteps7{30, 
ajforasingleVPNendpointjbelongingtoactiveSetis incrementedbyminf11,12g,wherej,11and12areasdefned inSteps8{12.Notethatincreasingajcausesoneofthe 
followingtohappen{(1)ktobeaddedtoFjsinceaj dG(j,k)(if11:12),or(2)edgeetobecomeapotential SteinertreeedgesinceMwe(if1211).Forthelatter 
case,theconnectedcomponentsfornodesconnectedtou andvneedtobeadjusted(Steps23and24).Inaddition, SjsforVPNendpointsjthatcontaineitheruorvneedto 
beexpandedasdescribedinSteps26and27. Finally,notethatinordertomaintainfeasibilityofequa- P tionsaj;^^V^j:Bj*dG(i,j)forendpointsiin 
i2Vv6V 2 Fj,Sjjisincreasedby11/12whenajisincreasedby11/12. 0 This,inturn,contributes11/12toweforalledgese 
02O(Sj) (Steps15and22). TimeComplexity.ThetimecomplexityofProcedureCom­ 2 puteTreePrimalDualcanbeshowntobeO(n(mp+ 
mnp+n 2logn)),wherepjPj,mjEjandnjVj.The outermostforloopperformsniterations,oneforeachnode v2V.Further,foreachiterationoftheoutermostloop, 
thebodyoftheifcondition(Steps14{18)canbeexecuted atmostnptimes,onceforeachVPNendpointnodepair, whilethebodyoftheelsecondition(Steps21{28)canbeex­ecutedatmostmtimes,onceforeachedgeinE.Assuming 
thatunionsinvolvingSjcanbeperformedinO(n)stepsand lookupsofSjcanbecarriedoutinconstanttime,thecom­plexityofSteps14-18canbeshowntobeO(m+n),whilethe 
complexityofSteps21{28canbeshowntobeO(mp+np). Finally,asshownearlier,thetimecomplexityofProcedure 22 
ComputeTreeRoundingisO(nlogn+np).Thus,the ProcedureComputeTreePrimalDualhasanoveralltime complexityofO(n(m 
2 p+mnp+n 2logn)). 4.4 Breadth First Search Based Algorithm ThebreadthfrstsearchalgorithmpresentedinSection3 
canalsobeusedtocomputetheVPNtreefortheasymmet­ricbandwidthcase(seeProcedureComputeTreeSymmet­ricinFigure3).However,sincetheVPNtreecomputation 
problemfortheasymmetriccaseisNP-hard,thealgorithm maynotreturntheoptimalVPNtree.Nevertheless,one canshowthatcostofthetreecomputedbytheprocedureis 
P Bin+Bout l2Pll withinafactorofofthecostoftheoptimal M VPNtree. Theorem4.13.:ThecostofthetreereturnedbyProce­dureComputeTreeSymmetriciswithinafactorof 
P Bin+Bout l2Pll ofthecostoftheoptimalVPNtree. M   5. EXPERIMENTAL STUDY Weconductedanextensiveempiricalstudytomeasure 
theperformanceofourbreadthfrstsearch(BFS)andprimal­dualalgorithms,andcomparedthemwiththeapproachof usingaSteinertreetoconnectVPNendpoints[3].The 
majorfndingsofourstudycanbesummarizedasfollows:  Theprimal-dualalgorithmgeneratesVPNtreeswith thesmallestcostforawiderangeofingress/egress 
bandwidthratios.ItoutperformsboththeBFSand theSteinertreealgorithmsformediumtolargeband­widthratios. 
  Forlowingress/egressbandwidthratios,theBFSand primal-dualalgorithmsconsistentlyoutperformtheSteiner 
treealgorithm.Inmanycases,theyconstructVPN treesthatreservehalfthebandwidthreservedbySteiner trees. 
 TheBFSalgorithmscaleswellforlargenetworkscon­tainingseveralthousandnodes.  InourimplementationofSteinertrees,weusedthe 
2-approximationprimal-dualalgorithmfrom[6]. 5.1 Network Generation Models Inourexperiments,weusedtwodiferentnetworkgen­erators,togeneraterandomnetworkswithdiferentchar­acteristics.OnegeneratorwasbasedonworkbyWaxman 
[12],theotheronworkbyFaloutsosetal.[4].Wegen­eratedrandomandsymmetricnetworksconsistingof50to 5000nodesconnectedbylinkswithlargeresidualcapacities. 
Thegenerationalgorithmsusethefollowingmodels. Waxmanmodel[12].Inthismodel,nodesareplaced onaplane,andtheprobabilityfortwonodestobecon­nectedbyalinkdecreasesexponentiallywiththeEuclidean 
distancebetweenthem.Inourexperiments,weusedthe Waxmanmodeltogeneratenetworksofsizelessthan1000 nodes.Wesetthevaluefortheparameterthatcontrolsthe 
densityofshortedgesinthenetworkto0.9andthevalue oftheparameterfortheaveragenodedegreeto0.1.  Power-Lawmodel[4].Inthismodel,thenodecon­nectivityfollowsapower-lawrule:veryfewnodeshavehigh 
 connectivity,andthenumberofnodeswithlowerconnec­tivityincreasesexponentiallyastheconnectivitydecreases. 
ThismodelisbasedonInternetmeasurements,whereanode isanautonomoussystem(AS).Inourexperiments,weused thePower-Lawmodeltogeneratelargenetworkscontaining 
1000ormorenodes. Asubsetofthenodesineachnetworkischosenrandomly anduniformlyastheVPNendpoints.Forthesymmetric 
bandwidthcase,eachVPNendpointisassignedbandwidth uniformlychosenfromanintervalof2-100Mbps.Further, tomodelasymmetricendpointbandwidths,weintroducea 
newparameter,theasymmetryratior,whichisessentially theingress/egressbandwidthratioforeachVPNendpoint. 
PP BlBl Thesameratioisalsomaintainedforinandout, ll thesumsofingressandegressbandwidthsoverallVPN endpoints. 
Waxman Network Model Number of Nodes Power Law Network Model  Number of Nodes Figure7:EfectofNumberofNetworkNodesonPer­formanceofAlgorithms. 
 5.2 Experimental Results Wecomparetheprovisioningcost(thatis,thetotalband­widthreservedonlinksoftheVPNtree)ofthealgorithms 
forthesymmetricaswellastheasymmetricbandwidth models.Inthestudy,weexaminedtheefectofvarying thefollowingthreeparametersonprovisioningcost:(i)net­worksize,(ii)numberofVPNnodes,and(ii)asymmetry 
ratio. NetworkSize.Figure7depictstheprovisioningcostofthe BFSandSteinertreealgorithmsasthenumberofnetwork 
nodesisincreasedfrom100to4000.VPNendpointsare assignedequalingress/egressbandwidthsandthenumber ofVPNendpointsissetto10%ofthenetworksize.Recall 
1000 Node Network Based on Power Law Model Number of VPN Nodes Figure8:EfectofNumberofVPNNodes. 100 
Node Network Based on Waxman Model with 18 VPN Nodes Bandwidth Asymmetry Figure9:EfectofAsymmetryRatio. 
thattheBFSalgorithmisprovablyoptimalforthesymmet­riccase.Further,unliketheSteinertreealgorithmwhichis 
oblivioustothebandwidthsofendpoints,theBFSalgo­rithmdoestakeintoaccountthebandwidthrequirements forVPNendpoints.Asaresult,itoutperformsSteinertree 
algorithmbyalmostafactorof2forawiderangeofnode values. NumberofVPNNodes.Similarresultsareobtained fortheBFSandSteinertreeapproachesforawiderange 
ofVPNnodevalues(seeFigure8).Intheexperiment,the numberofnodesinthenetworkwerefxedat1000andVPN endpointswereassignedsymmetricbandwidths. 
AsymmetryRatio.InFigure9,weplottheprovision­ingcostsforthethreealgorithmsastheasymmetryratiois increasedfrom2to256.Thenetworksizeandnumberof 
VPNnodesarefxedat100and18,respectively.Interest­ingly,theprimal-dualalgorithmperformsthebestforthe entirerangeofasymmetryratios.Forsmallvaluesofthe 
asymmetryratio(:8),theprimal-dualalgorithmbehaves similartotheBFSalgorithmwhichweshowedtobeop­timalforaratioof1.Thus,bothalgorithmsreserveless 
bandwidththantheSteinertreealgorithmforsmallratio values. Asweincreasetheasymmetryratio,thesizeofthesteiner 
treeconnectingthecorenodesoftheVPNtreealsoin­creases.Consequently,thecostoftheVPNtreecomputed bytheSteinertreealgorithmbecomessmallerthanthecost 
duetotheBFSalgorithm.However,theprimal-dualalgo­rithmperformsthebestsinceitestimatesthecostofthe VPNtreemostaccuratelyasconsistingofacentralcore 
steinertreecomponentwithmultiplebreadthfrsttreescon­nectingthecoretotheVPNendpoints.  6. CONCLUDING 
REMARKS Inthispaper,wedevelopednovelalgorithmsforprovi­sioningVPNsinthehosemodel.WeconnectedVPNend­pointsusingatreestructureandouralgorithmsattempted 
tooptimizethetotalbandwidthreservedonedgesofthe VPNtree.Weshowedthatevenforthesimplescenarioin whichnetworklinksareassumedtohaveinfnitecapacity, 
thegeneralproblemofcomputingtheoptimalVPNtreeis NP-hard.However,forthespecialcasewhentheingress andegressbandwidthsforeachVPNendpointareequal, 
weproposedabreadthfrstsearch(BFS)algorithmforcom­putingtheoptimaltreewhosetimecomplexityisO(mn), wheremandnarethenumberoflinksandnodesinthe 
network,respectively.Wepresentedanovelintegerpro­grammingformulationforthegeneralVPNtreecomputa­tionproblem(thatis,wheningressandegressbandwidths 
ofVPNendpointsarearbitrary)anddevisedanalgorithm thatisbasedontheprimal-dualmethod. Ourexperimentalresultsindicatethattheprimal-dualal­gorithmperformsthebestoverawiderangeofparameter 
values,reservinglessbandwidththanboththeBFSand Steinertreealgorithmsforlargeingress/egressbandwidth ratios.Forsmallbandwidthratios,theBFSandprimal­dualalgorithmsconsistentlyoutperformtheSteinertreeal­gorithm.Inmanycases,theyconstructVPNtreesthat 
reservehalfthebandwidthreservedbySteinertrees. 7. REFERENCES <RefA>[1]R.K.Ahuja,T.L.Magnanti,andJ.B.Orlin.\Network 
Flows".PrenticeHall,1993. [2]B.DavieandY.Rekhter.\MPLSTechnologyand Applications".MorganKaufmannPublishers,2000. 
 [3]N.G.Dufeld,P.Goyal,A.Greenberg,P.Mishra,K.K. Ramakrishnan,andJ.E.vanderMerwe.Afexiblemodel forresourcemanagementinvirtualprivatenetworks.In 
ProceedingsACMSIGCOMM,1998. [4]M.Faloutsos,P.Faloutsos,andC.Faloutsos.Onpower-law relationshipsoftheinternettopology.InProceedingsACM 
SIGCOMM,1999. [5]M.R.GareyandD.S.Johnson.Computersand Intractability:AGuidetotheTheoryofNP-Completeness. 
W.H.FreemanandCompany,1979. [6]D.S.Hochbaum.\ApproximationAlgorithmsforNP-Hard Problems".PWSPublishingCompany,1997. 
[7]S.KentandR.Atkinson.Securityarchitectureforthe internetprotocol.RFC2401,Nov.1998. [8]A.Kumar,R.Rastogi,B.Yener,andA.Silberschatz. 
Algorithmsforprovisioningvirtualprivatenetworksinthe hosemodel.TechnicalReport0112380-001023-23,Bell 
Laboratories,MurrayHill,2000. [9]J.H.LinandJ.H.Vitter.£-approximationswithminimum packingconstraintviolation.InProceedingsACM 
SymposiumonTheoryofComputing,1992. [10]M.Queyranne.Structureofasimplescheduling polyhedron.MathematicalProgramming,58:163{185,1993. 
[11]D.Shmoys,E.Tardos,andK.Aardal.Approximation algorithmsforfacilitylocationproblems.InProceedings ACMSymposiumonTheoryofComputing,1997. 
[12]B.M.Waxman.Routingofmultipointconnections.IEEE JournalonSelectedAreasinCommunications, 6(9):1617{1622,Dec.1988.</RefA> 
  
			
