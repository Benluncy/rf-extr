
 Almost Optimal Permutation Routing on Hypercubes Berthold V¨ocking* Max-Planck-Instut f¨ur Informatik 
Saarbr¨ucken, Germany voecking@mpi-sb.mpg.de ABSTRACT Thispaperdealswithpermutationroutingonhyperube 
networksinthestore-and-forwardmodel.Weintroduethe frst(on-lineandof-line)algorithmsroutinganypermuta­tiononthed-dimensionalhyperubeind+o(d)steps.The 
bestpreviouslyknownresultswere2d+o(d)(obliviouson­line)and2d-3(of-line).Inpartiular,wepresent arandomized,obliviouson-linealgorithmwithrouting 
timed+O(d/logd),  amathinglowerboundofd+f(d/logd)for(random­ized)obliviouson-linerouting,and  adeterministi,of-linealgorithmwithroutingtime 
  d+O(dlogd). Previousalgorithmsloseafatoroftwomainlybeause paketsarefrstsenttointermediatedestinationsinorder 
toresolveongestion.Asaonsequene,themaximumpath lengthbeomes2d-o(d).Ouralgorithmsuseintermediate destinationsaswell,butweintrodueasimple,eleganttrik 
ensuringthattheroutingpathsarenotstrethedtoomuh. Infat,weahievesmallongestionusingpathsoflengthat mostd. 
Themainfousofourwork,however,liesontheshedul­ingaspet.Ononehand,weinvestigatewell-knownand pratialshedulingpoliiesforon-linerouting,namely 
Farthest-to-GoandNearest-to-Origin.Ontheotherhand, wepresentanewof-lineshedulingshemethatisbased onfrugaloloringsofmultigraphs.Thisshememightbeof 
interestforothersparseshedulingproblems,too. 1. INTRODUCTION Communiationinomputernetworksisoftenperformed 
usingpaketswithing,thatis,messagesareputintopak­etstogetherwithadestinationaddressandthesepakets *SupportedinpartbytheISTprogramoftheEUunder 
ontratnumberIST-1999-14186(ALCOM-FT). Permission to make digital or hard copies of all or part of this 
work for personal or classroom use is granted without fee provided that copies are not made or distributed 
for pro.t or commercial advantage and that copies bear this notice and the full citation on the .rst 
page. To copy otherwise, to republish, to post on servers or to redistribute to lists, requires prior 
speci.c permission and/or a fee. STOC 01, July 6-8, 2001, Hersonissos, Crete, Greece. Copyright 2001 
ACM 1-58113-349-9/01/0007 ...$5.00. aremovedinstore-and-forwardfashiontotheirdestinations. Typially,theproblemofroutingasetofpaketstotheir 
destinationsisbrokenintotwopartsbeingtakledindepen­dently:theproblemofseletingtheroutingpathsandthe problemofshedulingthemovementsofthepaketsalong 
thesepaths. Letusillustratethisapproahwiththebestknownalgo­rithmsforhyperubinetworks.Ad-dimensionalhyperube 
isagraphonsistingofn=2dnodes,eahofwhihorre­spondingtoauniquedbitbinarystring.Twonodesare onnetedbyapairofdiretededgesifandonlyifthebit 
stringsofthenodesdiferinonlyonebit.Forsimpliity, weassumetimeproeedsindisretetimesteps.Eahedge representsaommuniationlinkthatantransmitapaket 
ineverystep.lAsimplewaytoselettheroutingpathsisto sendmessagesalongbit-fxingpathsindimensionalorder, 
thatis,apaketisalwaysdiretedalongthelowestdimen­sioninwhihitsurrentpositionanditsdestinationdifer. Deterministi,obliviousrouting.Supposeeverynode 
appearsoneasthesoureofapaketandoneasthedes­tinationofapaket.Thisisalledpermutationrouting. Clearly,givenasetofpaketswithspeifedsoureanddes­tinationnodes,theroutingtimemustdependonthepath 
seletion.LetDdenotethedilation,i.e.,thelengthofthe longestroutingpath,andCtheongestion,i.e.,themaxi­mumnumberofroutingpathsusingthesameedge.Then 
max{CCD}=f(C+D)isatriviallowerboundonthe routingtime.Furthermore,iftheroutingisgreedy(i.e., paketsonlywaitbeauseotherpaketsusethenextedge 
ontheirpath)thenC·Disatrivialupperboundonthe routingtime.Unfortunately,usingbit-fxingpathsdoesnot promisegoodresultsforpermutationroutingonhyperubes 
beausethesepathsproduehighongestionforsomespe­ifpermutations.Forexample,ifweusebit-fxingpathsin ordertoroutethebit-reversalpermutation,whihappears 
quitefrequentlyinpratialappliations,thenweobtaina ongestionofn/d. Evenworse,thiskindofproblemdoesnotonlyarisewhen 
weusebit-fxingpaths,itoursforeverydeterministi, obliviouspathseletionstrategy,i.e.,foreverydeterministi 
strategyinwhihtheroutingpathofapaketsolelyde­pendsonthesoureandthedestinationofthepaketbut notonthepathsofotherpakets.Inpartiular,Borodinand 
lAlternatively,onemightassumethatnodesareonneted byundiretededges.Allofourresultsholdinthisslightly morerestritivemodel,too.Somedetailsintheproofs, 
however,needtobeadapted. Hoproftshowthefollowinglowerboundontheongestion ofobliviousroutinginarbitrarygraphs[3].Foreveryde­terministi,obliviousroutingstrategyonanetworkwithn 
nodesandmaximumnodedegree,thereisapermutation thatproduesaongestionofatleastn/(3/2).Kaklama­nisetal.[7]sligthlyimprovethislowerboundton/(2). 
Furthermore,Kaklamanisetal.giveanalmostmathingup­perboundforthehyperube.Theypresentadeterministi, obliviousalgorithmwithruntimeO(n/d).Nevertheless, 
weonludethatdeterministi,obliviousroutingleadsto unaeptableworst-aseresultsforthehyperubeasittakes f(n/d)stepsforsomepartiularpermutations. 
Randomized,obliviousrouting.Inordertoesapefrom thisdilemma,ValiantandBrebnersuggesttouserandom­izedrouting[20].Inrandomizedrouting,apaketissent 
fromasouretoadestinationintwostages.Themessageis frstsentfromthesouretoanintermediatenodeseleted independently,uniformlyatrandom,andthenthepaketis 
sentfromtheintermediatenodetothedestination.Using thistrikforpermutationroutingonhyperubes,theon­gestionisonlyO(d/logd),w.h.p.2Theprieforthissmall 
ongestion,however,isthatthedilationisinreasedbya fatoroftwo,sothatanalgorithmusingthistrikneeds atleast2dstepsforroutingarbitrarypermutations.Up­fal[17]wasthefrstwhointroduedapaketsheduling 
algorithmahievingruntimeO(d),w.h.p,andValiant[19] improvedonthisresultshowinghowtoahieveroutingtime 2d+O(d/logd),w.h.p. 
Severalattemptshavebeenmadetoahievesmallon­gestionwithoutinreasingthemaximumpathlength.For example,Valiant[19]suggeststhefollowingalgorithm.For 
eahpaketstartingatuanddestinedforvtheroutingalgo­rithmhoosesrnodesWlCCWrindependently,uniformly atrandom.ThenitseletsanodeWi(1:i:r)insuha 
waythatthesumoftheshortestpathlengthsfromutoWi andWitovisminimizedovertherhoiesofW.Thepaket thentakesbit-fxingpathsfrstfromutoWiandthenfrom 
Witov.Valiantshowsthatifr=dthenthemaximum pathlengthofallsoure/destinationpairsisd+o(d).This trikblowsuptheexpetedongestiononeveryedgeonly 
byafatorofaboutd. Reently,Kim,Lehmann,andLeighton[8]obtainedasim­ilarresultonthedilationinreasingtheongestiononlyby 
afatorof1+o(1).Theyobservedthatthefrationofthose intermediatedestinationsthatleadtoapathlengthofmore 
thand+dlogdisonlyo(1).Thus,ifonehoosesthe intermediatedestinationsonlyfromthosenodesthathave distaneatmostd+dlogdthentheprobabilityspaeis 
hangedonlyslightly,sothattheongestioninreasesonly byafatorof1+o(1). Unfortunately,however,neitherValiantnorKimetal.an 
giveshedulingalgorithmsthatexploitthesmalldilation andongestioninordertodeliverallpaketsintimeC+D= d+o(d). 
Of-linerouting.Untilnowweimpliitlyassumedon-line routing,thatis,allroutingdeisionshavetobemadeus­ingonlyloalontrol.Of-lineroutingallowsthataglobal 
instaneomputestheroutesofthepaketsandthepaket 2Throughoutthispaper,theterm"w.h.p."means"with -n highprobability",i.e.,withprobabilityatleast1-n, 
where0denotesanarbitraryonstant. shedule.Thebestknownof-linealgorithmsforpermuta­tionroutingonthehyperubearebasedonembeddingsof 
theso-alledBenessnetwork[2].Inthisnetworkthereex­istnon-overlappingpathsforeverypermutation(andone anomputethesepathsintimeO(nlogn)onauniform 
RAM).EmbeddingtheBenessnetworkintothehyperube yieldspathswithongestionatmosttwo.TheBenessnet­workapproahbasiallyorrespondstohoosingintermedi­atedestinationsinaoordinatedfashion(ratherthansim­plyatrandom).First,paketsareroutedonbit-fxingpaths 
fromthesouretotheintermediatedestinationininreasing orderofdimension.Thenthepaketsareroutedfromthe intermediatetothefnaldestinationsusingreversebit-fxing 
pathsindereasingorderofdimension.Unfortunately,this tehniqueyieldspathsoflengthupto2daswell. Theshedulingofthepaketsalongthepathsonstruted 
bytheBenessnetworkapproahisstraightforward.Letus onsiderthetwoolletionsofsubpathsontainingthose subpathsfromthesourestotheintermediatedestinations 
andthosesubpathsfromtheintermediatetothefnaldes­tinations,respetively.ThenthesimulationoftheBeness networkyieldsthattheroutingpathsineahofthesetwo 
olletionsareedge-disjoint.Thus,splittingtheroutinginto twophases,thatis,frstroutingallpaketstotheinterme­diatedestinationsandafterwardsroutingthepaketstothe 
fnaldestination,thereisnoontentionamongthepak-etssothateahphasetakestimeatmostd.Somefurther improvementsyieldroutingtime2d-3[18]. 
Ourontribution.Wepresentasimple,eleganttrikthat seletspathsofmaximumlengthdwhileinreasingtheon­gestiononlybyatmostafatoroftwo.Thistrikworks 
foron-lineaswellasforof-linerouting.Intheon-linease, wesimplyhoosearandomnodevanditsomplementv (i.e.,thenodewithbitwise-inverselabel)asalternativein­termediatedestinationsforeverypaketandsendthepaket 
alongtheshorterofthetwoalternativeroutes.Similarly,in theof-linease,wehoosetheintermediatedestinationofa 
paketamongaarefullyhosennodeanditsomplement. Intheon-linease,omplementalroutingyieldsaonges­tionofO(d/logd),w.h.p.Intheof-linease,ityieldsa 
ongestionofatmostfour. Ourmajorontributionsaretheanalysesofsheduling protoolsontopofomplementalrouting.Asdesribed 
above,theknownshedulingalgorithmsarenotableto translatethesmalldilationandongestionintoasmallrout­ingtime.Infat,knownanalysesheavilyrelyonstrutural 
propertiesoftheroutingpathsandanonlyshowanup­perboundofabout2dsteps,eveniftheroutingpathsare muhshorter.Inthispaper,wepresentthefrstrouting 
algorithmswithguaranteedruntimed+o(d). InSetion2,weintrodueanobliviouson-linealgorithm thatroutesanypermutationintimed+O(d/logd).We 
ahievethisroutingtimeusingaombinationoftheom­plementalroutingtrikwithverysimple,well-knownand pratialshedulingpoliies,namelyFarthest-To-Go(FTG) 
andNearest-To-Origin(NTO).(Wewanttopointoutthat ourruntimeanalysisgoesthroughalsoforNTO/FTGon topofotherpathseletionstrategiesthatguaranteeshort 
pathsandsmallongestionsimultaneously,e.g.,thepath seletionstrategysuggestedbyKimetal.[8].) Furthermore,inSetion3,wegiveamathinglower 
boundforthelassofobliviouson-linealgorithms.We showthatforany(randomized)obliviousalgorithmthere existsapermutationsuhthatthealgorithmneedsatleast 
d+f(d/logd)stepsinexpetation. Finally,inSetion4,wedesribeanof-linealgorithmthat takesonlytimed+O(dlogd)usingedgebufersofsize 
three.Observethatthisupperboundseparatesof-lineand obliviouson-linerouting.Forof-linerouting,weintrodue 
newshedulingshemesbasedonfrugaloloringsofmulti­graphs.Webelievethatthistehniqueispromisingalso formoregeneralproblems.Inpartiular,someoftheideas 
mightbeusedasafrststeptowardseÆientalgorithmsfor sparse,non-uniformjobshopshedulingproblems,i.e.,job 
shopshedulingproblemswithrelativelysmallongestion. 2. THE ON-LINE ALGORITHM Ifonehoosesintermediatedestinationsuniformlyatran­domthentheaveragepathlengthisonlyd.Whenhoosing 
nsuhpaths,however,itwillbeverylikelythatoneofthem haspathlengthalmost2d.Inthefollowingwedesribea simpleandeleganttrikthatreduestheworst-asepath 
lengthfrom2dtodwhileinreasingtheongestiononlyby afatoroftwo.Afterwardswewilldesribetheorrespond­ingshedulingalgorithmthatahievesruntimed+o(d). 
2.1 Randomized complemental routing Thefollowingalgorithmisappliedindependentlytoevery paket.Fixapaketp.Letsandtdenotethesoureand 
destinationnodeofthispaket,respetively.Wehoosea d-bitbinarystringvuniformlyatrandom.Nowweonsider twoalternativeroutingpaths,oneusingvandtheother 
usingtheomplementv asintermediatedestination.For bothsubpaths,weusebit-fxingpathsindimensionalorder. 
IfthelengthofthepathW=s-v-tisshorterthanthe lengthofthepathWv=s-v -tthenwehoosethepath W,otherwisewehoosetheomplementalpathWv. 
Thefollowinglemmashowsthatthispathseletionstrat­egyensuressmalldilationandongestion.Fixarouting permutationJ.Foranedgee,let(e)denotearandomvari­ablethatdesribesthenumberofroutingpathsthatross 
edgeeunderomplementalrouting.Let'(e)denotethe orrespondingrandomvariableunderstandardrandomized rounding(i.e.,hoosingintermediatedestinationsuniformly 
atrandom). LEMMA2.1.Randomizedomplementalroutingselets pathsoflengthatmostd,andE[(e)]:2E['(e)],forev­eryedgee. 
PROOF.First,weshowthatthedilationisatmostd. LetIWIandIWvIdenotethelengthofthepathsWandWv, respetively,forafxedpaketp.Then 
IWI=dist(sCv)+dist(vCt) =(d-dist(sCv ))+(d-dist(vvCt)) =2d-(dist(sCv )+dist(vvCt)) =2d-IWvI Thus,eitherIWvI:dorIWI:d.Inotherwords,thepath 
lengthisatmostd. InordertoshowE[(e)]:2E['(e)],wesplittheon­gestionofeunderomplementalroutingintotwoparts: 
Leta(e)denotetheongestionausedbythepathsusing theintermediatedestinationstakingatfrstplae.Clearly, E[a(e)]:E['(e)].Nowletb(e)denotetheongestion 
ausedbytheomplementalpaths.Asinvertingallbit­stringsdoesnothangetherandomexperiment,E[b(e)]: E['(e)]aswell.Consequently, 
' E[(e)]=E[a(e)+b(e)]=E[a(e)]+E[b(e)]:2E[(e)] 2.2 On-line scheduling using NTO/FTG Supposethepaketsareforwardedalongroutingpaths 
hosenaordingtorandomizedomplementalrouting.We showthataombinationoftwoverysimpleshedulingpoli­ies,namelyFarthest-To-Go(FTG)andNearest-To-Origin 
(NTO),deliversallpaketsind+o(d)steps.Inaseof ontentionforanedge,FTGgivespreedenetopakets withlargerdistanetotheirdestinationwhereasNTOgives 
preedenetopaketsthatarelosertotheirsoursenoe. ObservethatFTGandNTOareequivalentifallrouting pathshavethesamelength. 
Inpartiular,weassumethatpaketsonthebit-fxing pathstotheintermediatedestinationsapplyNTOpree­denerules,paketsonthebit-fxingpathstothefnal 
destinationsapplyFTGpreedenerules,andifanNTO paket(i.e.,apaketthathasnotyetreaheditsinterme­diatedestination)meetsanFTGpaket(i.e.,apaketthat 
haspassedtheintermediatedestination)thenwepreferthe NTOpaket.Furthermore,tiesarebrokenaordingtoan arbitraryfxedoderamongthepakets,e.g.,usingtheiden­titynumberofthesourenodesofthepakets. 
THEOREM2.2.Randomizedomplementalroutingin ombinationwithNTO/FTGyieldsroutingtimed+ O(d/logd). Thefollowinganalysisreferstospeifdetailsofthede­sribedNTO/FTGprotool,e.g.,onthefatthatpakets 
onthefrstpartoftheirroutingpathsarepreferredagainst paketsontheseondpart.Theresultitself,however,is moregeneral.Forexample,thereexistsvariationsofthe 
omplementalroutingtehniqueusingplainNTOorFTG shedulingforwhihoneanshowthesametimebounds. Wewillpresenttheseresultsinmoredetailinanextended 
versionofthispaper.Herewerestritourselvestothe NTO/FTGprotoolasitleadstoasimpleranalysis. Beforeweturntotheproofitself,letusmakesometeh­nialremarksontheideasandtehniquesthatwewillusein 
theanalysis.WewilltranslatetheNTO/FTGprotoolinto aprotoolwithpriorityranksandthenwewillexploitthese ranksina"delaysequene"argumentsimilartotheanaly­sesin[9,11,15,19].Themajordiferenetothoseanalyses 
isthatweassumedeterministipriorityranksthatinrease whenpaketsmoveforwardratherthanrandomlyhosen, statiranks.Wehavepresentedtheideaofinreasingranks 
beforein[14].Theso-alledgrowingrankprotoolgeneral­izesresultsknownforlevelednetworkstogeneralnetworks. 
Forthepermutationroutingproblemonhyperubesthat weonsiderhere,however,thegrowingrankprotoolyields onlyanupperboundofO(d).TheNTO/FTGprotoolim­plementstheideaofinreasingranksinformofasimple, 
deterministishedulingpoliy.Thisvariantwillenableus toboundtheroutingtimebyd+O(d/logd). ProofofTheorem2.2.NTOandFTGanbeex­pressedintermsofpriorityranks.Wedenotetherankof 
apaketpwhilewaitingformovingforwardalonganedge ebyr(pCe).Ifeistheithedge(i?1)onp'spathtothe intermediatedestinationthenr(pCe)=i-1.Ifeistheith 
lastedge(i?1)onp'spathtothefnaldestinationthen r(pCe)=d-i.Weanviewthisasiftherankofpisin­reasedbyonewheneverittraversesanedgeanditsrank 
isadditionallyinreasedbyd- (p)?0whenpreahesits intermediatedestination,where (p)denotesthelengthof p'sroutingpath.Furthermore,wedefnetheident-rankof 
pateasr *(pCe)=r(pCe)+soure(p)/n.Observethatthe NTO/FTGprotoolensuresthefollowingpriorityrule. INVARIANT2.3.WhenanNTO(FTG)paketpdelays 
anNTO(FTG)paketp ' atalinke,thenr(pCe):r(p ' Ce) andr *(pCe)<r *(p ' Ce). Observethatthisruledoesonlyholdamongpaketsofthe 
samekind.IfpisanNTOpaketandp ' anFTGpaket, thenpispreferredagainstp ' regardlessoftheranks.Nev­ertheless,inordertodelayapaketforseveraltimesteps 
thereneedstoexistahainofpaketswhoserankssatisfy ertainmonotoniityonditions.Thisisformalizedinthe followingdelaysequeneargument. 
DEFINITION2.4.Forpositiveintegers ands,letan ( Cs)-delaysequenebedefnedby A)adelaypathPoflength ,i.e.,apaththroughthe 
networkonsistingof delayedgese(1)CCe( ); B)sintegers lCC swith 1: l:···: s: (Forsimpliityofthefollowingstatements,letusaddition­allydefne 
o=1and s+l= .)Thedelaypathon­tainsatmost2dedgesinthefollowingorderofdimensions dCd-1C1CdCd-1C1,possiblyskippingsomeofthese 
dimensions. Thedelaysequeneisalledativeifthereexistss+1 delaypaketspoCpCCpsuhthat ls C)theroutingpathofpaketpiinreverseorder(i.e., 
fromdestinationtosoure)ontainsthesubpath e( i)CCe( i+l)P,for0:i:s; D)paketpipotentiallydelayspaketpi-lonedgee( 
i), i.e.,r *(piCe( i))<r *(pi-lCe( i))orpiisanNTO paketandpi-lisanFTGpaket,for1:i:s. Theproofofthefollowinglemmaontainsaonstru­tionshemeofanativedelaysequenethatwillgivesome 
insightintotheomponentsandonditionsgiveninthedef­initionabove.Observethatthelemmalimitsthelengthof thedelaypathtoatmostd. 
LEMMA2.5.IftheroutingtakesTstepsthenthereexists anative( CT- )-delaysequenewith1: :d. PROOF.Wegiveaniterativeonstrutionshemeforthe 
delaysequene.Letpobeapaketthatmovesforwardin stepT(orlater)alongthelastedgeonitsroutingpath. Wefollowpo'sroutingpathbakwardstothelastedgeon 
thispathwhereitwasdelayed.Thepaketthatausedthe delayisalledpl.Nextwefollowthepathofplbakwards untilwereahanedgeatwhihplwasforedtowaitby 
anotherpaketthatweallp2.Nowwehangethepaket againandfollowthepathofp2bakwards,andsoon. Weontinuethisonstrutionuntilwereahapaketps 
movingalongthefrstedgeofitsroutingpath.Thepath fromthedestinationofpstothesoureofporeordedby theaboveproessisdefnedtobethedelaypathP.Let 
denotethelengthofthedelaypath.For1:i:s,wedefne the i'sinsuhawaythatpaketpidelayspaketpi-lon edgee( i),for1:i:s.Inthisway,therequirementsin 
A,B,C,andDarefulflled. Nextletusshow :d.Observethatthesequeneof delaypaketsstartswithFTGpaketsanfnisheswithNTO 
pakets.Inpartiular,thereisauniquej{0CCs-1}suhthat pi(i:j)traversesedgee( i)asanFTGpaket,and  pi(ij)traversesedgee( 
i)asanNTOpaket.  LetushavealoserlookatpaketpH.Reallthatthepath e( HCCeisasubpathofpH'sroutingpath.Wedis­ 
+l)( H) tinguishtwoases. Case1:SupposepaketpHvisitsitsintermediatedesti­nationonthesubpathe( HCCe( H).Inthisase, 
+l)pH passese( HasanNTOpaketandarrivesate( H)asan +l)FTGpaket.ThisimpliesthatallFTGpaketsinthedelay sequenearedelayedonlybyFTGpakets.Inombination 
withInvariant2.3,weobtain r(piCe( i)):r(pi-lCe( i))C for1:i:s.Moreover, r(piCe( i))+( i- i-l):r(piCe( 
i-l)) asranksareinreasedbyone(ormore)whenevertheytra­verseanedge.Iteratingthesetwoequationsyields r(psCe( 
s))+( s- o):r(poCe( o)) Furthermore,applying r(psCe( s+l))+( s+l- s)=r(psCe( s))C andusingtheidentities 
o=1, s+l= ,gives r(psCe( ))+( -1):r(poCe(1))C whihimplies -1:d-1sineranksarefrom[d]= {0CCd-1}. Case2:SupposepHpassesedgee( 
HasanFTG +l)alreadypaket.Inthisase,theFTGpaketpHisdelayedbythe NTOpaket+ledge+l).the pHone( HSupposedimension 
ofthisedgeisk.Underthisassumption,Pfrstfollowsthe routingpathsofFTGpaketsinoppositediretionalong edgesofthedimensionsdCd-1Ck(possiblyskippingsome 
ofthesedimensions)andthenitfollowstheroutingpathsof NTOpaketsalongedgesofthedimensionsk-1Ck-2CC1. Consequently,thedelaypathhaslengthatmostd. 
Finally,theequalitys=T- anbeobtainedasfollows. Everytimestepoveredbyouronstrutionorresponds eithertooneofthesreordeddelaysortoamovementof 
apaketalongoneofthe edgesonthedelaypath.Aswe overatleastTtimesteps,weobtainT: +s.Hene, terminatingtheonstrutionattherighttimeyieldsT= 
+s. Lemma2.5showsthataslowpakettakingTormore stepsisalwaysaompaniedbyanativedelaysequene ontainings?T-dpakets.Thus,theprobabilityforthe 
existeneofsuhadelaysequenewithsdelaypaketsisan upperboundontheprobabilitythattheroutingtimeisat leastT.Inthefollowing,wewillestimatethisprobability. 
First,weestimatethenumberofpossibledelaysequenes. Thenwemultiplythisnumberbytheprobabilitythatany partiulardelaysequenebeomesative. 
Letusassignanintervalofrankstoeahedge.Inparti­ular,wedefne ontiguous,non-emptyintervalsofranks U R(1)CCR( 
)suhthatR(i)=[d]andtheranksin R(i+1)arestritlysmallerthantheranksinR(i),for 1:i< .Observethatthedefnitionofanativede­laysequeneensuresthatthereexistsanrankassignment 
R(1)CCR( )suhthatrankece.)(pi)R(i),for0:i:s LEMMA2.6.For :d,thenumberof( Cs)-delayse­queneswithrankassignmentsisatmost 
 d+s s n s PROOF.Wealulatethenumberofdiferenthoiesfor theomponentsofthedelaysequene. Therearenpossibilitiestohoosethefrstnodeonthe 
22d2 delaypathandatmost:ntohoosethedelay edgesfromtheatmost2ddimensionsoveredbythe delaypath.Observethatthesehoiesalsodetermines 
thevalueof . Furthermore,thenumberofpossibilitiestohoosethe sequeneofnon-dereasingintegers lCC sis +sd+se(d+s)s 
:: sss 2d theintervalsofranks. Finally,thereareatmost=nwaystodetermine Multiplyingthesenumbersyieldsthelemma. 
Nowletusassumethattheomponentsofthedelayse­quenearefxed.Wewillshowthattheativationofthe fxeddelaysequeneisveryunlikelybeauseoftheinde­pendentrandomhoiesfortheroutingpaths.Forthea­tivationofthedelaysequeneweneedsdelaypaketsthat 
hoosetheirintermediatedestinationsinsuhawaythatall onditionsarefulflled.First,weshowthatthesamepaket 
annotourtooofteninthedelaysequene. LEMMA2.7.Eahpaketappearsatmosttwieinana­tivedelaysequene,oneasNTOpaketandoneasFTG 
paket. PROOF.Bit-fxingpathsareshortestpaths.Following theargumentsin[14]wewillshowthatapaketpona shortestroutingpathappearsatmostoneinthedelay 
sequene. Suppose,inontrasttoourlaim,thatpaketpours twieinthedelaysequene.Thenthereareiandjwith 0:i<j:sandp=pi=pH.Thus,theroutingpathof 
prossesthedelaypathattheedgese( H)ande( i)inthat order.Let'denotethenumberofedgesontheroutingpath ofpfrome( 
H)toe( i).Thentherankofpisinreased' timesonthispartoftheroutingpathsothat r * (pCe( i))=r * (pCe( H))+'(1) 
Ontheotherhand,eahpaketpkwithi<k:jde­laysthepaketpk-latlinke( k).Thus,r *(pk-lCe( k)) r *(pkCe( k)).Furthermore,theranksareinreasedonevery 
edgeonthedelaypathbetweeneHandeibyone.Let ' ' denotethenumberofedgesontheroutingpathofpfrom e( H) toe( 
i). Then r * (pCei) = r * (piCe( i)) r * (pHCe( H))+' ' = r * (pCe( H))+' ' ? r * (pCe( H))+' (2) Notethat' 
' ?',beausetheroutingpathofpisashortest path.Clearly,(2)ontradits(1).Consequently,pappears atmostoneinthedelaysequene. 
Forthetimebeing,letusonsideronlyNTOpaketsand theirroutingpaths.Foreverypaketp,letthebinaryran­domvariableXpbeoneifpaketphooseanintermedi­atedestinationinsuhawaythatitisaandidateforan 
NTOdelaypaket,i.e.,thereexistsi{1CC }suhthat thefrstpartoftheroutingpathofprossesedgee(i)and rankR(i).DefneX=Xp.Inotherwords,X 
eci)(p)pisthenumberofandidatesforNTOdelaypakets.Inthe following,wewillfrstestimateE[X].Afterwards,wewill 
applyaChernofboundinordertoobtainanupperbound onXthatholdsw.h.p. LEMMA2.8.E[X]:3d. PROOF.Forsimpliity,letusassumethatpaketsare 
routedunderstandardrandomizedrouting,thatis,thein­termediatedestinationsarehosenindependently,uniformly 
atrandom.Lemma2.1showsthatthisassumptionafets ourupperboundsonE[X]onlybyafatoroftwo. Undertheaboveassumption,theprobabilitythatafxed 
pakethasrankrafterpassingthefrstk-1dimensions(k r?0)andatuallyhastotraverseanedgeofdimension krisequivalenttotheprobabilitythatkindependent 
ointossesyieldr+1timeshead.Thisprobabilityis k 2 -k1 :V r+1J(r+1)   e)e)e) Y2-Y2:2-2:2: beause:::and::1/Jx,forinte­gersx,ywithx?y?1.(Thefrstinequalityanbe 
explainednielyasfollows.Forfxedx,theprobabilityto seexheadsduringyointossesismaximizedfory=2x. e)e) 
2-Y2:2-2: Thus, Y:::.Theseondinequalityfollows fromStirling'sformulae.) Notiethatourestimationaboveisindependentfromk. 
Inpartiular,theprobabilitythatafxedpakethasrankr andVusesanedgeofanarbitraryfxeddimensionisatmost 1/J(r+1).Sinetherearenpakets,theexpetednum­berofpaketsVwithrankrusingedgesofanyfxeddimension 
isatmostn/J(r+1).Nowletusfousonthenumbers ofpaketsonindividualedges.Clearly,thenumberofedges perdimensionisn.Furthermore,theedgesofanyfxed 
dimensionareindistinguishablewrt.ourexperiment.As aonsequen,theexpetednumberofpaketswithrankr V thattraverseanyfxededgeisatmost1/J(r+1).Hene, 
summingoverall edgesonthedelaypathyields e 1E[X]:V i=lJ(r+1) rERci) d-l =V r=oJ(r1+1) d 1 :dr oJr 
/ d =2:15d J Finally,multiplyingbytwoyieldsthelemma. ObservethatXisasumofindependentbinaryrandom variables.Therefore,Xissharplyonentratedaroundits 
mean.Inpartiular,Xanbeboundedabovebyapplying aChernofboundasfollows.LetK?1denoteanarbitrary numb er.Defneak 
= Kd.Inthisway, Kd =3aKd. Iogd2Iogd Lemma2.8showsE[X]:3d.Consequently, [K] d Pr X?=Pr[X?aK(3d)] 2log 
d a.c3 d) e : aK Kd/c2Iogd) 6elogd = Kd -K :nC providedthatdissuÆientlylarge.Untilnowweonsidered onlyNTOpakets.Analogously,let.denotethenumber 
ofandidatesfortheFTGdelaypakets.Forsymmetry reasons,thesepaketsanbetreatedompletelyanalogously totheNTOpakets.Lemma2.7yieldss:X+.,and 
onsequently, [][K][K] Kd dd Pr s?:PrX?+Pr.? logd2logd2logd -K :2nC forarbitraryK?1.Multiplyingthisboundwiththeupper 
boundonthenumberofdelaysequenesgiveninLemma2.6 showsthattheprobabilityfortheexisteneofan(sC )-delay sequeneisatmost 
-Kd+s s 2n n s Thistermannowbeboundedabovebyn -n ,forarbitrary onstant0andsuitablyhosens=O(d/logd).Finally, 
Lemma2.5givesT:d+s=d+O(d/logd),w.h.p.This ompletestheproofofTheorem2.2. 3. A LOWER BOUND FOR OBLIVIOUS 
ROUTING Weshowthatouron-linealgorithmahievesarouting timethatisbestpossibleforthelassofobliviouson-line 
algorithms. THEOREM3.1.Forany(randomized)obliviouson-line algorithmAthereisapermutationwithexpetedrouting 
timed+f(d/logd). PROOF.Yao'sLemmaallowsustoassumethattheon­sideredalgorithmsaredeterministi.Foreverydeterministi 
algorithmA,wewilldesribearandomexperimentseleting apermutationinsuhawaythat,withprobability1-o(1), theruntimeofalgorithmAisatleastd-,+L-1,for 
suitable,=O(logd)andL=f(d/logd),whoseexatval­ueswillbespeifedlater.Thus,theexpetedruntimeisat least(1-o(1))(d-,+L-1)=d+f(d/logd),andthe 
theoremisshown. Thepermutationsareseletedasfollows.Wepartition 2d-' thenodesofthehyperubeintogroupseahofwhih 
ontainingthosevertiesthatdiferonlyinthelast, 2'bits.Foreahbinarystringq{0C1}d-'let '' Jq:{0C1}-{0C1} 
bearandompermutation.Thenforeveryq{0C1}d-' andr{0C1}',thepaketstartingatnodeqrisdireted tonodeqvJq(r)withqvdenotingtheomplementofq. 
Observethatthedistanebetweenanysoureanddes­tinationnodeintheonsideredlassofpermutationsisat leastd-,=d-O(logd).Furthermore,observethateah 
soureanddestinationpairdefnesauniqueroutingpathof lengthatleastd-,beauseweassumethatAisdetermin­isti.Clearly,ifoneofthesepathshaslengthlargerthan 
2dthenthereexistsapermutationthattakesmorethan2d steps.Consequently,weanassumeinthefollowingthat thelengthofallpossibleroutingpathsisupper-boundedby 
2d. AnedgeeisalledritialifthereareLroutingpaths eahofwhihontainingeatthesamepositioni.The existeneofatimeritialedgeeatpositioniausesa 
runtimeofatleast (i-1)+L+(d-,-i)=d-,+L-1 beausethefrstpaketbelongingtooneoftheritialrout­ingpathsneedsatleasti-1stepstoarriveateandthe 
lastofthesepaketstraverseseatleastLstepslaterand requiresatleastd-,-ifurtherstepstoreahitsdesti­nation.Inthefollowing,wewillshowthatthereexistsa 
ritialedge,withprobability1-o(1). Foreverynodes,letP(s)denotethesetofthosepaths startingatsthatanbetakenbyalgorithmA.Depend­ingontheseletionofthepermutation,exatlyoneofthese 
pathsbeomesaroutingpath.Sinetherearer=2'possi­bledestinationsforthepaketstartingats,IP(s)I=rand theprobabilityforeahpathtobeseletedis1/r.Defne 
A(sCz)={eIeisanedgeinatleastzpathsfromP(s)} Thefollowinglemmashowsthattheremustbeseveraledges passedbyseveralpathsfromP(s).Weassumer?dz. 
LEMMA3.2.IA(sCz)I?r/(2dz). PROOF.LetBdenotetheedgesinidentonA(sCz)but notinA(sCz)itself.Clearly,IBI:2dIA(sCz)Isinethenode 
degreeisd.LetRCP(s)denotethosepathswhosedes­tinationisnotinidentonanedgesfromA(sCz).Atmost 2IA(sCz)IpathsstartonnodesinidentonA(sCz).There­fore,IRI?r-2IA(sCz)I.Observethats 
Rbeause r?dzimpliesthatsisinidentonanedgefromA(sCz). Thus,allpathsinRhavetotraverseanedgefromBinorder 
toreahtheirdestination.AsedgesinBanbeontained inatmost(z-1)pathsfromR,weobtainIBI(z-1)?IRI. Combiningtheseinequalitiesgives 
IBI(z-1)IRIr IA(sCz)I(z-1)d???-IA(sCz)I 222 Finally,solvingforIA(sCz)Iyieldsthelemma. Nowletusdefne T(z)={(sCe)IeA(sCz)} 
ApplyingLemma3.2yieldsIT(z)I?nr/(2dz).Weanin­terprettheelementsinT(z)astokensthatareplaedonthe edges.Atokenwithlabelsonedgeemeansthatatleastz 
pathsfromP(s)traversee.Letusremoveaminimalnum­beroftokenssothatthenumberoftokensisamultipleofz oneahedge.Nextwepartitionthetokensintogroupseah 
ofwhihontainsexatlyztokensofthesameedge.Taking intoaounttheremovedtokens,thenumberofgroupsisat least 
IT(z)I-zndnr ?-nd?nC z2dz2 forr?2d2 z 2+2dz2 . Eahtoken-group9orrespondstoanedgeegandatleast zsourenodessuhthatforsouresatleastzofthepathsin 
P(s)rossedgee.Wedefnethat9isritialiftherandom permutationpiksatleastLoftheatleastz 2pathsof9 thatontainegatthesamepositioni,forsome1:i:2d. 
Clearly,if9isritialthanegisritial,too.Thusitremains toshowtheexisteneofaritialgroupwithprobability 1-o(1).First,letusonsideronlyonefxedtoken-group9 
independentlyofothergroups. LEMMA3.3.Pr[9isritial]?n -l/2 . PROOF.Reallthatweassumethatallpathshavelength 
atmost2d.Therefore,weanidentifyaninteger1:i:2d suhthatatleasty=Iz/(2d)1sourenodesrepresentedby thetoken-group9haveypossibleroutingpathsontaining 
egatpositioni.Fixasouresfulfllingthisondition.Fix asetP ' (s)CP(s)ofsizeythatontainegatpositioni. Wesaythatsisritialiftherandompermutationpiks 
oneofthepathsfromP ' (s).BeauseeahpathinP ' (s)has probability1/rtobeseleted,weobtain y Pr[sisritial]= 
r Clearly,weanlower-boundtheprobabilitythatatleastL souresareritialbytheprobabilitythatexatlyLsoures 
areritial.Supposeforamomentthatallsouresfrom group9belongtodiferentpermutationsubgroupssothat thepathseletionfordiferentsouresarestohastiallyin­dependent.ThentheprobabilitythatexatlyLofthey 
souresof9areritialis  (t (tY- yyy 1- Lrr Unfortunately,diferentsouresmaybelongtothesameper­mutationssubgroupsothatwehavetodealwithdependen­iesamongtherandomhoiesforthedestinationsofthese 
soures.LetEKdenoteanarbitraryeventthatfxesthe destinationsof'sourenodesdiferentfroms.W.l.o.g.,we assume':L:y/2:r/2.WeshowthatEKdoesnot 
afetouralulationssignifantly.Inpartiular, y-'y Pr[sisritialIEK]?? r2r beause':y/2,and y2y Pr[sisnotritialIEK]?1-?1­ 
r-'r beause':r/2.Hene,takingintoaountthedependen­ies,ourlowerboundbeomes (tY- 2 2 yy2yy2y 1-?1- L2rr2rLr 
22 z2z ?1­ 8d2Lrd2r e)e applyinga?a,(1-lb)a?1-aandz/(2d):y:z/d. bb)bb,Finally,wesetz=4andr=64d.Thentheprobability 
d2 thatthereareLormoreritialsouresisatleast 16d32d (2d) -5 2 -l 512d964d8 1-? Finally,wesetL=L(d-2)/(10log(2d))=(d/logd).In 
thisway,theprobabilitythat9isritialisatmost (2d) -5cd-2)/cloIogc2d))2 -l2 -d/2-l/2 ==n ThisompletestheproofofLemma3.3. 
Theabovelemmashowsthatonefxedtoken-groupisrit­ialwithprobabilityatleastn -l/2 .Reallthatwehaveat leastntoken-groups.Wehavetoshowthatatleastone 
ofthemisritialwithprobability1-o(1).Twotoken­groupsarestohastiallydependentifandonlyiftheyon­tainsourenodesofthesamepermutationsubgroup. 
Oneanmodelthesedependeniesbyadependenygraph inwhihthevertiesrepresenttoken-groupsandtwoverties areonnetedbyanedgewhentheorrespondingtoken­groupsontainsouresofthesamepermutation-subgroup. 
Letusdeterminethemaximumvertexdegreeofthedepen­denygraph.W.l.o.g.,letusassumethatLemma3.2istight sothateahsourenodeoursinatmostIr/(2dz)1:r/z 
tokengroups.(Otherwise,simplyremovethesuperfuous tokens.)Furthermore,eahtoken-groupontainsatmostz sourenodes.Thus,thevertexdegreeinthedependeny 
graphisatmostr.Consequently,thereisanindependent setofatleastn/rtoken-groups.Theprobabilitythatat leastoneofthetoken-groupsinthissetisritialisatleast 
 (t"/Ie) 1-1-n -l/2?1-expn/r=1-o(1) ThisompletestheproofofTheorem3.1. 4. THE OFF-LINE ALGORITHM 4.1 Deterministic 
complemental routing Assuggested,e.g,in[2],wehoosepathsintheBenes networkandembeddthisnetworkintothehyperube.It 
iswell-knownthateverypermutationanbeonnetedby non-overlappingpathsintheBenes networkandthatone anomputethesepathsintimeO(nlogn)onauniform 
RAM.Furthermore,embeddingtheBenessnetworkintothe hyperubeyieldspathswithongestionatmosttwo. Theaboveapproahorrespondstohoosingintermediate 
destinationsinaoordinatedfashionratherthansimplyat random.First,paketsmoveonbit-fxingpathsfromthe souretotheintermediatedestinationininreasingorder 
ofdimension.Thenpaketsmovetotheirfnaldestination usingbit-fxingpathsindereasingorderofdimension.Un­fortunately,thisapproahyieldsroutingpathsoflengthup 
to2d. Inordertolimitthemaximumpathlength,weuseexatly thesametrikasintheon-linease.Fixapaketp.Letv denotetheintermediatedestinationomputedbytheBenes 
networkalgorithm.Ifthepathviavisshorterthanthe pathviaitsomplementvvthenwehoosethepathviav, otherwisewehoosetheomplementalpathviav 
. LEMMA4.1.Deterministiomplementalroutingom­putespathsoflengthatmostdwithongestionatmostfour. Theresultonthepathlengthfollowsanalogouslytothe 
randomizedase.Furthermore,theresultontheongestion anbeeasilyonludedfromthefollowingpropertyofthe Benessnetwork.Givenasetofnon-overlappingpathsinthe 
Benessnetwork,theomplementalpathsarenon-overlapping aswell.Thus,ouralgorithmproduestwolassesofnon­overlappingpathsintheBenessnetwork,eahofwhihan 
beembeddedwithongestionatmosttwointhehyperube. 4.2 Off-line Scheduling using frugal colorings AgainweuseavariationoftheNTOorFTGpoliy.In 
thefollowing,letPdenotethesetofpakets,and,forpP, letWpdenotetheroutingpathofpaketp.Ouralgorithm omputesaso-alled"frugaloloring"ofthepakets.The 
propertiesoftheoloringwillbeexplainedlater.Letusnow desribehowweusethisoloringforthesheduling. LetB,Cand,denotesuitablepositiveintegers.(The 
exatvaluesoftheseparameterswillbedesribedlater.For thetimebeing,youmayassumeB.logd,C.dBand V ,.d/B.)EahpaketpPisassignedaolorfrom 
theset[C]={0C-1}.Theolorsofthepaketswillbe translatedintopriorityranksasfollows. WebreakeahroutingpathWpinto,ontiguoussub­pathsWplCCWp' 
insuhawaythatnoneofthesesubpaths ontainstheintermediatedestinationofpasinternalnode. Clearly,thesesubpathsanbehoseninsuhawaythat 
themaximumlengthofanysubpathis2d/,+1:3d/,.As theintermediatedestinationanonlybeontainedasfrst orlastnode,eahsubpathisabit-fxingpatheitherindi­mensionalorinreverse-dimensionalorder.Observethata 
bit-fxingpathannotjoin,splitandjoinagainwitharout­ingpaththatisomposedoutofanotherbit-fxingpath insamedimensionalorderandabit-fxingpathinreverse 
dimensionalorder.3Thisleadstothefollowingobservation. 3Reallthatedgesaredireted.Inaseofundiretededges 
OBSERVATION4.2.Letpandq=pdenotepakets.Then theroutingpathWqandthesubpathWpiWp(1:i:,) anoverlapatonlyoneontiguoussequeneofedges. 
Weontinuewiththedesriptionofthepriorityranks. ForanedgeeWp,let p(e)denotethepositionofeinWp withthefrstedgeonthepathhavingpositionone.Now 
wedefnetherankofapaketpwitholoronedgeefrom Wpiby r(pCe)=r(pCeC)= p(e)+(i-1)B+ Inotherwords,theinitialrankofapaketis,therankis 
inreasedbyonewhenthepakettraversesanedge,andthe rankisadditionallyinreasedbyBwhenthepaketenters thenextsubpath. 
THEOREM4.3.Thereisaoloringthatyieldsrouting timed+O(dlogd).Theoloringanbeomputedinex­petedtimeO(nd2). 
PROOF.Thebasiideaistotranslatethesheduling problemintoa"frugaloloringproblem".Originally,the oneptoffrugaloloringwasintroduedin[5].Theyde­fneavertex-oloringofagraphtobe(-frugalifforeah 
vertexvandolorthenumberoftimesthatappears intheneighborhoodofvisatmost(.Weintroduethe followingvariation. 
DEFINITION4.4(FRUGALOLORING).Abipartite multigraphM=(UUVCE)withedgeolors(e)[C] (eE)andnodeolors(v)[C](vV)isolored 
(CC()-frugalif,foreahnodeuU,thereareatmost( inidentedgese=(uCv)with(v)=(e). Supposetheedgeolorsaregiven,andthegoalistofnd 
appropriateolorsforthenodesinVsuhthatthegraphis olored(CC()-frugal.Thentheedgeolorsanbeviewedas aspeifationof"forbiddenolors"forthenodesinVthat 
mightbeviolatedonlyafewtimesintheneighborhoodof anynodeinU. Thefollowinglemmashowstheexisteneofafrugalol­oringwithsmallCandsmall(,providedthatparalleledges 
havediferentolors.Inthefollowing,letLuandLvdenote themaximumdegreeofthevertiesinUandV,respetively, anddefneL=LuLv. 
LEMMA4.5.Letko0denoteasuitablylargeabsolute onstant.Supposethatalledgesonnetingthesamepairof vertieshavebeenassigneddiierentolors.Thenthereisa 
(CC()-frugaloloringofthenodesinV,providedC?Lu/k and(?max{2ekCkologL},foranyk0.Moreover, 2poIyc ) ifIVI:thensuhaoloringanbeomputedin 
expetedlineartimeO(IEI). PROOF.WeuseChernofboundsandtheLovaaszLoal Lemma(LLL)toshowtheexisteneofthedesribedolor­ing.SupposewehoosetheolorsofallvertiesinVinde­pendently,uniformlyatrandom.Thentheexpetednum­berofviolationsintheneighborhoodofanyvertexuU 
isatmostLu/C.Wedefnek=Lu/C.Forh0, thesepathsmightoverlaptwie,whihwouldrequiresome minormodifationsinthefollowingproof. 
letp(h)denotetheprobabilitythattherearemorethan (=max{2ekChlogL}violationsintheneighborhoodof vertexu.Observethatanyviolationorrespondstoadif­ferentrandomexperiment(i.e.,theassignmentofaolorto 
anodeinV)beauseredundantedgesmusthavediferent olors.Therefore,applyingaChernofboundyields 2 -hIogL -h 
p(h)::(3) Now,intermsoftheLLLeverynodeudefnesabadevent, i.e.,therearemorethan(violationsintheneighborhood 
ofu.Thenumberofeventsthatsharearandomexperi­mentwithanyfxedeventuisatmostLu(Lv -1):L. Therefore,theappliationoftheLLLrequirep(h)L:lWe 
hooseh=3andassumew.l.o.g.Lu?Lv?2thenequa­tion3showsthattheassumptionsoftheLLLarefulflled. Thus,theexisteneoftheoloringisshown. 
Inordertoomputetheoloring,oneanuseanalgorith­miversionoftheLLLpresentedbyMolloyandReedin [13].Thealgorithmsfromthisartile,however,annotbe 
applieddiretlybutneedsomefurtherimprovementsbased ontehniquespresentedin[1,12].Detailsareexplainedin 
afullversionofthispaper. Nextweshowhowtotranslatetheshedulingproblem intoafrugaloloringproblemofabipartitemultigraphM= 
(UUVCE).WedefneVtobethesetofpakets,i.e.,V=P. Furthermore,wedefne U={(WpiC9)IpPC1:i:,C9[C]} Thus,thesetUontainsallombinationsofsubpathsand 
olors.Itremainstospeifytheedgesinthemultigraph.We onnetavertexu=(WpiC9)UwithavertexvV=P byanedgeofolorifWvandWpi(p=v)overlapatan 
hyperubeedgeeand r(pCeC9)[r(vCeC)-BCr(vCeC)] Intuitively,u=(WpiC9)andvareonnetedbyanedge ofolorinthemultigraphifpandvanmetwithlose 
ranksonanhyperubeedgeintheasethatpandvget assignedtheinitialolors9and,respetively.Theidea isthatafrugaloloringminimizesthenumberofpossible 
onfitsbetweenpaketswithloseranks.Thefollowing lemmashowsthatafrugaloloringwithsmall(leadstoa smallroutingtime. 
LEMMA4.6.Supposetheoloringis(CC()-frugalwith (:B.Thentheroutingtimeisatmostd+C+,B. PROOF.Weusetheranksofthepaketsasguidelinesfor 
thetimestepsinwhihthepaketstraverseanedge.In partiular,apaketpisalledearlyinsteptifitwantsto traverseanedgeewitht<r(pCe),andpisalledlateif 
tr(pCe)+B.Furthermore,apaketisalledintimeif itisneitherearlynorlate.Inthefollowingproof,wewill showthatallpaketsarriveearlyorintime.Thisyieldsthe 
lemmabeauseapaketreahesitsdestinationinatmost C+d+,Bsteps,unlessitislate. Byontradition,weassumethatpisthefrstpaketthat 
beomeslate.Supposethishappensonsubpath Wpi =(elCe2CCeÆ) Thenpmusthavebeenarrivedearlyorexatlyintime(i.e., 
instepr(pCel)-1)atthetailofedgeelbeausepwould Wi-l havebeenlateonsubpathp,otherwise.Thus,wean identifyasubpathW=eKCCe,Wpisuhthatpis 
availableintimeateahoftheseedgesandpisdelayedfor atleastB+1timesonthispath.Inpartiular,wean assoiateatimewindowIH=[r(pCeH)Cr(pCeH)+B]andan 
integertH?0,for':j:T,suhthatpisdelayedoneHin IHfortHtimesandtH?B+1. Consideraspae-timeinterval(eHCIH)(':j:T).On 
onehand,paketsdelayingponedgeeHinintervalIHmust havearankatleastr(pCeH)aspaketswithsmallerrank arepreferred.Ontheotherhand,therankofthesepakets 
annotbesmallerthanr(pCeH)-Bbeausepaketswith smallerrankwouldbelateiftheypassedgeeHininter­valIH,whihontraditsourassumptionthatpisthefrst 
paketthatbeomeslate.Hene,weanrestritourselves toarankinterval[r(pCeH)-BCr(pCeH)],foreahedgeeH (':j:T).Nowletdenotetheolorofp.Thenthefru­galedgeoloringensuresthatthereareatmost(violations 
intheneighborhoodofthevertexu=(WpiC).Asaonse­quene,thereareatmost(paketstraversinganedgeofWpi withranksfromtheinterval[r(pCeHC)-BCr(pCeHC)].We 
summarize,thenumberofdiferentpaketsthatpotentially delaypaketponpathWWpiisatmost(. Finally,itremainstoshowthatthesepaketanslowdown 
paketpbyatmost(steps.Observethatpisdelayedby atmostonestepforeverypaketthatentersWwhilep traversesthissubpath.Abovewehaveshownthatthereare 
atmost(diferentpaketsthatmightenterWduringthis time.Furthermore,Observation4.2showsthateahofthese paketsenterWatmostone.Consequently,themaximum 
delayofponWisB,whihontraditsourassumptions above.Thus,Lemma4.6isshown. Nextweombinethetwolemmas.LetushooseasuÆ­ientlylargenumberofolors,thatis,weset 
r1 2eLu 4eLu C=: kologLkologL Inthisway,theparameterkinLemma4.5anbesetto k=kologL/(2e),sothattheexisteneofa(CC()-frugal 
oloringisguaranteed,for (?max{2ekCkologL}=kologL Reallthatkoisaonstantthatneedstobehosensuf­fientlylarge.W.l.o.g.thetermkologLisintegral, 
andwesetB=(=kologL.Furthermore,wedefne VV ,=Id/B1:2d/B.ThenLemma4.6showsthatthe routingtimeisatmost V 
4eLu T=d+C+,B:d++2kodlogL kologL ItremainstoboundLandLu.ThesubpathWpi repre­sentedbyanodeuUoverlapswithatmost9d/,paths 
Wv(v=p)beausethelengthofthesubpathisatmost 3d/,andtheongestionisatmostfour.Thus,eahnode uUisadjaenttoatmost9d/,nodesinV.Sineeah 
pairofvertiesinthemultigraphisonnetedbyatmost B+1:2Bparalleledges(ofdiferentolor),weanon­lude 18Bd 3/2l/23/2l/2 
Lu::18Bd:18(kologL)d , Similarly,theroutingpathrepresentedbyanodevV overlapswithatmost3dsubpathsandeahsubpathanbe 
ombinedwithCdiferentolors.Thus,eahnodeinVis adjaenttoatmostCdnodesfromU.Takingintoaount paralleledgesyieldsLv:6BCd.Asaonsequene 
L=LvLu:6BCdLu:24edLu2 :7777e(kologL)3d2 WeonludethatthereexistsaonstantklsuhthatL: kld3and,hene,thereexistsanotheronstantk2suhthat 
Lu:k2dl/2(logd)3/2 .Finally,substituting,thesebounds intothepreedingupperboundontheroutingtimeyields 
T=d+O(dlogd).ThisompletestheproofofTheorem 4.3.  5. CONCLUSIONS Westartedwithpresentingasimple,eleganttrikom­putingshortroutingpathswithsmallongestiononthehy­perube.Basedonthistrik,weintroduedthefrston-line 
andof-lineshedulingalgorithmsforpermutationrouting inalmostoptimaltime.Bothshedulingprotoolsimple­menttheideathatlatepaketsarepreferredagainstearly 
pakets.Itisnotlear,however,whetherthisideaisruial fortheresultsthemselvesoronlyfortheanalysis. Forexample,onsidertheon-lineresult.Ononehand,we 
haveshownforapartiularroutingprotool,aombination ofNTOandFTG,thatitroutesanypermutationintime d+O(d/logd).Althoughtheresultsustainsseveralsmall 
hangesinthedefnitionoftheshedulingprotool,e.g., paketsonthefrstpartoftheirroutingpathsneednotto bepreferredagainstpaketsontheseondpart,theanalysis 
breaksdownifthepriorityranksarenotinreasedduring therouting. Ontheotherhand,Ranade[16](seealso[9])showed 
thatmanyshedulingpoliieshaveexatlyidentialprob­abilistibehavioronrandomroutingproblemsinwhihei­therthesouresorthedestinationsofthepaketsareho­senindependentlyanduniformlyatrandom.Inpartiular, 
Ranadestudiesnonpreditiveprotools,i.e.,algorithmspla­ingshedulingdeisionsindependentfromthedestinations. 
Forexample,FIFO,LIFO,andNTOarenonpreditive,but FTGisnot.Hissurprisingdisoveryisthattheruntime behaviorofallnonpreditiveprotoolsonrandomrouting 
problemsisexatlythesame. ItisnotdiÆulttoonstrutanexampleshowingthatthe exatidentityamongnonpreditiveprotoolsdoesnothold 
anymoreifeahnode,e.g.,hoosestwonodesatrandom andsendsapakettothelosestoneamongthem.Nev­ertheless,inthelightofRanada'sresultoneanimagine 
thatmanyothershedulingpoliiesahieveaperformane similartotheNTO/FTGpoliyforomplementalrouting paths.Therefore,itwouldbeinterestingtoknowifother 
shedulingpoliies(e.g.,FIFO)yieldruntimed+o(d)as wellorwhytheyfail. 6. REFERENCES <RefA>[1]N.Alon.AparallelalgorithmiversionoftheLoal 
Lemma.RandomStruturesfAlgorithms,2:367.378, 1991. [2]F.AnnexsteinandM.Baumslag.Aunifedapproah toof-linepermutationroutingonparallelnetworks.In 
Pro.ofthe2ndACMSymp.onParallelAlgorithms andArhitetures(SPAA),pages398.406,1990. [3]A.BorodinandJ.E.Hoproft.Routing,merging,and 
sortingonparallelmodelsofomputation.Journalof ComputerandSystemSiene,42:130.145,1985. [4]R.Cypher,F.MeyeraufderHeide,C.Sheideler,and 
B.Vooking.Universalalgorithmsfor store-and-forwardandwormholerouting.InPro.of the28thACMSymp.onTheoryofComputing 
(STOC),pages356.365,1996. [5]H.Hind,M.Molloy,andB.Reed.Colouringgraphs frugally.Combinatoria,toappear. 
 [6]T.HagerupandC.Roub,AguidedtourofChernoi bounds.InformationProessingLetters33(6):305-308, 1990. [7]C.Kaklamanis,D.Krizan,T.Tsantilas.Tigth 
BoundsforObliviousRoutingintheHyperube. MathematialSystemsTheory24,pp.223-232,1991. [8]J.Kim,E.Lehman,andT.Leighton.Oblivious 
Deadlok-FreeRoutinginaFaultyHyperube.In Pro.ofthe10thSymposiumonParalleland DistributedProessing,1999. 
[9]F.T.Leighton.IntrodutiontoParallelAlgorithms andArhitetures:Arrays Trees Hyperubes. MorganKaufmann,SanMateo,CA,1992. 
 [10]F.T.Leighton,B.M.Maggs,A.G.Ranade,andS.B. Rao.Randomizedroutingandsortingon fxed-onnetionnetworks.JournalofAlgorithms, 
17:157.205,1994. [11]F.T.Leighton,B.M.Maggs,andS.B.Rao.Paket routingandjob-shopshedulinginO(ongestion+ 
dilation)steps.Combinatoria,14(2):167.186,1994. [12]F.T.Leighton,S.B.Rao,andA.Srinivasan.New algorithmiaspetsoftheLoalLemmawith 
appliationstoroutingandpartitioning.InPro.of the10thACM-SIAMSymposiumonDisrete Algorithms(SODA),pp.643.652,1999. 
[13]M.MolloyandB.Reed.Furtheralgorithmiaspetsof theLoalLemma.InPro.ofthe30thACMSymp.on TheoryofComputing(STOC),pages524.529,1998. 
[14]F.MeyeraufderHeideandB.Vooking.Shortest pathsroutinginarbitrarynetworks.Journalof Algorithms,Vol.31,No.1,pp.105-131,1999. 
[15]A.G.Ranade.Howtoemulatesharedmemory. JournalofComputerandSystemSiene,42:307.326, 1991. [16]A.G.Ranade.EquivaleneofMessageSheduling 
AlgorithmsforParallelCommuniation.Teh.Report YALEU/DCS/TR-512,Dept.Comp.Si.,Yale University,NewHaven,CT,1987. 
[17]E.Upfal.EÆientshemesforparallelommuniation. JournaloftheACM,31(2):507.517,1984. [18]X.Shen,Q.Hu,andW.Liang.Realizationofan 
arbitrarypermutationonahyperube.Information ProessingLetters,51:237.243,1994. [19]L.G.Valiant.Generalpurposeparallelarhitetures. 
InJ.vanLeeuwened.,HandbookofTheoretial ComputerSiene, olumeA,pages943.971,1990. pages263.277,1981. [20]L.G.ValiantandG.J.Brebner.Universalshemes 
forparallelommuniation.InPro.ofthe13thACM Symp.onTheoryofComputing(STOC),pages 263.277,1981.</RefA>  
			
